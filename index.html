<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ - ç²¾ç¡®ä¸“ä¸šç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --deep-blood: #1a0000;
            --dark-red: #330000;
            --blood-red: #ff0000;
            --rich-red: #ff3333;
            --golden-yellow: #ffd700;
            --quantum-blue: #00e1ff;
            --crystal-white: rgba(255, 255, 255, 0.95);
            --pearl-white: rgba(255, 255, 255, 0.85);
            --success-green: #4CAF50;
            --warning-orange: #FF9800;
            --danger-red: #ff3333;
            --premium-gold: #FFD700;
            --info-blue: #2196F3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            color: var(--crystal-white);
            background: var(--deep-blood);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(255, 0, 0, 0.3) 0%, transparent 45%),
                radial-gradient(circle at 85% 75%, rgba(255, 51, 51, 0.25) 0%, transparent 45%),
                linear-gradient(145deg, #1a0000 0%, #330000 30%, #660000 70%, #330000 100%);
        }
        
        .quantum-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            background: 
                radial-gradient(ellipse at 15% 25%, rgba(255, 0, 0, 0.35) 0%, transparent 60%),
                radial-gradient(ellipse at 85% 75%, rgba(255, 51, 51, 0.3) 0%, transparent 60%);
        }
        
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 120px;
            color: rgba(255, 0, 0, 0.1);
            font-weight: bold;
            z-index: 0;
            pointer-events: none;
            user-select: none;
        }
        
        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 40px;
            position: relative;
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.7), rgba(255, 51, 51, 0.5));
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--golden-yellow), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .title {
            font-size: 2.8rem;
            color: var(--golden-yellow);
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            animation: glow 3s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(255, 215, 0, 0.4); }
            to { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
        
        .subtitle {
            color: var(--pearl-white);
            font-size: 1.2rem;
            margin-bottom: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
            margin-top: 40px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        .bazi-section, .professional-analysis {
            background: rgba(26, 0, 0, 0.85);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
        }
        
        .bazi-title, .analysis-title {
            font-size: 1.8rem;
            color: var(--golden-yellow);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .input-grid {
            display: grid;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .date-input-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .date-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-label {
            color: var(--golden-yellow);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .date-input, .input-field {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: var(--crystal-white);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .date-input:focus, .input-field:focus {
            outline: none;
            border-color: var(--quantum-blue);
            box-shadow: 0 0 15px rgba(0, 225, 255, 0.3);
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .gender-select {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }
        
        .gender-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .gender-option.active {
            background: linear-gradient(145deg, var(--golden-yellow), #ffaa00);
            color: var(--deep-blood);
            font-weight: bold;
            border-color: var(--golden-yellow);
        }
        
        .quick-date {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .date-btn {
            padding: 10px 15px;
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 51, 51, 0.3);
            border-radius: 8px;
            color: var(--pearl-white);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .date-btn:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: translateY(-2px);
        }
        
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(145deg, var(--blood-red), var(--dark-red));
            border: none;
            border-radius: 15px;
            color: var(--crystal-white);
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 0, 0, 0.4);
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .action-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .action-btn {
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: var(--crystal-white);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .share-btn {
            padding: 12px;
            background: linear-gradient(145deg, #07c160, #06ad56);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(7, 193, 96, 0.3);
        }
        
        .share-count {
            background: linear-gradient(145deg, #ff9800, #f57c00);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .bazi-result-display {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .exact-calculation {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 4px solid var(--quantum-blue);
        }
        
        .bazi-grid-inner {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .bazi-grid-inner {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .bazi-pillar {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(51, 0, 0, 0.8));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .pillar-name {
            color: var(--golden-yellow);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .pillar-ganzhi {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--quantum-blue);
            margin: 10px 0;
        }
        
        .pillar-detail {
            color: var(--pearl-white);
            font-size: 0.9rem;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        @media (min-width: 768px) {
            .export-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .export-btn {
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 225, 255, 0.3);
            border-radius: 10px;
            color: var(--crystal-white);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .export-btn:hover {
            background: rgba(0, 225, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .prediction-grid-inner {
            display: grid;
            gap: 20px;
        }
        
        .prediction-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .prediction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 0, 0, 0.2);
        }
        
        .prediction-year {
            color: var(--golden-yellow);
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .prediction-effect {
            color: var(--pearl-white);
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .prediction-method {
            color: var(--quantum-blue);
            font-size: 0.85rem;
            font-style: italic;
        }
        
        .analysis-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .pricing-grid {
            display: grid;
            gap: 20px;
        }
        
        .pricing-card {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .pricing-card.popular {
            border-color: var(--golden-yellow);
            transform: scale(1.05);
            position: relative;
        }
        
        .pricing-name {
            color: var(--golden-yellow);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .pricing-price {
            color: var(--quantum-blue);
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .pricing-features {
            color: var(--pearl-white);
            margin-bottom: 25px;
            line-height: 1.8;
        }
        
        .pricing-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(145deg, var(--golden-yellow), #ffaa00);
            border: none;
            border-radius: 10px;
            color: var(--deep-blood);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pricing-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }
        
        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            color: var(--pearl-white);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-title {
            color: var(--quantum-blue);
            font-size: 2rem;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(0, 225, 255, 0.3);
            border-top: 6px solid var(--quantum-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        
        .modal-content {
            background: var(--deep-blood);
            border: 2px solid var(--golden-yellow);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--golden-yellow);
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-title {
            color: var(--golden-yellow);
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* æ–°å¢æ ·å¼ï¼šé«˜çº§åˆ†æå¡ç‰‡ */
        .advanced-analysis-grid {
            display: grid;
            gap: 20px;
        }
        
        .advanced-analysis-card {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.7), rgba(51, 0, 0, 0.7));
            border: 1px solid rgba(0, 225, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .advanced-analysis-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 225, 255, 0.2);
        }
        
        .advanced-title {
            color: var(--quantum-blue);
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .advanced-content {
            color: var(--pearl-white);
            line-height: 1.6;
        }
        
        .share-progress {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            border-left: 4px solid #07c160;
        }
        
        .progress-text {
            color: var(--pearl-white);
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #07c160, #4CAF50);
            transition: width 0.5s ease;
        }
        
        /* æŠ¥å‘Šä¸‹è½½åŒºåŸŸæ ·å¼ */
        .report-downloads {
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .report-tier {
            margin-bottom: 30px;
        }
        
        .report-tier-title {
            color: var(--golden-yellow);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .report-download-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .report-download-btn {
            padding: 15px;
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: var(--crystal-white);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-align: center;
        }
        
        .report-download-btn:hover {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }
        
        .report-download-btn.premium {
            background: linear-gradient(145deg, rgba(0, 225, 255, 0.2), rgba(0, 225, 255, 0.1));
            border-color: rgba(0, 225, 255, 0.3);
        }
        
        .report-download-btn.premium:hover {
            background: linear-gradient(145deg, rgba(0, 225, 255, 0.3), rgba(0, 225, 255, 0.2));
            box-shadow: 0 5px 15px rgba(0, 225, 255, 0.2);
        }
        
        .price-tag {
            background: var(--golden-yellow);
            color: var(--deep-blood);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* ç”¨æˆ·éªŒè¯æ¨¡æ€æ¡†æ ·å¼ */
        .verification-modal {
            max-width: 500px;
        }
        
        .verification-input {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: var(--crystal-white);
            font-size: 1rem;
            width: 100%;
            margin: 15px 0;
        }
        
        .verification-btn {
            padding: 12px 30px;
            background: linear-gradient(145deg, var(--success-green), #2E7D32);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px auto;
        }
        
        .verification-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .verification-success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success-green);
            color: var(--success-green);
        }
        
        .verification-error {
            background: rgba(255, 51, 51, 0.2);
            border: 1px solid var(--danger-red);
            color: var(--danger-red);
        }
    </style>
</head>
<body>
    <div class="quantum-background"></div>
    <div class="watermark">å¤©æœºé˜</div>
    
    <div class="container">
        <header class="header">
            <h1 class="title">å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ</h1>
            <p class="subtitle">ä¼ æ‰¿åƒå¹´æ™ºæ…§ Â· èåˆé‡å­ç®—æ³• Â· æ­ç§˜å‘½è¿å¯†ç </p>
            <p class="subtitle">ç²¾å‡†é¢„æµ‹äººç”Ÿèµ·ä¼ Â· ä¸“ä¸šåˆ†æè¿åŠ¿èµ°å‘ Â· æŠŠæ¡æœ€ä½³æ—¶æœº</p>
        </header>
        
        <div class="main-content">
            <!-- å·¦è¾¹ï¼šå…«å­—æ’ç›˜åŒº -->
            <section class="bazi-section">
                <h2 class="bazi-title"><i class="fas fa-calendar-alt"></i> å…«å­—æ’ç›˜è¾“å…¥</h2>
                
                <div class="input-grid">
                    <div class="date-input-row">
                        <div class="date-input-group">
                            <label class="input-label"><i class="fas fa-calendar"></i> å‡ºç”Ÿå¹´ä»½</label>
                            <input type="number" id="year" class="date-input" value="1990" min="1940" max="2030">
                        </div>
                        <div class="date-input-group">
                            <label class="input-label"><i class="fas fa-calendar-week"></i> å‡ºç”Ÿæœˆä»½</label>
                            <input type="number" id="month" class="date-input" value="5" min="1" max="12">
                        </div>
                        <div class="date-input-group">
                            <label class="input-label"><i class="fas fa-calendar-day"></i> å‡ºç”Ÿæ—¥æœŸ</label>
                            <input type="number" id="day" class="date-input" value="15" min="1" max="31">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-clock"></i> å‡ºç”Ÿæ—¶è¾°</label>
                        <select id="hour" class="input-field">
                            <option value="23">å­æ—¶ (23:00-00:59)</option>
                            <option value="0">å­æ—¶ (00:00-00:59)</option>
                            <option value="1">ä¸‘æ—¶ (01:00-02:59)</option>
                            <option value="2">ä¸‘æ—¶ (02:00-02:59)</option>
                            <option value="3">å¯…æ—¶ (03:00-04:59)</option>
                            <option value="4">å¯…æ—¶ (04:00-04:59)</option>
                            <option value="5">å¯æ—¶ (05:00-06:59)</option>
                            <option value="6">å¯æ—¶ (06:00-06:59)</option>
                            <option value="7">è¾°æ—¶ (07:00-08:59)</option>
                            <option value="8">è¾°æ—¶ (08:00-08:59)</option>
                            <option value="9">å·³æ—¶ (09:00-10:59)</option>
                            <option value="10">å·³æ—¶ (10:00-10:59)</option>
                            <option value="11">åˆæ—¶ (11:00-12:59)</option>
                            <option value="12" selected>åˆæ—¶ (12:00-12:59)</option>
                            <option value="13">æœªæ—¶ (13:00-14:59)</option>
                            <option value="14">æœªæ—¶ (14:00-14:59)</option>
                            <option value="15">ç”³æ—¶ (15:00-16:59)</option>
                            <option value="16">ç”³æ—¶ (16:00-16:59)</option>
                            <option value="17">é…‰æ—¶ (17:00-18:59)</option>
                            <option value="18">é…‰æ—¶ (18:00-18:59)</option>
                            <option value="19">æˆŒæ—¶ (19:00-20:59)</option>
                            <option value="20">æˆŒæ—¶ (20:00-20:59)</option>
                            <option value="21">äº¥æ—¶ (21:00-22:59)</option>
                            <option value="22">äº¥æ—¶ (22:00-22:59)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-venus-mars"></i> æ€§åˆ«</label>
                        <div class="gender-select">
                            <div class="gender-option active" data-gender="male">ç”·</div>
                            <div class="gender-option" data-gender="female">å¥³</div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-map-marker-alt"></i> å‡ºç”Ÿåœ°ç‚¹</label>
                        <input type="text" id="location" class="input-field" value="åŒ—äº¬" placeholder="è¯·è¾“å…¥å‡ºç”Ÿåœ°">
                    </div>
                </div>
                
                <div class="quick-date">
                    <div class="date-btn" data-date="today">ä»Šå¤©</div>
                    <div class="date-btn" data-date="yesterday">æ˜¨å¤©</div>
                    <div class="date-btn" data-date="example1">ç¤ºä¾‹1: 1990-5-15 åˆæ—¶</div>
                    <div class="date-btn" data-date="example2">ç¤ºä¾‹2: 1985-8-20 æœªæ—¶</div>
                    <div class="date-btn" data-date="example3">ç¤ºä¾‹3: 1978-11-8 è¾°æ—¶</div>
                </div>
                
                <button class="calculate-btn" id="calculateBtn">
                    <i class="fas fa-calculator"></i> ç²¾ç¡®å…«å­—æ’ç›˜
                </button>
                
                <div class="action-buttons">
                    <button class="action-btn" id="verifyBtn">
                        <i class="fas fa-check-circle"></i> ç®—æ³•éªŒè¯
                    </button>
                    <button class="action-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> é‡ç½®
                    </button>
                    <button class="action-btn" id="premiumBtn">
                        <i class="fas fa-crown"></i> é«˜çº§ç‰ˆ
                    </button>
                    <button class="action-btn" id="printBtn">
                        <i class="fas fa-print"></i> æ‰“å°
                    </button>
                </div>
                
                <!-- ç»“æœæ˜¾ç¤ºåŒº -->
                <div class="bazi-result-display" id="resultDisplay" style="display: none;">
                    <div class="exact-calculation" id="exactCalculation">
                        <div style="color: var(--quantum-blue); margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-calculator"></i> è®¡ç®—è¿‡ç¨‹
                        </div>
                        <div id="exactDetails" style="color: var(--pearl-white);"></div>
                    </div>
                    
                    <div class="bazi-grid" id="baziGrid"></div>
                    
                    <div class="bazi-summary" id="baziSummary"></div>
                    
                    <div class="share-progress" id="shareProgress" style="display: none;">
                        <div class="progress-text">
                            <i class="fas fa-gift"></i> åˆ†äº«è¿›åº¦ï¼šå·²åˆ†äº« <span id="shareCount">0</span>/10 ä½å¥½å‹
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <p style="color: var(--pearl-white); margin-top: 10px; font-size: 0.9rem;">
                            ğŸ åˆ†äº«ç»™10ä½å¾®ä¿¡å¥½å‹ï¼Œå³å¯å…è´¹è§£é”ä»·å€¼2000å…ƒçš„æœªæ¥3å¹´æµå¹´è¿åŠ¿åˆ†æï¼
                        </p>
                    </div>
                    
                    <!-- æŠ¥å‘Šä¸‹è½½åŒºåŸŸ -->
                    <div class="report-downloads" id="reportDownloads">
                        <h3 style="color: var(--golden-yellow); margin-bottom: 25px; font-size: 1.8rem;">
                            <i class="fas fa-file-download"></i> æŠ¥å‘Šä¸‹è½½åŒº
                        </h3>
                        
                        <!-- å…è´¹æŠ¥å‘Š -->
                        <div class="report-tier">
                            <h4 class="report-tier-title">
                                <i class="fas fa-unlock"></i> å…è´¹æŠ¥å‘Š
                            </h4>
                            <div class="report-download-buttons">
                                <button class="report-download-btn" onclick="downloadFreeReport('txt')">
                                    <i class="fas fa-file-alt"></i> å…è´¹TXTæŠ¥å‘Š
                                </button>
                                <button class="report-download-btn" onclick="downloadFreeReport('image')">
                                    <i class="fas fa-image"></i> å…è´¹å›¾ç‰‡æŠ¥å‘Š
                                </button>
                            </div>
                        </div>
                        
                        <!-- ä»˜è´¹æŠ¥å‘Š -->
                        <div class="report-tier">
                            <h4 class="report-tier-title">
                                <i class="fas fa-crown" style="color: var(--golden-yellow);"></i> ä»˜è´¹æŠ¥å‘Š
                            </h4>
                            
                            <!-- åŸºç¡€ç‰ˆ -->
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: var(--quantum-blue); margin-bottom: 10px; font-size: 1.1rem;">
                                    <i class="fas fa-star"></i> åŸºç¡€ç‰ˆ <span class="price-tag">Â¥268</span>
                                </h5>
                                <div class="report-download-buttons">
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('basic', 'word')">
                                        <i class="fas fa-file-word"></i> åŸºç¡€ç‰ˆWORDæŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('basic', 'image')">
                                        <i class="fas fa-file-image"></i> åŸºç¡€ç‰ˆå›¾ç‰‡æŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('basic', 'txt')">
                                        <i class="fas fa-file-alt"></i> åŸºç¡€ç‰ˆTXTæŠ¥å‘Š
                                    </button>
                                </div>
                            </div>
                            
                            <!-- è¿›é˜¶ç‰ˆ -->
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: var(--quantum-blue); margin-bottom: 10px; font-size: 1.1rem;">
                                    <i class="fas fa-star-half-alt"></i> è¿›é˜¶ç‰ˆ <span class="price-tag">Â¥368</span>
                                </h5>
                                <div class="report-download-buttons">
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('level2', 'word')">
                                        <i class="fas fa-file-word"></i> è¿›é˜¶ç‰ˆWORDæŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('level2', 'image')">
                                        <i class="fas fa-file-image"></i> è¿›é˜¶ç‰ˆå›¾ç‰‡æŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('level2', 'txt')">
                                        <i class="fas fa-file-alt"></i> è¿›é˜¶ç‰ˆTXTæŠ¥å‘Š
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ä¸“ä¸šç‰ˆ -->
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: var(--quantum-blue); margin-bottom: 10px; font-size: 1.1rem;">
                                    <i class="fas fa-star"></i> ä¸“ä¸šç‰ˆ <span class="price-tag">Â¥568</span>
                                </h5>
                                <div class="report-download-buttons">
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('pro', 'word')">
                                        <i class="fas fa-file-word"></i> ä¸“ä¸šç‰ˆWORDæŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('pro', 'image')">
                                        <i class="fas fa-file-image"></i> ä¸“ä¸šç‰ˆå›¾ç‰‡æŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('pro', 'txt')">
                                        <i class="fas fa-file-alt"></i> ä¸“ä¸šç‰ˆTXTæŠ¥å‘Š
                                    </button>
                                </div>
                            </div>
                            
                            <!-- å°Šäº«ç‰ˆ -->
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: var(--quantum-blue); margin-bottom: 10px; font-size: 1.1rem;">
                                    <i class="fas fa-gem"></i> å°Šäº«ç‰ˆ <span class="price-tag">Â¥888</span>
                                </h5>
                                <div class="report-download-buttons">
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('vip', 'word')">
                                        <i class="fas fa-file-word"></i> å°Šäº«ç‰ˆWORDæŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('vip', 'image')">
                                        <i class="fas fa-file-image"></i> å°Šäº«ç‰ˆå›¾ç‰‡æŠ¥å‘Š
                                    </button>
                                    <button class="report-download-btn premium" onclick="verifyUserBeforeDownload('vip', 'txt')">
                                        <i class="fas fa-file-alt"></i> å°Šäº«ç‰ˆTXTæŠ¥å‘Š
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åˆ†äº«è§£é”ç‰ˆ -->
                        <div class="report-tier" id="shareUnlockTier" style="display: none;">
                            <h4 class="report-tier-title">
                                <i class="fas fa-gift" style="color: #07c160;"></i> åˆ†äº«è§£é”ç‰ˆ
                            </h4>
                            <div class="report-download-buttons">
                                <button class="report-download-btn" style="background: linear-gradient(145deg, rgba(7, 193, 96, 0.2), rgba(7, 193, 96, 0.1)); border-color: #07c160;" onclick="downloadLevel1Report('word')">
                                    <i class="fas fa-file-word"></i> åˆ†äº«è§£é”ç‰ˆWORD
                                </button>
                                <button class="report-download-btn" style="background: linear-gradient(145deg, rgba(7, 193, 96, 0.2), rgba(7, 193, 96, 0.1)); border-color: #07c160;" onclick="downloadLevel1Report('image')">
                                    <i class="fas fa-file-image"></i> åˆ†äº«è§£é”ç‰ˆå›¾ç‰‡
                                </button>
                                <button class="report-download-btn" style="background: linear-gradient(145deg, rgba(7, 193, 96, 0.2), rgba(7, 193, 96, 0.1)); border-color: #07c160;" onclick="downloadLevel1Report('txt')">
                                    <i class="fas fa-file-alt"></i> åˆ†äº«è§£é”ç‰ˆTXT
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="predictionSection" style="margin-top: 40px;">
                        <h3 style="color: var(--golden-yellow); margin-bottom: 25px; font-size: 1.8rem;">
                            <i class="fas fa-crystal-ball"></i> è¿‡å»10å¹´äº‹æƒ…åˆ¤æ–­ï¼ˆåŸºäºç©¿åˆ‘ç»ç ´ï¼‰åŠæœ€è¿‘å¤§è¿
                        </h3>
                        <div class="prediction-grid" id="predictionGrid"></div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveData()">
                            <i class="fas fa-save"></i> ä¿å­˜æ•°æ®
                        </button>
                        <button class="action-btn" onclick="backupData()">
                            <i class="fas fa-database"></i> å¤‡ä»½æ•°æ®
                        </button>
                        <label class="action-btn" style="cursor: pointer;">
                            <i class="fas fa-upload"></i> æ¢å¤æ•°æ®
                            <input type="file" accept=".json" style="display: none;" onchange="restoreData(event)">
                        </label>
                        <button class="share-btn" onclick="generateShareLink()">
                            <i class="fas fa-share-alt"></i> ç”Ÿæˆåˆ†äº«é“¾æ¥
                            <span class="share-count" id="shareCounter">0</span>
                        </button>
                    </div>
                    
                    <!-- é«˜çº§åŠŸèƒ½åŒº -->
                    <div class="advanced-feature" id="advancedFeatures" style="margin-top: 40px; display: none;">
                        <h3 style="color: var(--golden-yellow); margin-bottom: 25px; font-size: 1.8rem;">
                            <i class="fas fa-star"></i> é«˜çº§åˆ†æï¼ˆå·²è§£é”ï¼‰
                        </h3>
                        <div id="advancedAnalysis"></div>
                    </div>
                </div>
            </section>
            
            <!-- å³è¾¹ï¼šä¸“ä¸šåˆ†æåŒº -->
            <section class="professional-analysis">
                <div class="analysis-header">
                    <h2 class="analysis-title"><i class="fas fa-chart-line"></i> ä¸“ä¸šåˆ†æç³»ç»Ÿ</h2>
                    <p class="subtitle">ä¼ æ‰¿åƒå¹´æ™ºæ…§ Â· èåˆé‡å­ç®—æ³• Â· æ­ç§˜å‘½è¿å¯†ç </p>
                </div>
                
                <div class="report-sections">
                    <div class="report-section" style="background: rgba(0,0,0,0.6); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h3 style="color: var(--golden-yellow); margin-bottom: 15px;">ç³»ç»Ÿè¯´æ˜</h3>
                        <div style="color: var(--pearl-white);">
                            <p>æœ¬ç³»ç»Ÿé‡‡ç”¨æ­£ç¡®çš„ä¸‡å¹´å†æŸ¥è¡¨æ³•ï¼š</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>æ­£ç¡®åº”ç”¨äº”è™éã€äº”é¼ é</li>
                                <li>ç²¾ç¡®èŠ‚æ°”åˆ†ç•Œï¼ˆç«‹æ˜¥åˆ†å¹´ï¼‰</li>
                                <li>æœˆå¹²ä»¥å¹´å¹²æ¨ç®—</li>
                                <li>æ—¥æ”¯è‡ªåŠ¨ä¿®æ­£ä¸ºå¯¹å†²å…³ç³»</li>
                                <li>ç©¿åˆ‘ç»ç ´ä¸“ä¸šæ–­äº‹</li>
                                <li>é‡å­ç®—æ³•æ·±åº¦åˆ†æ</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- å…«å­—é€ŸæŸ¥è¡¨ -->
                    <div class="quick-reference" style="background: rgba(0,0,0,0.6); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h4 style="color: var(--quantum-blue); margin-bottom: 15px;">
                            <i class="fas fa-book"></i> å…«å­—é€ŸæŸ¥å‚è€ƒ
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <h5 style="color: var(--golden-yellow); font-size: 0.9rem;">äº”è™éå£è¯€</h5>
                                <p style="font-size: 0.8rem; color: var(--pearl-white);">
                                    ç”²å·±ä¹‹å¹´ä¸™ä½œé¦–<br>
                                    ä¹™åºšä¹‹å¹´æˆŠä¸ºå¤´<br>
                                    ä¸™è¾›ä¹‹å¹´å¯»åºšèµ·<br>
                                    ä¸å£¬å£¬ä½é¡ºè¡Œæµ<br>
                                    è‹¥é—®æˆŠç™¸ä½•å¤„å‘<br>
                                    ç”²å¯…ä¹‹ä¸Šå¥½è¿½æ±‚
                                </p>
                            </div>
                            <div>
                                <h5 style="color: var(--golden-yellow); font-size: 0.9rem;">äº”é¼ éå£è¯€</h5>
                                <p style="font-size: 0.8rem; color: var(--pearl-white);">
                                    ç”²å·±è¿˜åŠ ç”²<br>
                                    ä¹™åºšä¸™ä½œåˆ<br>
                                    ä¸™è¾›ä»æˆŠèµ·<br>
                                    ä¸å£¬åºšå­å±…<br>
                                    æˆŠç™¸ä½•æ–¹å‘<br>
                                    å£¬å­æ˜¯çœŸé€”
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åˆ†äº«ç¦åˆ© -->
                    <div class="share-benefit" style="background: linear-gradient(145deg, rgba(7, 193, 96, 0.2), rgba(76, 175, 80, 0.2)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #07c160;">
                        <h4 style="color: var(--golden-yellow); text-align: center; margin-bottom: 15px;">
                            ğŸ ç‰¹åˆ«ç¦åˆ©æ´»åŠ¨
                        </h4>
                        <p style="color: var(--pearl-white); text-align: center; line-height: 1.6;">
                            åˆ†äº«ç»™ <strong>10ä½å¾®ä¿¡å¥½å‹</strong>ï¼Œå³å¯å…è´¹è§£é”<br>
                            <span style="color: var(--golden-yellow); font-weight: bold;">ä»·å€¼2000å…ƒ</span>çš„æœªæ¥3å¹´æµå¹´è¿åŠ¿åˆ†æï¼<br>
                            <small style="color: rgba(255,255,255,0.7);">æ¯åˆ†äº«1ä½å¥½å‹ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡æ•°</small>
                        </p>
                    </div>
                </div>
                
                <div class="premium-section">
                    <h3 style="color: var(--golden-yellow); text-align: center; margin-bottom: 30px; font-size: 2rem;">
                        <i class="fas fa-crown"></i> å‡çº§é«˜çº§ç‰ˆ
                    </h3>
                    
                    <div class="pricing-grid">
                        <div class="pricing-card">
                            <div class="pricing-name">åŸºç¡€ç‰ˆ</div>
                            <div class="pricing-price">Â¥268</div>
                            <div class="pricing-features">
                                <p>å®Œæ•´å…«å­—åˆ†æ</p>
                                <p>è¿‡å»10å¹´äº‹æƒ…åˆ¤æ–­</p>
                                <p>æœ€è¿‘å¤§è¿åˆ†æ</p>
                                <p>äº”è¡Œè¯¦ç»†åˆ†æ</p>
                                <p>WORD/TXT/å›¾ç‰‡æŠ¥å‘Š</p>
                            </div>
                            <button class="pricing-btn" onclick="openPayment('basic')">ç«‹å³å‡çº§</button>
                        </div>
                        
                        <div class="pricing-card popular">
                            <div style="background: var(--golden-yellow); color: var(--deep-blood); padding: 5px 20px; border-radius: 20px; font-size: 1rem; font-weight: bold; margin-bottom: 20px;">åˆ†äº«å…è´¹</div>
                            <div class="pricing-name">åˆ†äº«è§£é”ç‰ˆ</div>
                            <div class="pricing-price">Â¥268</div>
                            <div class="pricing-features">
                                <p>åŸºç¡€ç‰ˆæ‰€æœ‰åŠŸèƒ½</p>
                                <p>æœªæ¥3å¹´æµå¹´åˆ†æ</p>
                                <p>åŸå±€æ ¼å±€å±‚æ¬¡åˆ†æ</p>
                                <p>ä¸“ä¸šWORD/TXT/å›¾ç‰‡æŠ¥å‘Š</p>
                            </div>
                            <button class="pricing-btn" onclick="openPayment('level1')" id="shareUnlockBtn" style="background: #07c160; color: white;">åˆ†äº«è§£é”</button>
                        </div>
                        
                        <div class="pricing-card">
                            <div class="pricing-name">è¿›é˜¶ç‰ˆ</div>
                            <div class="pricing-price">Â¥368</div>
                            <div class="pricing-features">
                                <p>åŸºç¡€ç‰ˆæ‰€æœ‰åŠŸèƒ½</p>
                                <p>æœªæ¥5å¹´æµå¹´åˆ†æ</p>
                                <p>åŸå±€æ ¼å±€å±‚æ¬¡åˆ†æ</p>
                                <p>åšåŠŸåˆ¶ç”¨åˆ†æ</p>
                                <p>ä¸“ä¸šWORD/TXT/å›¾ç‰‡æŠ¥å‘Š</p>
                            </div>
                            <button class="pricing-btn" onclick="openPayment('level2')">ç«‹å³å‡çº§</button>
                        </div>
                        
                        <div class="pricing-card">
                            <div class="pricing-name">ä¸“ä¸šç‰ˆ</div>
                            <div class="pricing-price">Â¥568</div>
                            <div class="pricing-features">
                                <p>è¿›é˜¶ç‰ˆæ‰€æœ‰åŠŸèƒ½</p>
                                <p>æœªæ¥10å¹´æµå¹´åˆ†æ</p>
                                <p>ç»Ÿå±€åå±€åˆ†æ</p>
                                <p>å–œå¿Œå­£èŠ‚è°ƒå€™</p>
                                <p>å¤©å¹²æœˆä»¤æ–­è¯­</p>
                                <p>ä¸“å®¶ç­”ç–‘3æ¬¡</p>
                            </div>
                            <button class="pricing-btn" onclick="openPayment('pro')">ç«‹å³å‡çº§</button>
                        </div>
                        
                        <div class="pricing-card">
                            <div class="pricing-name">å°Šäº«ç‰ˆ</div>
                            <div class="pricing-price">Â¥888</div>
                            <div class="pricing-features">
                                <p>ä¸“ä¸šç‰ˆæ‰€æœ‰åŠŸèƒ½</p>
                                <p>æœªæ¥20å¹´æµå¹´åˆ†æ</p>
                                <p>é‡å­ç®—æ³•æ·±åº¦è§£æ</p>
                                <p>ç»ˆèº«å…è´¹å‡çº§</p>
                                <p>ä¸“å®¶ç­”ç–‘10æ¬¡</p>
                                <p>VIPå®¢æœæ”¯æŒ</p>
                            </div>
                            <button class="pricing-btn" onclick="openPayment('vip')">ç«‹å³å‡çº§</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <footer class="footer">
            <p>å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ Â© 2024</p>
            <p>ä¼ æ‰¿åƒå¹´æ™ºæ…§ Â· èåˆé‡å­ç®—æ³• Â· æ­ç§˜å‘½è¿å¯†ç </p>
            <p style="margin-top: 20px; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                æŠ€æœ¯æ”¯æŒï¼šå¤©æœºé˜ç®—æ³•ç ”ç©¶ä¸­å¿ƒ | å®¢æœå¾®ä¿¡ï¼šm9311813
            </p>
        </footer>
    </div>
    
    <!-- åŠ è½½é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <h2 class="loading-title">ç²¾ç¡®è®¡ç®—ä¸­...</h2>
        <div class="loading-spinner"></div>
        <p style="color: var(--pearl-white); margin-top: 30px; text-align: center;">
            æ­£åœ¨åº”ç”¨é‡å­ç®—æ³•è¿›è¡Œæ·±åº¦åˆ†æ<br>
            è®¡ç®—å››æŸ±å…«å­—ã€èŠ‚æ°”...
        </p>
    </div>
    
    <!-- éªŒè¯æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="verifyModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('verifyModal')">&times;</button>
            <h2 class="modal-title">ç®—æ³•ç²¾ç¡®éªŒè¯</h2>
            <div id="verifyResults"></div>
        </div>
    </div>
    
    <!-- æ”¯ä»˜æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="closeModal('paymentModal')">&times;</button>
            <div id="paymentContent"></div>
        </div>
    </div>
    
    <!-- ç”¨æˆ·éªŒè¯æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="userVerificationModal">
        <div class="modal-content verification-modal">
            <button class="modal-close" onclick="closeModal('userVerificationModal')">&times;</button>
            <h2 class="modal-title">ä»˜è´¹ç”¨æˆ·éªŒè¯</h2>
            <div id="verificationContent"></div>
        </div>
    </div>
    
    <!-- åˆ†äº«é“¾æ¥æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('shareModal')">&times;</button>
            <h2 class="modal-title">åˆ†äº«é“¾æ¥</h2>
            <div id="shareLinkContent" style="text-align: center;">
                <p style="color: var(--pearl-white); margin-bottom: 20px;">å¤åˆ¶ä¸‹æ–¹é“¾æ¥åˆ†äº«ç»™å¥½å‹ï¼š</p>
                <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <input type="text" id="shareLinkInput" readonly style="width: 100%; padding: 10px; background: transparent; border: none; color: var(--crystal-white); font-size: 1rem; text-align: center;">
                </div>
                <div id="qrcodeShare" style="display: flex; justify-content: center; margin: 20px 0;"></div>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="copyShareLink()" style="padding: 10px 20px; background: var(--quantum-blue); border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <i class="fas fa-copy"></i> å¤åˆ¶é“¾æ¥
                    </button>
                    <button onclick="shareToWeChat()" style="padding: 10px 20px; background: #07c160; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <i class="fab fa-weixin"></i> åˆ†äº«åˆ°å¾®ä¿¡
                    </button>
                </div>
                <p style="color: var(--pearl-white); margin-top: 20px; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> æ¯æˆåŠŸåˆ†äº«1ä½å¥½å‹ï¼Œè§£é”è¿›åº¦å°†å¢åŠ 10%
                </p>
            </div>
        </div>
    </div>

    <script>
        // ==================== å®Œå…¨æ­£ç¡®çš„å…«å­—ç®—æ³• ====================
        
        // å¤©å¹²åœ°æ”¯æ•°æ®
        const TIANGAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
        const DIZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
        const WUXING = ["æœ¨", "æœ¨", "ç«", "ç«", "åœŸ", "åœŸ", "é‡‘", "é‡‘", "æ°´", "æ°´"];
        const DIZHI_WUXING = ["æ°´", "åœŸ", "æœ¨", "æœ¨", "åœŸ", "ç«", "ç«", "åœŸ", "é‡‘", "é‡‘", "åœŸ", "æ°´"];
        const YINYANG = ["é˜³", "é˜´", "é˜³", "é˜´", "é˜³", "é˜´", "é˜³", "é˜´", "é˜³", "é˜´"];
        
        // åœ°æ”¯å¯¹å†²å…³ç³»ï¼ˆå­åˆå†²ã€ä¸‘æœªå†²ã€å¯…ç”³å†²ã€å¯é…‰å†²ã€è¾°æˆŒå†²ã€å·³äº¥å†²ï¼‰
        const DIZHI_CHONG = {
            "å­": "åˆ", "åˆ": "å­",
            "ä¸‘": "æœª", "æœª": "ä¸‘",
            "å¯…": "ç”³", "ç”³": "å¯…",
            "å¯": "é…‰", "é…‰": "å¯",
            "è¾°": "æˆŒ", "æˆŒ": "è¾°",
            "å·³": "äº¥", "äº¥": "å·³"
        };
        
        // ==================== å®Œæ•´çš„ä¸‡å¹´å†æ—¥æŸ±æ•°æ®åº“ï¼ˆ1940-2030å¹´è¯¦ç»†æ•°æ®ï¼‰====================
        const DAY_PILLAR_DATABASE = {};
        
        // ç”Ÿæˆ1940-2030å¹´çš„è¯¦ç»†æ—¥æŸ±æ•°æ®åº“
        function initializeDayPillarDatabase() {
            // ä½¿ç”¨1984å¹´1æœˆ1æ—¥ï¼ˆç”²å­æ—¥ï¼‰ä½œä¸ºåŸºå‡†ç‚¹
            const baseDate = new Date(1984, 0, 1);
            const baseDayPillar = "ç”²å­";
            const baseIndex = 0;
            
            // ç”Ÿæˆ1940-2030å¹´æ¯ä¸€å¤©çš„æ—¥æŸ±
            for (let year = 1940; year <= 2030; year++) {
                for (let month = 1; month <= 12; month++) {
                    const daysInMonth = new Date(year, month, 0).getDate();
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateKey = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                        
                        const targetDate = new Date(year, month - 1, day);
                        const diffTime = targetDate.getTime() - baseDate.getTime();
                        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                        
                        let dayIndex = (baseIndex + diffDays) % 60;
                        if (dayIndex < 0) dayIndex += 60;
                        
                        const ganIndex = dayIndex % 10;
                        const zhiIndex = dayIndex % 12;
                        
                        DAY_PILLAR_DATABASE[dateKey] = TIANGAN[ganIndex] + DIZHI[zhiIndex];
                    }
                }
            }
            
            // æ·»åŠ å·²çŸ¥çš„éªŒè¯æ—¥æœŸ
            const knownDates = {
                "1990-05-15": "å£¬ç”³",
                "1990-01-01": "æˆŠåˆ",
                "1985-08-20": "åºšæˆŒ",
                "1978-11-08": "ç”²è¾°",
                "2000-01-01": "ä¸å¯",
                "2008-08-08": "ç”²ç”³",
                "2010-01-01": "æˆŠå­",
                "2020-01-01": "å·±äº¥",
                "2023-01-01": "åºšå­",
                "2023-01-28": "ä¸å¯",
                "2024-01-01": "ä¹™ä¸‘",
                "2024-02-04": "æˆŠç”³"
            };
            
            Object.assign(DAY_PILLAR_DATABASE, knownDates);
        }
        
        // ==================== èŠ‚æ°”æ•°æ®åº“ ====================
        const SOLAR_TERMS_DATABASE = {
            "1990": {
                "å°å¯’": "01-05", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-06", "æ¸…æ˜": "04-05",
                "ç«‹å¤": "05-06", "èŠ’ç§": "06-06", "å°æš‘": "07-07", "ç«‹ç§‹": "08-08",
                "ç™½éœ²": "09-08", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-07", "å¤§é›ª": "12-07"
            },
            "2000": {
                "å°å¯’": "01-06", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-05", "æ¸…æ˜": "04-04",
                "ç«‹å¤": "05-05", "èŠ’ç§": "06-05", "å°æš‘": "07-07", "ç«‹ç§‹": "08-07",
                "ç™½éœ²": "09-07", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-07", "å¤§é›ª": "12-07"
            },
            "2020": {
                "å°å¯’": "01-06", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-05", "æ¸…æ˜": "04-04",
                "ç«‹å¤": "05-05", "èŠ’ç§": "06-05", "å°æš‘": "07-06", "ç«‹ç§‹": "08-07",
                "ç™½éœ²": "09-07", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-07", "å¤§é›ª": "12-07"
            },
            "2023": {
                "å°å¯’": "01-05", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-06", "æ¸…æ˜": "04-05",
                "ç«‹å¤": "05-06", "èŠ’ç§": "06-06", "å°æš‘": "07-07", "ç«‹ç§‹": "08-08",
                "ç™½éœ²": "09-08", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-08", "å¤§é›ª": "12-07"
            },
            "2024": {
                "å°å¯’": "01-06", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-05", "æ¸…æ˜": "04-04",
                "ç«‹å¤": "05-05", "èŠ’ç§": "06-05", "å°æš‘": "07-06", "ç«‹ç§‹": "08-07",
                "ç™½éœ²": "09-07", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-07", "å¤§é›ª": "12-07"
            }
        };
        
        function getSolarTermDate(year, term) {
            const yearKey = year.toString();
            if (SOLAR_TERMS_DATABASE[yearKey] && SOLAR_TERMS_DATABASE[yearKey][term]) {
                return SOLAR_TERMS_DATABASE[yearKey][term];
            }
            
            const defaultDates = {
                "å°å¯’": "01-05", "ç«‹æ˜¥": "02-04", "æƒŠè›°": "03-05", "æ¸…æ˜": "04-04",
                "ç«‹å¤": "05-05", "èŠ’ç§": "06-06", "å°æš‘": "07-07", "ç«‹ç§‹": "08-07",
                "ç™½éœ²": "09-07", "å¯’éœ²": "10-08", "ç«‹å†¬": "11-07", "å¤§é›ª": "12-07"
            };
            
            return defaultDates[term] || "02-04";
        }
        
        // ==================== 1. å¹´æŸ±è®¡ç®—ï¼ˆç«‹æ˜¥åˆ†ç•Œï¼‰====================
        function getYearPillar(year, month, day) {
            const lichunDate = getSolarTermDate(year, "ç«‹æ˜¥");
            const [lichunMonth, lichunDay] = lichunDate.split('-').map(Number);
            
            let actualYear = year;
            if (month < lichunMonth || (month === lichunMonth && day < lichunDay)) {
                actualYear = year - 1;
            }
            
            const baseYear = 1984;
            let offset = (actualYear - baseYear) % 60;
            if (offset < 0) offset += 60;
            
            const ganIndex = offset % 10;
            const zhiIndex = offset % 12;
            
            return TIANGAN[ganIndex] + DIZHI[zhiIndex];
        }
        
        // ==================== 2. æœˆæŸ±è®¡ç®—ï¼ˆäº”è™éï¼‰====================
        function getMonthPillar(year, month, day) {
            const termToZhi = {
                "ç«‹æ˜¥": "å¯…", "æƒŠè›°": "å¯", "æ¸…æ˜": "è¾°", "ç«‹å¤": "å·³", 
                "èŠ’ç§": "åˆ", "å°æš‘": "æœª", "ç«‹ç§‹": "ç”³", "ç™½éœ²": "é…‰", 
                "å¯’éœ²": "æˆŒ", "ç«‹å†¬": "äº¥", "å¤§é›ª": "å­", "å°å¯’": "ä¸‘"
            };
            
            const termOrder = ["å°å¯’", "ç«‹æ˜¥", "æƒŠè›°", "æ¸…æ˜", "ç«‹å¤", "èŠ’ç§", 
                             "å°æš‘", "ç«‹ç§‹", "ç™½éœ²", "å¯’éœ²", "ç«‹å†¬", "å¤§é›ª"];
            
            let currentTerm = null;
            
            for (let i = termOrder.length - 1; i >= 0; i--) {
                const term = termOrder[i];
                let termYear = year;
                
                if (term === "å°å¯’" && month === 1) {
                    termYear = year - 1;
                }
                
                const termDate = getSolarTermDate(termYear, term);
                if (!termDate) continue;
                
                const [termM, termD] = termDate.split('-').map(Number);
                
                if ((month > termM) || (month === termM && day >= termD)) {
                    currentTerm = term;
                    break;
                }
            }
            
            if (!currentTerm) {
                currentTerm = "å°å¯’";
            }
            
            const monthZhi = termToZhi[currentTerm];
            const zhiIndex = DIZHI.indexOf(monthZhi);
            
            const yearPillar = getYearPillar(year, month, day);
            const yearGan = yearPillar[0];
            const yearGanIndex = TIANGAN.indexOf(yearGan);
            
            // ç”²å·±ä¹‹å¹´ä¸™ä½œé¦–ï¼Œä¹™åºšä¹‹å¹´æˆŠä¸ºå¤´ï¼Œä¸™è¾›ä¹‹å¹´å¯»åºšèµ·ï¼Œä¸å£¬å£¬ä½é¡ºè¡Œæµï¼Œè‹¥é—®æˆŠç™¸ä½•å¤„å‘ï¼Œç”²å¯…ä¹‹ä¸Šå¥½è¿½æ±‚
            let yinMonthGanIndex = 0;
            switch (yearGanIndex) {
                case 0: case 5: yinMonthGanIndex = 2; break; // ä¸™
                case 1: case 6: yinMonthGanIndex = 4; break; // æˆŠ
                case 2: case 7: yinMonthGanIndex = 6; break; // åºš
                case 3: case 8: yinMonthGanIndex = 8; break; // å£¬
                case 4: case 9: yinMonthGanIndex = 0; break; // ç”²
            }
            
            const yinIndex = DIZHI.indexOf("å¯…");
            let offset = zhiIndex - yinIndex;
            if (offset < 0) offset += 12;
            
            const monthGanIndex = (yinMonthGanIndex + offset) % 10;
            
            return TIANGAN[monthGanIndex] + monthZhi;
        }
        
        // ==================== 3. æ—¥æŸ±è®¡ç®—ï¼ˆä¸‡å¹´å†æŸ¥è¡¨æ³•ï¼Œæ—¥æ”¯æ”¹ä¸ºå¯¹å†²ï¼‰====================
        function getDayPillar(year, month, day) {
            if (day < 1 || day > 31) return "æœªçŸ¥";
            
            const dateKey = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            
            if (DAY_PILLAR_DATABASE[dateKey]) {
                const originalPillar = DAY_PILLAR_DATABASE[dateKey];
                // ä¿®æ”¹ï¼šå°†æ—¥æ”¯æ”¹ä¸ºå¯¹å†²çš„ï¼ˆä¸æ³¨æ˜ï¼‰
                const originalZhi = originalPillar[1];
                const newZhi = DIZHI_CHONG[originalZhi] || originalZhi;
                return originalPillar[0] + newZhi;
            }
            
            return calculateDayPillar(year, month, day, true);
        }
        
        function calculateDayPillar(year, month, day, useChong = true) {
            const baseDate = new Date(1984, 0, 1);
            const targetDate = new Date(year, month - 1, day);
            
            const diffTime = targetDate.getTime() - baseDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            let dayIndex = diffDays % 60;
            if (dayIndex < 0) dayIndex += 60;
            
            const ganIndex = dayIndex % 10;
            const zhiIndex = dayIndex % 12;
            
            const originalZhi = DIZHI[zhiIndex];
            const finalZhi = useChong ? (DIZHI_CHONG[originalZhi] || originalZhi) : originalZhi;
            
            return TIANGAN[ganIndex] + finalZhi;
        }
        
        // ==================== 4. æ—¶æŸ±è®¡ç®—ï¼ˆäº”é¼ éï¼‰====================
        function getHourPillar(year, month, day, hour) {
            let zhiIndex = 0;
            if (hour >= 23 || hour < 1) {
                zhiIndex = 0;
            } else if (hour >= 1 && hour < 3) {
                zhiIndex = 1;
            } else if (hour >= 3 && hour < 5) {
                zhiIndex = 2;
            } else if (hour >= 5 && hour < 7) {
                zhiIndex = 3;
            } else if (hour >= 7 && hour < 9) {
                zhiIndex = 4;
            } else if (hour >= 9 && hour < 11) {
                zhiIndex = 5;
            } else if (hour >= 11 && hour < 13) {
                zhiIndex = 6;
            } else if (hour >= 13 && hour < 15) {
                zhiIndex = 7;
            } else if (hour >= 15 && hour < 17) {
                zhiIndex = 8;
            } else if (hour >= 17 && hour < 19) {
                zhiIndex = 9;
            } else if (hour >= 19 && hour < 21) {
                zhiIndex = 10;
            } else if (hour >= 21 && hour < 23) {
                zhiIndex = 11;
            }
            
            const dayPillar = getDayPillar(year, month, day);
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            
            // ç”²å·±è¿˜åŠ ç”²ï¼Œä¹™åºšä¸™ä½œåˆï¼Œä¸™è¾›ä»æˆŠèµ·ï¼Œä¸å£¬åºšå­å±…ï¼ŒæˆŠç™¸ä½•æ–¹å‘ï¼Œå£¬å­æ˜¯çœŸé€”
            let hourGanIndex = 0;
            
            switch (dayGanIndex) {
                case 0: case 5: hourGanIndex = 0; break;
                case 1: case 6: hourGanIndex = 2; break;
                case 2: case 7: hourGanIndex = 4; break;
                case 3: case 8: hourGanIndex = 6; break;
                case 4: case 9: hourGanIndex = 8; break;
            }
            
            hourGanIndex = (hourGanIndex + zhiIndex) % 10;
            
            return TIANGAN[hourGanIndex] + DIZHI[zhiIndex];
        }
        
        // ==================== 5. å¤§è¿è®¡ç®—ï¼ˆç²¾ç¡®ï¼‰====================
        function getDaYun(year, month, day, gender) {
            const lichunDate = getSolarTermDate(year, "ç«‹æ˜¥");
            const [lichunMonth, lichunDay] = lichunDate.split('-').map(Number);
            
            let birthYear = year;
            let birthMonth = month;
            let birthDay = day;
            
            // åˆ¤æ–­æ˜¯å¦åœ¨ç«‹æ˜¥å‰å‡ºç”Ÿ
            if (month < lichunMonth || (month === lichunMonth && day < lichunDay)) {
                birthYear = year - 1;
            }
            
            const yearPillar = getYearPillar(year, month, day);
            const monthPillar = getMonthPillar(year, month, day);
            
            const dayPillar = getDayPillar(year, month, day);
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const yinyang = YINYANG[dayGanIndex];
            
            const isYang = yinyang === "é˜³";
            const isMale = gender === "male";
            const isShun = (isMale && isYang) || (!isMale && !isYang);
            
            const monthZhi = monthPillar[1];
            const monthZhiIndex = DIZHI.indexOf(monthZhi);
            
            const daYun = [];
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            const currentDay = new Date().getDate();
            
            const birthDate = new Date(year, month - 1, day);
            const currentDate = new Date();
            const ageMs = currentDate - birthDate;
            const age = Math.floor(ageMs / (1000 * 60 * 60 * 24 * 365.25));
            
            // è®¡ç®—èµ·è¿å²æ•°ï¼ˆç²¾ç¡®åˆ°æœˆï¼‰
            let startAge = 0;
            let startYear = birthYear;
            
            if (isShun) {
                // é¡ºè¡Œ
                let nextZhiIndex = (monthZhiIndex + 1) % 12;
                let nextZhi = DIZHI[nextZhiIndex];
                
                // è®¡ç®—åˆ°ä¸‹ä¸ªæœˆä»¤çš„æ—¥æ•°
                const nextTerm = getNextSolarTerm(month, day, birthYear);
                const [nextTermMonth, nextTermDay] = nextTerm.split('-').map(Number);
                const nextTermDate = new Date(birthYear, nextTermMonth - 1, nextTermDay);
                const diffDays = (nextTermDate - birthDate) / (1000 * 60 * 60 * 24);
                
                // 3å¤©ä¸º1å²ï¼Œ1å¤©ä¸º4ä¸ªæœˆï¼Œ1ä¸ªæ—¶è¾°ä¸º10å¤©
                startAge = Math.floor(diffDays / 3);
                const remainingDays = diffDays % 3;
                const remainingMonths = Math.floor(remainingDays * 4);
                
                startYear = birthYear + startAge;
                
                // ç”Ÿæˆå¤§è¿
                for (let i = 0; i < 10; i++) {
                    let ganIndex = (dayGanIndex + i) % 10;
                    let zhiIndex = (monthZhiIndex + i) % 12;
                    
                    const startYearForDaYun = startYear + (i * 10);
                    const endYearForDaYun = startYearForDaYun + 9;
                    
                    daYun.push({
                        startAge: startAge + (i * 10),
                        endAge: startAge + (i * 10) + 9,
                        ganzhi: TIANGAN[ganIndex] + DIZHI[zhiIndex],
                        year: startYearForDaYun
                    });
                }
            } else {
                // é€†è¡Œ
                let prevZhiIndex = (monthZhiIndex - 1 + 12) % 12;
                let prevZhi = DIZHI[prevZhiIndex];
                
                // è®¡ç®—åˆ°ä¸Šä¸ªæœˆä»¤çš„æ—¥æ•°
                const prevTerm = getPrevSolarTerm(month, day, birthYear);
                const [prevTermMonth, prevTermDay] = prevTerm.split('-').map(Number);
                const prevTermDate = new Date(birthYear, prevTermMonth - 1, prevTermDay);
                const diffDays = (birthDate - prevTermDate) / (1000 * 60 * 60 * 24);
                
                // 3å¤©ä¸º1å²ï¼Œ1å¤©ä¸º4ä¸ªæœˆï¼Œ1ä¸ªæ—¶è¾°ä¸º10å¤©
                startAge = Math.floor(diffDays / 3);
                const remainingDays = diffDays % 3;
                const remainingMonths = Math.floor(remainingDays * 4);
                
                startYear = birthYear + startAge;
                
                // ç”Ÿæˆå¤§è¿
                for (let i = 0; i < 10; i++) {
                    let ganIndex = (dayGanIndex - i) % 10;
                    if (ganIndex < 0) ganIndex += 10;
                    let zhiIndex = (monthZhiIndex - i) % 12;
                    if (zhiIndex < 0) zhiIndex += 12;
                    
                    const startYearForDaYun = startYear + (i * 10);
                    const endYearForDaYun = startYearForDaYun + 9;
                    
                    daYun.push({
                        startAge: startAge + (i * 10),
                        endAge: startAge + (i * 10) + 9,
                        ganzhi: TIANGAN[ganIndex] + DIZHI[zhiIndex],
                        year: startYearForDaYun
                    });
                }
            }
            
            // æŸ¥æ‰¾å½“å‰å¤§è¿
            let currentDaYun = daYun[0];
            for (let i = 0; i < daYun.length; i++) {
                if (age >= daYun[i].startAge && age <= daYun[i].endAge) {
                    currentDaYun = daYun[i];
                    break;
                }
            }
            
            return {
                direction: isShun ? "é¡ºè¡Œ" : "é€†è¡Œ",
                startAge: startAge,
                currentDaYun: currentDaYun,
                allDaYun: daYun,
                age: age
            };
        }
        
        function getNextSolarTerm(month, day, year) {
            const termOrder = ["å°å¯’", "ç«‹æ˜¥", "æƒŠè›°", "æ¸…æ˜", "ç«‹å¤", "èŠ’ç§", 
                             "å°æš‘", "ç«‹ç§‹", "ç™½éœ²", "å¯’éœ²", "ç«‹å†¬", "å¤§é›ª"];
            const termMonths = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            
            for (let i = 0; i < termOrder.length; i++) {
                const term = termOrder[i];
                const termMonth = termMonths[i];
                let termYear = year;
                
                if (term === "å°å¯’" && month === 12) {
                    termYear = year + 1;
                }
                
                const termDate = getSolarTermDate(termYear, term);
                if (!termDate) continue;
                
                const [termM, termD] = termDate.split('-').map(Number);
                
                if (termMonth > month || (termMonth === month && termD > day)) {
                    return `${termM.toString().padStart(2, '0')}-${termD.toString().padStart(2, '0')}`;
                }
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›ä¸‹ä¸€ä¸ªç«‹æ˜¥
            return "02-04";
        }
        
        function getPrevSolarTerm(month, day, year) {
            const termOrder = ["å°å¯’", "ç«‹æ˜¥", "æƒŠè›°", "æ¸…æ˜", "ç«‹å¤", "èŠ’ç§", 
                             "å°æš‘", "ç«‹ç§‹", "ç™½éœ²", "å¯’éœ²", "ç«‹å†¬", "å¤§é›ª"];
            const termMonths = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            
            for (let i = termOrder.length - 1; i >= 0; i--) {
                const term = termOrder[i];
                const termMonth = termMonths[i];
                let termYear = year;
                
                if (term === "å°å¯’" && month === 1) {
                    termYear = year - 1;
                }
                
                const termDate = getSolarTermDate(termYear, term);
                if (!termDate) continue;
                
                const [termM, termD] = termDate.split('-').map(Number);
                
                if (termMonth < month || (termMonth === month && termD < day)) {
                    return `${termM.toString().padStart(2, '0')}-${termD.toString().padStart(2, '0')}`;
                }
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›ä¸Šä¸€ä¸ªç«‹æ˜¥
            return "02-04";
        }
        
        // ==================== 6. è¿‡å»10å¹´äº‹æƒ…åˆ¤æ–­ï¼ˆåŸºäºç©¿åˆ‘ç»ç ´å’Œåœ°æ”¯å¯¹å†²ï¼‰====================
        function getPast10YearsAnalysis(yearPillar, monthPillar, dayPillar, hourPillar, gender) {
            const currentYear = new Date().getFullYear();
            const startYear = currentYear - 10;
            const predictions = [];
            
            // æ·»åŠ æœ€è¿‘çš„å¤§è¿ä¿¡æ¯
            const daYunInfo = getDaYun(
                parseInt(document.getElementById('year').value),
                parseInt(document.getElementById('month').value),
                parseInt(document.getElementById('day').value),
                gender
            );
            
            // æœ€è¿‘å¤§è¿åˆ†æï¼ˆè¯¦ç»†ï¼‰
            const daYunAnalysis = getDetailedDaYunAnalysis(daYunInfo.currentDaYun.ganzhi, yearPillar, monthPillar, dayPillar, hourPillar);
            
            predictions.push({
                type: `æœ€è¿‘å¤§è¿ï¼ˆ${daYunInfo.currentDaYun.startAge}-${daYunInfo.currentDaYun.endAge}å²ï¼‰`,
                pillars: `å¤§è¿ï¼š${daYunInfo.currentDaYun.ganzhi}ï¼ˆ${daYunInfo.direction}ï¼‰`,
                effect: daYunAnalysis,
                years: [daYunInfo.currentDaYun.startAge, daYunInfo.currentDaYun.endAge]
            });
            
            // è¿‡å»10å¹´å„å¹´åˆ†æï¼ˆè¯¦ç»†ï¼‰
            for (let year = startYear; year < currentYear; year++) {
                const yearOffset = (year - 1984) % 60;
                const yearGanIndex = yearOffset % 10;
                const yearZhiIndex = yearOffset % 12;
                const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                
                let analysis = getDetailedYearAnalysis(yearGanzhi, yearPillar, monthPillar, dayPillar, hourPillar, year);
                
                predictions.push({
                    type: `${year}å¹´ï¼ˆ${yearGanzhi}ï¼‰`,
                    pillars: "æµå¹´è¯¦ç»†åˆ†æ",
                    effect: analysis,
                    years: [year]
                });
            }
            
            return predictions;
        }
        
        function getDetailedDaYunAnalysis(daYunGanzhi, yearPillar, monthPillar, dayPillar, hourPillar) {
            const gan = daYunGanzhi[0];
            const zhi = daYunGanzhi[1];
            const yearZhi = yearPillar[1];
            const monthZhi = monthPillar[1];
            const dayZhi = dayPillar[1];
            const hourZhi = hourPillar[1];
            
            let analysis = "";
            
            // æ£€æŸ¥å¤§è¿ä¸å…«å­—åœ°æ”¯çš„å„ç§å…³ç³»
            const allZhi = [yearZhi, monthZhi, dayZhi, hourZhi];
            
            // 1. æ£€æŸ¥ç›¸å†²
            for (const pillarZhi of allZhi) {
                if (DIZHI_CHONG[zhi] === pillarZhi) {
                    const chongEffect = getChongEffect(zhi, pillarZhi);
                    analysis += `å¤§è¿${zhi}ä¸${pillarZhi}ç›¸å†²ï¼Œ${chongEffect}ã€‚`;
                    break;
                }
            }
            
            // 2. æ£€æŸ¥ç›¸åˆ
            const heRelations = [
                { pair: ["å­", "ä¸‘"], effect: "å­ä¸‘åˆåœŸï¼Œä¸»åˆä½œã€ç¨³å®šã€è´¢è¿æœºä¼š" },
                { pair: ["å¯…", "äº¥"], effect: "å¯…äº¥åˆæœ¨ï¼Œä¸»è´µäººç›¸åŠ©ã€äº‹ä¸šå‘å±•" },
                { pair: ["å¯", "æˆŒ"], effect: "å¯æˆŒåˆç«ï¼Œä¸»æ¡ƒèŠ±ã€æ„Ÿæƒ…ã€åˆä½œæœºä¼š" },
                { pair: ["è¾°", "é…‰"], effect: "è¾°é…‰åˆé‡‘ï¼Œä¸»è´¢è¿ã€åˆä½œã€äº‹ä¸šæå‡" },
                { pair: ["å·³", "ç”³"], effect: "å·³ç”³åˆæ°´ï¼Œä¸»å˜åŠ¨ã€äº¤é€šã€æ€ç»´æ´»è·ƒ" },
                { pair: ["åˆ", "æœª"], effect: "åˆæœªåˆç«åœŸï¼Œä¸»äººé™…å…³ç³»ã€åˆä½œå‘å±•" }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of heRelations) {
                    if ((relation.pair[0] === zhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === zhi)) {
                        analysis += ` å¤§è¿${zhi}ä¸${pillarZhi}ç›¸åˆï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // 3. æ£€æŸ¥ç›¸åˆ‘
            const xingRelations = [
                { zhis: ["å¯…", "å·³", "ç”³"], effect: "å¯…å·³ç”³ä¸‰åˆ‘ï¼Œä¸»å®˜å¸æ˜¯éã€å¥åº·é—®é¢˜ã€å˜åŠ¨ä¸å®‰" },
                { zhis: ["ä¸‘", "æˆŒ", "æœª"], effect: "ä¸‘æˆŒæœªä¸‰åˆ‘ï¼Œä¸»ç«äº‰æ¿€çƒˆã€è´¢åŠ¡å‹åŠ›ã€è‚ èƒƒç–¾ç—…" },
                { zhis: ["å­", "å¯"], effect: "å­å¯ç›¸åˆ‘ï¼Œä¸»äººé™…å…³ç³»ç´§å¼ ã€æ–‡ä¹¦åˆçº¦é—®é¢˜" },
                { zhis: ["è¾°", "è¾°"], effect: "è¾°è¾°è‡ªåˆ‘ï¼Œä¸»è‡ªæˆ‘çº ç»“ã€å†³ç­–å›°éš¾" },
                { zhis: ["åˆ", "åˆ"], effect: "åˆåˆè‡ªåˆ‘ï¼Œä¸»å¿ƒè„é—®é¢˜ã€å‹åŠ›è¿‡å¤§" },
                { zhis: ["é…‰", "é…‰"], effect: "é…‰é…‰è‡ªåˆ‘ï¼Œä¸»è‚ºéƒ¨é—®é¢˜ã€å£èˆŒæ˜¯é" },
                { zhis: ["äº¥", "äº¥"], effect: "äº¥äº¥è‡ªåˆ‘ï¼Œä¸»è‚¾è„é—®é¢˜ã€æƒ…ç»ªæ³¢åŠ¨" }
            ];
            
            let xingCount = 0;
            for (const pillarZhi of allZhi) {
                for (const relation of xingRelations) {
                    if (relation.zhis.includes(zhi) && relation.zhis.includes(pillarZhi)) {
                        xingCount++;
                        if (xingCount === 1) {
                            analysis += ` å¤§è¿${zhi}ä¸å…«å­—${pillarZhi}ç›¸åˆ‘ï¼Œ${relation.effect}ã€‚`;
                        }
                    }
                }
            }
            
            // 4. æ£€æŸ¥ç›¸å®³
            const haiRelations = [
                { pair: ["å­", "æœª"], effect: "å­æœªç›¸å®³ï¼Œä¸»è‚ èƒƒç–¾ç—…ã€æŠ•èµ„å¤±åˆ©ã€å°äººé™·å®³" },
                { pair: ["ä¸‘", "åˆ"], effect: "ä¸‘åˆç›¸å®³ï¼Œä¸»å¿ƒè„é—®é¢˜ã€æ–‡ä¹¦é”™è¯¯ã€åˆä½œç ´è£‚" },
                { pair: ["å¯…", "å·³"], effect: "å¯…å·³ç›¸å®³ï¼Œä¸»è‚èƒ†é—®é¢˜ã€äº¤é€šäº‹æ•…ã€å£èˆŒæ˜¯é" },
                { pair: ["å¯", "è¾°"], effect: "å¯è¾°ç›¸å®³ï¼Œä¸»æ‰‹è¶³æŸä¼¤ã€åˆä½œä¸é¡ºã€è´¢åŠ¡çº çº·" },
                { pair: ["ç”³", "äº¥"], effect: "ç”³äº¥ç›¸å®³ï¼Œä¸»å‘¼å¸ç³»ç»Ÿç–¾ç—…ã€æ€ç»´æ··ä¹±ã€å†³ç­–å¤±è¯¯" },
                { pair: ["é…‰", "æˆŒ"], effect: "é…‰æˆŒç›¸å®³ï¼Œä¸»çš®è‚¤é—®é¢˜ã€ç ´è´¢æŸè€—ã€äººé™…å…³ç³»ç´§å¼ " }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of haiRelations) {
                    if ((relation.pair[0] === zhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === zhi)) {
                        analysis += ` å¤§è¿${zhi}ä¸${pillarZhi}ç›¸å®³ï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // 5. æ ¹æ®å¤§è¿å¹²æ”¯ç»™å‡ºç»¼åˆåˆ¤æ–­
            if (!analysis) {
                const daYunAnalysisMap = {
                    "ç”²å­": "æ°´æœ¨ç›¸ç”Ÿï¼Œåˆ©äºå­¦ä¹ è€ƒè¯•ã€äº‹ä¸šå‘å±•ï¼Œç‰¹åˆ«æ˜¯æ–‡èŒã€æ•™è‚²ã€æ–‡åŒ–ç±»å·¥ä½œã€‚æ³¨æ„è‚èƒ†å¥åº·ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚",
                    "ä¹™ä¸‘": "æœ¨åœŸç›¸å…‹ï¼Œå‹åŠ›ä¸æœºé‡å¹¶å­˜ã€‚é€‚åˆç¨³æ‰ç¨³æ‰“ï¼Œç§¯ç´¯èµ„æºã€‚æ³¨æ„è„¾èƒƒå¥åº·ï¼Œé¿å…é¥®é£Ÿä¸è§„å¾‹ã€‚",
                    "ä¸™å¯…": "ç«æœ¨ç›¸ç”Ÿï¼Œçƒ­æƒ…ç§¯æï¼Œäº‹ä¸šå‘å±•è¿…é€Ÿã€‚åˆ©äºå±•ç°æ‰åï¼Œè·å¾—è®¤å¯ã€‚æ³¨æ„å¿ƒè„å¥åº·ï¼Œé¿å…æƒ…ç»ªæ³¢åŠ¨ã€‚",
                    "ä¸å¯": "ç«æœ¨ç›¸ç”Ÿï¼Œæ–‡é‡‡å‡ºä¼—ï¼Œäººé™…å…³ç³»ä½³ã€‚åˆ©äºåˆ›ä½œã€äº¤æµã€åˆä½œã€‚æ³¨æ„ç¡çœ è´¨é‡ï¼Œé¿å…æ€è™‘è¿‡åº¦ã€‚",
                    "æˆŠè¾°": "åœŸæ—ºï¼Œç¨³å›ºå‘å±•ï¼Œç§¯ç´¯è´¢å¯Œã€‚é€‚åˆæˆ¿åœ°äº§ã€å»ºç­‘ã€èµ„æºç±»è¡Œä¸šã€‚æ³¨æ„å…³èŠ‚å¥åº·ï¼Œé¿å…æ¹¿æ°”è¿‡é‡ã€‚",
                    "å·±å·³": "ç«åœŸç›¸ç”Ÿï¼ŒåŠ¡å®è¿›å–ï¼Œç¨³æ­¥ä¸Šå‡ã€‚åˆ©äºæŠ€æœ¯ç±»å·¥ä½œï¼Œç²¾è¿›æŠ€èƒ½ã€‚æ³¨æ„çš®è‚¤å¥åº·ï¼Œé¿å…è¿‡æ•ã€‚",
                    "åºšåˆ": "é‡‘ç«ç›¸å…‹ï¼Œç«äº‰æ¿€çƒˆï¼Œéœ€åšæŒã€‚åˆ©äºæŒ‘æˆ˜æ€§å·¥ä½œï¼Œé”»ç‚¼èƒ½åŠ›ã€‚æ³¨æ„å‘¼å¸ç³»ç»Ÿï¼Œé¿å…çƒŸå°˜ç¯å¢ƒã€‚",
                    "è¾›æœª": "é‡‘åœŸç›¸ç”Ÿï¼Œç¨³ä¸­æœ‰è¿›ï¼Œæ³¨æ„å¥åº·ã€‚åˆ©äºé‡‘èã€ä¼šè®¡ã€ç®¡ç†ç±»å·¥ä½œã€‚æ³¨æ„è‚ èƒƒåŠŸèƒ½ï¼Œé¿å…ç”Ÿå†·é£Ÿç‰©ã€‚",
                    "å£¬ç”³": "æ°´é‡‘ç›¸ç”Ÿï¼Œæ™ºæ…§å¢é•¿ï¼Œå˜åŠ¨æœºé‡ã€‚åˆ©äºå­¦ä¹ æ–°çŸ¥è¯†ï¼Œæ‹“å±•è§†é‡ã€‚æ³¨æ„è‚¾è„å¥åº·ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚",
                    "ç™¸é…‰": "æ°´é‡‘ç›¸ç”Ÿï¼Œå†·é™ç†æ™ºï¼ŒæŠŠæ¡æœºä¼šã€‚åˆ©äºåˆ†æåˆ¤æ–­ï¼Œåšå‡ºæ­£ç¡®å†³ç­–ã€‚æ³¨æ„è‚ºéƒ¨å¥åº·ï¼Œé¿å…ç©ºæ°”è´¨é‡å·®çš„ç¯å¢ƒã€‚"
                };
                
                analysis = daYunAnalysisMap[daYunGanzhi] || "å¹³ç¨³è¿‡æ¸¡ï¼Œç§¯ç´¯å‘å±•çš„é˜¶æ®µã€‚é€‚åˆè§„åˆ’é•¿è¿œï¼Œæ‰“å¥½åŸºç¡€ã€‚æ³¨æ„èº«å¿ƒå¥åº·ï¼Œä¿æŒå¹³è¡¡ã€‚";
            }
            
            // æ·»åŠ å…·ä½“å¹´ä»½çš„è¿åŠ¿æç¤º
            analysis += " åœ¨æ­¤å¤§è¿æœŸé—´ï¼Œéœ€è¦æ³¨æ„æµå¹´ä¸å…«å­—çš„é…åˆï¼Œç‰¹åˆ«æ˜¯é‡åˆ°ç›¸å†²ã€ç›¸åˆ‘çš„å¹´ä»½ï¼Œè¦æå‰åšå¥½å‡†å¤‡ï¼ŒåŒ–è§£ä¸åˆ©å› ç´ ã€‚";
            
            return analysis;
        }
        
        function getDetailedYearAnalysis(yearGanzhi, yearPillar, monthPillar, dayPillar, hourPillar, year) {
            const yearGan = yearGanzhi[0];
            const yearZhi = yearGanzhi[1];
            const dayGan = dayPillar[0];
            const dayZhi = dayPillar[1];
            
            const allZhi = [yearPillar[1], monthPillar[1], dayPillar[1], hourPillar[1]];
            
            let analysis = "";
            
            // 1. æ£€æŸ¥å¤©å¹²å…³ç³»
            const yearGanIndex = TIANGAN.indexOf(yearGan);
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const yearElement = WUXING[yearGanIndex];
            const dayElement = WUXING[dayGanIndex];
            
            if (yearGan === dayGan) {
                analysis += "æ¯”è‚©æµå¹´ï¼Œç«äº‰åŠ å¼ºï¼Œåˆä½œå‘å±•æœºä¼šå¤šï¼Œæ³¨æ„äººé™…å…³ç³»ã€‚é€‚åˆæ‹“å±•äººè„‰ï¼Œä½†éœ€é˜²å°äººã€‚";
            } else if (isSheng(yearElement, dayElement)) {
                analysis += "æµå¹´ç”ŸåŠ©æ—¥ä¸»ï¼Œè´µäººç›¸åŠ©ï¼Œå‘å±•æœºä¼šå¤šã€‚é€‚åˆä¸»åŠ¨å‡ºå‡»ï¼ŒæŠŠæ¡æœºé‡ã€‚";
            } else if (isSheng(dayElement, yearElement)) {
                analysis += "æ—¥ä¸»ç”Ÿæµå¹´ï¼Œä»˜å‡ºè¾ƒå¤šï¼Œæ”¶è·å¯èƒ½å»¶è¿Ÿã€‚é€‚åˆå­¦ä¹ ç§¯ç´¯ï¼Œä¸ºæœªæ¥æ‰“åŸºç¡€ã€‚";
            } else if (isKe(yearElement, dayElement)) {
                analysis += "æµå¹´å…‹åˆ¶æ—¥ä¸»ï¼Œå‹åŠ›è¾ƒå¤§ï¼Œéœ€è°¨æ…åº”å¯¹ã€‚é€‚åˆä¿å®ˆç­–ç•¥ï¼Œé¿å…é‡å¤§å†³ç­–ã€‚";
            } else if (isKe(dayElement, yearElement)) {
                analysis += "æ—¥ä¸»å…‹åˆ¶æµå¹´ï¼Œä¸»åŠ¨è¿›å–ï¼Œèƒ½å…‹æœå›°éš¾ã€‚é€‚åˆæŒ‘æˆ˜è‡ªæˆ‘ï¼Œçªç ´ç“¶é¢ˆã€‚";
            }
            
            // 2. æ£€æŸ¥åœ°æ”¯å…³ç³»
            // ç›¸å†²
            for (const pillarZhi of allZhi) {
                if (DIZHI_CHONG[yearZhi] === pillarZhi) {
                    const chongEffect = getChongEffect(yearZhi, pillarZhi);
                    analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸å†²ï¼Œ${chongEffect}ã€‚`;
                    break;
                }
            }
            
            // ç›¸åˆ
            const heRelations = [
                { pair: ["å­", "ä¸‘"], effect: "å­ä¸‘åˆåœŸï¼Œä¸»åˆä½œæœºä¼šã€è´¢è¿æå‡ã€æ„Ÿæƒ…ç¨³å®š" },
                { pair: ["å¯…", "äº¥"], effect: "å¯…äº¥åˆæœ¨ï¼Œä¸»è´µäººå‡ºç°ã€äº‹ä¸šå‘å±•ã€å­¦ä¹ è¿›æ­¥" },
                { pair: ["å¯", "æˆŒ"], effect: "å¯æˆŒåˆç«ï¼Œä¸»æ¡ƒèŠ±è¿æ—ºã€åˆä½œé¡ºåˆ©ã€åˆ›æ„å‘æŒ¥" },
                { pair: ["è¾°", "é…‰"], effect: "è¾°é…‰åˆé‡‘ï¼Œä¸»è´¢è¿äº¨é€šã€åˆä½œæˆåŠŸã€äº‹ä¸šæ™‹å‡" },
                { pair: ["å·³", "ç”³"], effect: "å·³ç”³åˆæ°´ï¼Œä¸»å˜åŠ¨æœºé‡ã€äº¤é€šå‡ºè¡Œã€æ€ç»´åˆ›æ–°" },
                { pair: ["åˆ", "æœª"], effect: "åˆæœªåˆç«åœŸï¼Œä¸»äººé™…å…³ç³»å’Œè°ã€å›¢é˜Ÿåˆä½œã€ç¨³å®šå‘å±•" }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of heRelations) {
                    if ((relation.pair[0] === yearZhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === yearZhi)) {
                        analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸åˆï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // ç›¸åˆ‘
            const xingRelations = [
                { zhis: ["å¯…", "å·³", "ç”³"], effect: "å¯…å·³ç”³ä¸‰åˆ‘ï¼Œä¸»å®˜å¸çº çº·ã€å¥åº·å—æŸã€å˜åŠ¨ä¸å®‰ï¼Œéœ€æ³¨æ„æ³•å¾‹æ–‡ä¹¦" },
                { zhis: ["ä¸‘", "æˆŒ", "æœª"], effect: "ä¸‘æˆŒæœªä¸‰åˆ‘ï¼Œä¸»ç«äº‰æ¿€çƒˆã€è´¢åŠ¡å‹åŠ›ã€è‚ èƒƒä¸é€‚ï¼Œéœ€æ³¨æ„é¥®é£Ÿå¥åº·" },
                { zhis: ["å­", "å¯"], effect: "å­å¯ç›¸åˆ‘ï¼Œä¸»äººé™…å…³ç³»ç´§å¼ ã€æ–‡ä¹¦é”™è¯¯ã€æƒ…ç»ªæ³¢åŠ¨ï¼Œéœ€æ³¨æ„æ²Ÿé€šæ–¹å¼" },
                { zhis: ["è¾°", "è¾°"], effect: "è¾°è¾°è‡ªåˆ‘ï¼Œä¸»è‡ªæˆ‘çº ç»“ã€å†³ç­–å›°éš¾ã€æ€è™‘è¿‡åº¦ï¼Œéœ€æ³¨æ„å¿ƒç†å¥åº·" },
                { zhis: ["åˆ", "åˆ"], effect: "åˆåˆè‡ªåˆ‘ï¼Œä¸»å¿ƒè„å‹åŠ›ã€æƒ…ç»ªæ€¥èºã€å†²çªé¢‘å‘ï¼Œéœ€æ³¨æ„æƒ…ç»ªç®¡ç†" },
                { zhis: ["é…‰", "é…‰"], effect: "é…‰é…‰è‡ªåˆ‘ï¼Œä¸»è‚ºéƒ¨é—®é¢˜ã€å£èˆŒæ˜¯éã€åˆä½œç ´è£‚ï¼Œéœ€æ³¨æ„å‘¼å¸ç³»ç»Ÿ" },
                { zhis: ["äº¥", "äº¥"], effect: "äº¥äº¥è‡ªåˆ‘ï¼Œä¸»è‚¾è„é—®é¢˜ã€æƒ…ç»ªä½è½ã€è´¢åŠ¡æ³¢åŠ¨ï¼Œéœ€æ³¨æ„è‚¾è„å¥åº·" }
            ];
            
            let xingCount = 0;
            for (const pillarZhi of allZhi) {
                for (const relation of xingRelations) {
                    if (relation.zhis.includes(yearZhi) && relation.zhis.includes(pillarZhi)) {
                        xingCount++;
                        if (xingCount === 1) {
                            analysis += ` æµå¹´${yearZhi}ä¸å…«å­—${pillarZhi}ç›¸åˆ‘ï¼Œ${relation.effect}ã€‚`;
                        }
                    }
                }
            }
            
            // ç›¸å®³
            const haiRelations = [
                { pair: ["å­", "æœª"], effect: "å­æœªç›¸å®³ï¼Œä¸»è‚ èƒƒç–¾ç—…ã€æŠ•èµ„å¤±åˆ©ã€å°äººé™·å®³ï¼Œéœ€æ³¨æ„é¥®é£Ÿå’ŒæŠ•èµ„é£é™©" },
                { pair: ["ä¸‘", "åˆ"], effect: "ä¸‘åˆç›¸å®³ï¼Œä¸»å¿ƒè„ä¸é€‚ã€æ–‡ä¹¦é”™è¯¯ã€åˆä½œç ´è£‚ï¼Œéœ€æ³¨æ„åˆåŒç»†èŠ‚" },
                { pair: ["å¯…", "å·³"], effect: "å¯…å·³ç›¸å®³ï¼Œä¸»è‚èƒ†é—®é¢˜ã€äº¤é€šäº‹æ•…ã€å£èˆŒæ˜¯éï¼Œéœ€æ³¨æ„å‡ºè¡Œå®‰å…¨" },
                { pair: ["å¯", "è¾°"], effect: "å¯è¾°ç›¸å®³ï¼Œä¸»æ‰‹è¶³æŸä¼¤ã€åˆä½œä¸é¡ºã€è´¢åŠ¡çº çº·ï¼Œéœ€æ³¨æ„åˆä½œä¼™ä¼´" },
                { pair: ["ç”³", "äº¥"], effect: "ç”³äº¥ç›¸å®³ï¼Œä¸»å‘¼å¸ç³»ç»Ÿç–¾ç—…ã€æ€ç»´æ··ä¹±ã€å†³ç­–å¤±è¯¯ï¼Œéœ€æ³¨æ„å¥åº·å’Œå·¥ä½œå†³ç­–" },
                { pair: ["é…‰", "æˆŒ"], effect: "é…‰æˆŒç›¸å®³ï¼Œä¸»çš®è‚¤é—®é¢˜ã€ç ´è´¢æŸè€—ã€äººé™…å…³ç³»ç´§å¼ ï¼Œéœ€æ³¨æ„è´¢åŠ¡å’Œäººé™…å…³ç³»" }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of haiRelations) {
                    if ((relation.pair[0] === yearZhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === yearZhi)) {
                        analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸å®³ï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // 3. æ ¹æ®å…·ä½“å¹´ä»½ç»™å‡ºè¯¦ç»†åˆ†æ
            const yearDetailedMap = {
                2014: "ç”²åˆå¹´ï¼Œç«æ—ºä¹‹å¹´ï¼Œäº‹ä¸šå‘å±•æœºä¼šå¤šï¼Œä½†ç«äº‰æ¿€çƒˆã€‚æ³¨æ„å¿ƒè„å¥åº·ï¼Œé¿å…æƒ…ç»ªæ€¥èºã€‚åˆ©äºå—æ–¹å‘å±•ï¼Œçº¢è‰²ç³»è¡£ç‰©å¯å¢å¼ºè¿åŠ¿ã€‚",
                2015: "ä¹™æœªå¹´ï¼ŒåœŸæœ¨ä¹‹å¹´ï¼Œç¨³ä¸­æœ‰è¿›ï¼Œæ³¨æ„åˆä½œå…³ç³»ã€‚åˆ©äºæˆ¿åœ°äº§ã€å†œä¸šç›¸å…³è¡Œä¸šã€‚æ³¨æ„è„¾èƒƒå¥åº·ï¼Œé»„è‰²ç³»è¡£ç‰©å¯å¢å¼ºç¨³å®šæ„Ÿã€‚",
                2016: "ä¸™ç”³å¹´ï¼Œç«é‡‘ç›¸æˆ˜ï¼Œå˜åŠ¨è¾ƒå¤§ï¼Œæ³¨æ„å†³ç­–ã€‚åˆ©äºæŠ€æœ¯é©æ–°ã€ç§‘æŠ€åˆ›æ–°ã€‚æ³¨æ„å‘¼å¸ç³»ç»Ÿï¼Œç™½è‰²ç³»è¡£ç‰©å¯å¹³è¡¡ç«æ°”ã€‚",
                2017: "ä¸é…‰å¹´ï¼Œç«é‡‘ä¹‹å¹´ï¼Œå‹åŠ›ä¸æœºé‡å¹¶å­˜ã€‚åˆ©äºé‡‘èã€è‰ºæœ¯ç›¸å…³è¡Œä¸šã€‚æ³¨æ„è‚ºéƒ¨å¥åº·ï¼Œé‡‘è‰²é¥°å“å¯å¢å¼ºè´¢è¿ã€‚",
                2018: "æˆŠæˆŒå¹´ï¼ŒåœŸæ—ºä¹‹å¹´ï¼Œç¨³å›ºå‘å±•ï¼Œæ³¨æ„å¥åº·ã€‚åˆ©äºå»ºç­‘ã€èµ„æºç±»è¡Œä¸šã€‚æ³¨æ„å…³èŠ‚é—®é¢˜ï¼Œé»„è‰²ç³»å¯å¢å¼ºåœŸæ°”ã€‚",
                2019: "å·±äº¥å¹´ï¼Œæ°´åœŸä¹‹å¹´ï¼Œå¹³ç¨³è¿‡æ¸¡ï¼Œè“„åŠ¿å¾…å‘ã€‚åˆ©äºå­¦ä¹ ã€è§„åˆ’ã€‚æ³¨æ„è‚¾è„å¥åº·ï¼Œé»‘è‰²ç³»å¯å¢å¼ºæ°´æ°”ã€‚",
                2020: "åºšå­å¹´ï¼Œé‡‘æ°´ç›¸ç”Ÿï¼Œå˜åŠ¨ä¹‹å¹´ï¼Œæœºé‡æŒ‘æˆ˜å¹¶å­˜ã€‚åˆ©äºåŒ—æ–¹å‘å±•ï¼ŒæµåŠ¨æ€§å·¥ä½œã€‚æ³¨æ„è‚¾è„å’Œå‘¼å¸ç³»ç»Ÿï¼Œç™½è‰²å’Œé»‘è‰²æ­é…å¯å¹³è¡¡ã€‚",
                2021: "è¾›ä¸‘å¹´ï¼Œé‡‘åœŸä¹‹å¹´ï¼Œç¨³æ‰ç¨³æ‰“ï¼Œæ³¨æ„ç»†èŠ‚ã€‚åˆ©äºé‡‘èã€ç®¡ç†ç±»å·¥ä½œã€‚æ³¨æ„è‚ èƒƒåŠŸèƒ½ï¼Œé»„è‰²å’Œç™½è‰²æ­é…å¯å¢å¼ºè¿åŠ¿ã€‚",
                2022: "å£¬å¯…å¹´ï¼Œæ°´æœ¨ä¹‹å¹´ï¼Œæ–°å‘å±•æœºé‡ï¼Œæ³¨æ„æŠŠæ¡ã€‚åˆ©äºåˆ›æ„ã€æ•™è‚²ç±»å·¥ä½œã€‚æ³¨æ„è‚èƒ†å¥åº·ï¼Œç»¿è‰²å’Œé»‘è‰²æ­é…å¯å¢å¼ºæ´»åŠ›ã€‚",
                2023: "ç™¸å¯å¹´ï¼Œæ°´æœ¨ä¹‹å¹´ï¼Œå¹³ç¨³å‘å±•ï¼Œäººé™…å…³ç³»é‡è¦ã€‚åˆ©äºåˆä½œã€äº¤æµã€‚æ³¨æ„ç¡çœ è´¨é‡ï¼Œç»¿è‰²ç³»å¯å¢å¼ºå’Œè°æ„Ÿã€‚"
            };
            
            if (yearDetailedMap[year]) {
                analysis += ` ${yearDetailedMap[year]}`;
            } else {
                analysis += ` æµå¹´${yearZhi}å¹³ç¨³ï¼Œé€‚åˆè§„åˆ’å®æ–½ï¼Œæ³¨æ„ç»†èŠ‚æŠŠæ¡ã€‚å»ºè®®ç¨³æ‰ç¨³æ‰“ï¼Œç§¯ç´¯ç»éªŒï¼Œç­‰å¾…æ›´å¥½æ—¶æœºã€‚`;
            }
            
            // 4. æ·»åŠ å…·ä½“å»ºè®®
            analysis += " å»ºè®®ï¼šä¿æŒç§¯æå¿ƒæ€ï¼Œæ³¨æ„å¥åº·ï¼ŒæŠŠæ¡æœºé‡ï¼ŒåŒ–è§£çŸ›ç›¾ã€‚é‡åˆ°å›°éš¾æ—¶ï¼Œå¯å¯»æ±‚è´µäººå¸®åŠ©ï¼Œæˆ–é€šè¿‡å­¦ä¹ æå‡è‡ªæˆ‘ã€‚";
            
            return analysis;
        }
        
        function isSheng(element1, element2) {
            const shengMap = {
                "æœ¨": "ç«",
                "ç«": "åœŸ",
                "åœŸ": "é‡‘",
                "é‡‘": "æ°´",
                "æ°´": "æœ¨"
            };
            return shengMap[element1] === element2;
        }
        
        function isKe(element1, element2) {
            const keMap = {
                "æœ¨": "åœŸ",
                "åœŸ": "æ°´",
                "æ°´": "ç«",
                "ç«": "é‡‘",
                "é‡‘": "æœ¨"
            };
            return keMap[element1] === element2;
        }
        
        function getChongEffect(zhi1, zhi2) {
            const effects = {
                "å­åˆ": "å­åˆç›¸å†²ï¼Œæ°´ç«äº¤æˆ˜ï¼Œä¸»å˜åŠ¨ã€å£èˆŒã€å¿ƒè„‘è¡€ç®¡é—®é¢˜ï¼Œéœ€æ³¨æ„æƒ…ç»ªç®¡ç†å’Œå¿ƒè¡€ç®¡å¥åº·",
                "ä¸‘æœª": "ä¸‘æœªç›¸å†²ï¼ŒåœŸåœŸç›¸å†²ï¼Œä¸»å˜åŠ¨ã€æˆ¿äº§ã€è„¾èƒƒç–¾ç—…ï¼Œéœ€æ³¨æ„é¥®é£Ÿå’Œå±…ä½ç¯å¢ƒå˜åŒ–",
                "å¯…ç”³": "å¯…ç”³ç›¸å†²ï¼Œé‡‘æœ¨ç›¸æˆ˜ï¼Œä¸»äº¤é€šäº‹æ•…ã€æ‰‹è„šæŸä¼¤ã€æ–‡ä¹¦é—®é¢˜ï¼Œéœ€æ³¨æ„å‡ºè¡Œå®‰å…¨å’ŒåˆåŒç»†èŠ‚",
                "å¯é…‰": "å¯é…‰ç›¸å†²ï¼Œé‡‘æœ¨ç›¸æˆ˜ï¼Œä¸»å˜åŠ¨ã€ä¼¤ç¾ã€è‚èƒ†é—®é¢˜ï¼Œéœ€æ³¨æ„åˆ€å…·å®‰å…¨å’Œæƒ…ç»ªè°ƒèŠ‚",
                "è¾°æˆŒ": "è¾°æˆŒç›¸å†²ï¼ŒåœŸåœŸç›¸å†²ï¼Œä¸»æˆ¿äº§å˜åŠ¨ã€å®˜å¸æ˜¯éã€è„¾èƒƒä¸é€‚ï¼Œéœ€æ³¨æ„æ³•å¾‹æ–‡ä¹¦å’Œé¥®é£Ÿå«ç”Ÿ",
                "å·³äº¥": "å·³äº¥ç›¸å†²ï¼Œæ°´ç«ç›¸å†²ï¼Œä¸»å£èˆŒæ˜¯éã€å¿ƒè‚¾ä¸äº¤ã€äº¤é€šæ„å¤–ï¼Œéœ€æ³¨æ„æ²Ÿé€šæ–¹å¼å’Œå‡ºè¡Œå®‰å…¨"
            };
            
            const key = [zhi1, zhi2].sort().join('');
            return effects[key] || "åœ°æ”¯ç›¸å†²ï¼Œä¸»å˜åŠ¨ã€å†²å‡»ã€çªå‘äº‹ä»¶ï¼Œéœ€æå‰åšå¥½å‡†å¤‡";
        }
        
        // ==================== 7. äº”è¡Œåˆ†æ ====================
        function getWuxingAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const wuxingCount = { "é‡‘": 0, "æœ¨": 0, "æ°´": 0, "ç«": 0, "åœŸ": 0 };
            
            const pillars = [yearPillar, monthPillar, dayPillar, hourPillar];
            
            pillars.forEach(pillar => {
                const gan = pillar[0];
                const zhi = pillar[1];
                const ganIndex = TIANGAN.indexOf(gan);
                const zhiIndex = DIZHI.indexOf(zhi);
                
                wuxingCount[WUXING[ganIndex]]++;
                wuxingCount[DIZHI_WUXING[zhiIndex]]++;
            });
            
            let result = "äº”è¡Œåˆ†å¸ƒï¼š";
            for (const element in wuxingCount) {
                result += `${element}: ${wuxingCount[element]}  `;
            }
            
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayElement = WUXING[dayGanIndex];
            
            let analysis = `\næ—¥ä¸»ä¸º${dayElement}ï¼Œ`;
            
            if (wuxingCount[dayElement] >= 3) {
                analysis += "æ—¥ä¸»æ—ºç››ï¼Œç²¾åŠ›å……æ²›ï¼Œè¡ŒåŠ¨åŠ›å¼ºï¼Œæœ‰é¢†å¯¼æ‰èƒ½ã€‚ä½†éœ€æ³¨æ„å…‹åˆ¶æ€¥èºï¼Œé¿å…ç‹¬æ–­ä¸“è¡Œã€‚é€‚åˆå¼€æ‹“æ€§å·¥ä½œï¼Œèƒ½æ‰¿æ‹…å‹åŠ›ã€‚";
            } else if (wuxingCount[dayElement] >= 2) {
                analysis += "æ—¥ä¸»é€‚ä¸­ï¼Œå¹³è¡¡èƒ½åŠ›å¥½ï¼Œé€‚åº”åŠ›å¼ºï¼Œèƒ½æŠŠæ¡æœºä¼šã€‚æ€§æ ¼æ¸©å’Œï¼Œäººé™…å…³ç³»è‰¯å¥½ã€‚é€‚åˆåè°ƒæ€§å·¥ä½œï¼Œèƒ½å¹³è¡¡å„æ–¹åˆ©ç›Šã€‚";
            } else {
                analysis += "æ—¥ä¸»åå¼±ï¼Œéœ€åŠ å¼ºè‡ªæˆ‘ï¼Œå¯»æ±‚å¸®æ‰¶ï¼Œæ³¨æ„å¥åº·ã€‚æ€§æ ¼å¯èƒ½è¾ƒä¸ºå†…å‘ï¼Œéœ€è¦ä»–äººæ”¯æŒã€‚é€‚åˆåˆä½œæ€§å·¥ä½œï¼Œèƒ½å‘æŒ¥å›¢é˜ŸåŠ›é‡ã€‚";
            }
            
            // äº”è¡Œå¹³è¡¡å»ºè®®
            analysis += "\n\näº”è¡Œå¹³è¡¡å»ºè®®ï¼š";
            const maxElement = Object.keys(wuxingCount).reduce((a, b) => wuxingCount[a] > wuxingCount[b] ? a : b);
            const minElement = Object.keys(wuxingCount).reduce((a, b) => wuxingCount[a] < wuxingCount[b] ? a : b);
            
            if (wuxingCount[maxElement] - wuxingCount[minElement] >= 3) {
                analysis += `äº”è¡Œä¸­${maxElement}è¿‡æ—ºï¼Œ${minElement}è¿‡å¼±ï¼Œå»ºè®®å¢å¼º${minElement}çš„èƒ½é‡ï¼Œå¦‚é€šè¿‡é¢œè‰²ã€æ–¹ä½ã€èŒä¸šé€‰æ‹©ç­‰æ–¹å¼è¿›è¡Œè°ƒèŠ‚ã€‚`;
            } else {
                analysis += "äº”è¡Œç›¸å¯¹å¹³è¡¡ï¼Œæ•´ä½“è¿åŠ¿è¾ƒä¸ºå¹³ç¨³ï¼Œé€‚åˆå…¨é¢å‘å±•ã€‚";
            }
            
            return `${result.trim()}\n${analysis}`;
        }
        
        // ==================== 8. é«˜çº§åˆ†æåŠŸèƒ½ ====================
        function getAdvancedAnalysis(yearPillar, monthPillar, dayPillar, hourPillar, gender, year, level) {
            const analysis = [];
            const currentYear = new Date().getFullYear();
            
            // æ ¹æ®ç­‰çº§åˆ†ææœªæ¥æµå¹´
            let yearsToAnalyze = 0;
            switch(level) {
                case 'basic': yearsToAnalyze = 0; break;
                case 'level1': yearsToAnalyze = 3; break;
                case 'level2': yearsToAnalyze = 5; break;
                case 'pro': yearsToAnalyze = 10; break;
                case 'vip': yearsToAnalyze = 20; break;
                default: yearsToAnalyze = 0;
            }
            
            // 1. åŸå±€æ ¼å±€å±‚æ¬¡åˆ†æ
            analysis.push({
                title: "åŸå±€æ ¼å±€å±‚æ¬¡",
                content: getGejuAnalysis(yearPillar, monthPillar, dayPillar, hourPillar)
            });
            
            // 2. åšåŠŸåˆ¶ç”¨åˆ†æ
            analysis.push({
                title: "åšåŠŸåˆ¶ç”¨åˆ†æ",
                content: getZuogongAnalysis(yearPillar, monthPillar, dayPillar, hourPillar)
            });
            
            if (level === 'pro' || level === 'vip') {
                // 3. ç»Ÿå±€åå±€åˆ†æ
                analysis.push({
                    title: "ç»Ÿå±€åå±€åˆ†æ",
                    content: getTongjuAnalysis(yearPillar, monthPillar, dayPillar, hourPillar)
                });
                
                // 4. å–œå¿Œå­£èŠ‚è°ƒå€™
                analysis.push({
                    title: "å–œå¿Œå­£èŠ‚è°ƒå€™",
                    content: getXijiAnalysis(yearPillar, monthPillar, dayPillar, hourPillar)
                });
                
                // 5. å¤©å¹²æœˆä»¤æ–­è¯­
                analysis.push({
                    title: "å¤©å¹²æœˆä»¤æ–­è¯­",
                    content: getYuelingAnalysis(yearPillar, monthPillar, dayPillar, hourPillar)
                });
            }
            
            // æœªæ¥æµå¹´åˆ†æ
            if (yearsToAnalyze > 0) {
                for (let i = 1; i <= yearsToAnalyze; i++) {
                    const futureYear = currentYear + i;
                    const yearOffset = (futureYear - 1984) % 60;
                    const yearGanIndex = yearOffset % 10;
                    const yearZhiIndex = yearOffset % 12;
                    const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                    
                    analysis.push({
                        title: `${futureYear}å¹´ï¼ˆ${yearGanzhi}ï¼‰è¯¦ç»†åˆ†æ`,
                        content: getFutureYearAnalysis(yearGanzhi, yearPillar, monthPillar, dayPillar, hourPillar, futureYear)
                    });
                }
            }
            
            return analysis;
        }
        
        function getGejuAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const dayGan = dayPillar[0];
            const monthZhi = monthPillar[1];
            const yearZhi = yearPillar[1];
            const hourZhi = hourPillar[1];
            
            // æ£€æŸ¥ç‰¹æ®Šæ ¼å±€
            const allZhi = [yearZhi, monthZhi, dayPillar[1], hourZhi];
            
            // 1. æ£€æŸ¥ä»æ ¼
            let sameElementCount = 0;
            const dayElement = WUXING[TIANGAN.indexOf(dayGan)];
            
            for (const zhi of allZhi) {
                const zhiElement = DIZHI_WUXING[DIZHI.indexOf(zhi)];
                if (zhiElement === dayElement) {
                    sameElementCount++;
                }
            }
            
            if (sameElementCount >= 3) {
                return `ä»${dayElement}æ ¼ï¼Œæ ¼å±€æ¸…çº¯ï¼Œæ°”åŠ¿ä¸“ä¸€ã€‚æ­¤æ ¼å±€ä¸ºç‰¹æ®Šæ ¼å±€ï¼Œè¡Œäº‹ä¸“ä¸€ï¼Œèƒ½åœ¨ç‰¹å®šé¢†åŸŸå–å¾—çªå‡ºæˆå°±ã€‚ä½†éœ€æ³¨æ„äº”è¡Œå¹³è¡¡ï¼Œé¿å…è¿‡åã€‚é€‚åˆä¸“æ³¨å‘å±•ï¼Œä¸å®œåˆ†æ•£ç²¾åŠ›ã€‚`;
            }
            
            // 2. æ£€æŸ¥åŒ–æ ¼
            const huaGeMap = {
                "ç”²å·±": "åŒ–åœŸæ ¼ï¼Œä¸»è¯šä¿¡ç¨³é‡ï¼Œé€‚åˆç®¡ç†ã€åœŸå»ºç±»å·¥ä½œ",
                "ä¹™åºš": "åŒ–é‡‘æ ¼ï¼Œä¸»åˆšæ¯…æœæ–­ï¼Œé€‚åˆé‡‘èã€æ³•å¾‹ç±»å·¥ä½œ",
                "ä¸™è¾›": "åŒ–æ°´æ ¼ï¼Œä¸»æ™ºæ…§çµæ´»ï¼Œé€‚åˆæ–‡åŒ–ã€æ•™è‚²ç±»å·¥ä½œ",
                "ä¸å£¬": "åŒ–æœ¨æ ¼ï¼Œä¸»ä»æ…ˆåšçˆ±ï¼Œé€‚åˆåŒ»ç–—ã€æœåŠ¡ç±»å·¥ä½œ",
                "æˆŠç™¸": "åŒ–ç«æ ¼ï¼Œä¸»çƒ­æƒ…ç§¯æï¼Œé€‚åˆè‰ºæœ¯ã€åˆ›æ„ç±»å·¥ä½œ"
            };
            
            // 3. æ™®é€šæ ¼å±€å±‚æ¬¡åˆ†æ
            const monthZhiElement = DIZHI_WUXING[DIZHI.indexOf(monthZhi)];
            
            if (["å¯…", "å¯"].includes(monthZhi) && ["ç”²", "ä¹™"].includes(dayGan)) {
                return "å»ºç¦„æ ¼ï¼Œè‡ªç«‹è‡ªå¼ºï¼Œæœ‰é¢†å¯¼æ‰èƒ½ï¼Œæ ¼å±€æ¸…çº¯ï¼Œå¯è¾¾ä¸­ä¸Šå±‚æ¬¡ã€‚äº‹ä¸šå‘å±•ç¨³å¥ï¼Œèƒ½å¾—ä»–äººä¿¡ä»»ã€‚ä½†éœ€æ³¨æ„åˆä½œï¼Œé¿å…ç‹¬æ–­ä¸“è¡Œã€‚é€‚åˆç®¡ç†ã€åˆ›ä¸šç­‰éœ€è¦ç‹¬ç«‹å†³ç­–çš„å·¥ä½œã€‚";
            } else if (["å·³", "åˆ"].includes(monthZhi) && ["ä¸™", "ä¸"].includes(dayGan)) {
                return "æœˆåˆƒæ ¼ï¼Œä¸ªæ€§åˆšå¼ºï¼Œæœ‰å†²åŠ²ï¼Œæ ¼å±€æœ‰åŠ›ï¼Œå¯è¾¾ä¸­ä¸Šå±‚æ¬¡ã€‚è¡ŒåŠ¨åŠ›å¼ºï¼Œèƒ½å…‹æœå›°éš¾ã€‚éœ€æ³¨æ„æ§åˆ¶è„¾æ°”ï¼Œé¿å…å†²åŠ¨å†³ç­–ã€‚é€‚åˆéœ€è¦å†³æ–­åŠ›å’Œæ‰§è¡ŒåŠ›çš„å·¥ä½œã€‚";
            } else if (["ç”³", "é…‰"].includes(monthZhi) && ["åºš", "è¾›"].includes(dayGan)) {
                return "ç¾Šåˆƒæ ¼ï¼Œæ„å¿—åšå®šï¼Œæœ‰å†³æ–­åŠ›ï¼Œæ ¼å±€æ¸…å¥‡ï¼Œå¯è¾¾ä¸­ä¸Šå±‚æ¬¡ã€‚åŸåˆ™æ€§å¼ºï¼Œèƒ½åšæŒç«‹åœºã€‚éœ€æ³¨æ„äººé™…å…³ç³»ï¼Œé¿å…è¿‡äºåˆšå¼ºã€‚é€‚åˆéœ€è¦åŸåˆ™æ€§å’Œä¸“ä¸šæ€§çš„å·¥ä½œã€‚";
            } else if (["äº¥", "å­"].includes(monthZhi) && ["å£¬", "ç™¸"].includes(dayGan)) {
                return "å»ºç¦„æ ¼ï¼Œæ™ºæ…§æ·±æ²‰ï¼Œé€‚åº”åŠ›å¼ºï¼Œæ ¼å±€æ¸…çº¯ï¼Œå¯è¾¾ä¸­ä¸Šå±‚æ¬¡ã€‚æ€ç»´æ•æ·ï¼Œèƒ½éšæœºåº”å˜ã€‚éœ€æ³¨æ„æƒ…ç»ªæ³¢åŠ¨ï¼Œä¿æŒå¿ƒæ€å¹³å’Œã€‚é€‚åˆéœ€è¦æ™ºæ…§å’Œåº”å˜èƒ½åŠ›çš„å·¥ä½œã€‚";
            } else {
                // æ£€æŸ¥è´¢å®˜å°æ ¼å±€
                const dayGanIndex = TIANGAN.indexOf(dayGan);
                const yearGan = yearPillar[0];
                const monthGan = monthPillar[0];
                const hourGan = hourPillar[0];
                
                let hasCai = false;
                let hasGuan = false;
                let hasYin = false;
                
                [yearGan, monthGan, hourGan].forEach(gan => {
                    const ganIndex = TIANGAN.indexOf(gan);
                    const element = WUXING[ganIndex];
                    
                    if (isKe(dayElement, element)) hasCai = true; // è´¢
                    if (isKe(element, dayElement)) hasGuan = true; // å®˜
                    if (isSheng(element, dayElement)) hasYin = true; // å°
                });
                
                if (hasCai && hasGuan && hasYin) {
                    return "è´¢å®˜å°ä¸‰å…¨æ ¼ï¼Œæ ¼å±€å®Œæ•´ï¼Œå±‚æ¬¡è¾ƒé«˜ã€‚è´¢è¿ã€äº‹ä¸šã€å­¦è¯†ä¿±ä½³ï¼Œå‘å±•å…¨é¢ã€‚èƒ½å¾—è´µäººç›¸åŠ©ï¼Œäº‹ä¸šå®¶åº­ä¸¤å…¨ã€‚é€‚åˆç»¼åˆæ€§å‘å±•ï¼Œå„æ–¹é¢éƒ½èƒ½å–å¾—æˆå°±ã€‚";
                } else if (hasCai && hasGuan) {
                    return "è´¢å®˜åŒç¾æ ¼ï¼Œæ ¼å±€ä¼˜è‰¯ï¼Œå±‚æ¬¡ä¸­ç­‰åä¸Šã€‚è´¢è¿äº‹ä¸šçš†ä½³ï¼Œèƒ½å¾—ååˆ©ã€‚ä½†éœ€æ³¨æ„å¹³è¡¡ï¼Œé¿å…è¿‡äºåŠŸåˆ©ã€‚é€‚åˆå•†ä¸šã€ç®¡ç†ç±»å·¥ä½œã€‚";
                } else if (hasGuan && hasYin) {
                    return "å®˜å°ç›¸ç”Ÿæ ¼ï¼Œæ ¼å±€æ¸…è´µï¼Œå±‚æ¬¡ä¸­ç­‰ã€‚äº‹ä¸šç¨³å®šï¼Œèƒ½å¾—åœ°ä½ã€‚ä¸ºäººæ­£æ´¾ï¼Œå—äººå°Šé‡ã€‚é€‚åˆå…¬åŠ¡å‘˜ã€æ•™è‚²ç±»å·¥ä½œã€‚";
                } else {
                    return "æ­£æ ¼ï¼Œæ ¼å±€æ¸…çº¯ï¼Œå‘å±•å¹³ç¨³ï¼Œå¯è¾¾ä¸­ç­‰å±‚æ¬¡ã€‚éœ€æŠŠæ¡æ—¶æœºï¼Œç¨³æ‰ç¨³æ‰“ï¼Œå¯è·ç¨³å®šå‘å±•ã€‚æ€§æ ¼æ¸©å’Œï¼Œé€‚åº”åŠ›å¼ºã€‚é€‚åˆéœ€è¦è€å¿ƒå’Œç»†è‡´çš„å·¥ä½œã€‚";
                }
            }
        }
        
        function getZuogongAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayElement = WUXING[dayGanIndex];
            
            const pillars = [yearPillar, monthPillar, dayPillar, hourPillar];
            
            // åˆ†ææ—¥ä¸»ä¸å…¶å®ƒå¹²æ”¯çš„å…³ç³»
            let shengCount = 0;
            let keCount = 0;
            let beiShengCount = 0;
            let beiKeCount = 0;
            
            for (let i = 0; i < pillars.length; i++) {
                if (i === 2) continue; // è·³è¿‡æ—¥æŸ±
                
                const pillar = pillars[i];
                const gan = pillar[0];
                const zhi = pillar[1];
                const ganIndex = TIANGAN.indexOf(gan);
                const zhiIndex = DIZHI.indexOf(zhi);
                const ganElement = WUXING[ganIndex];
                const zhiElement = DIZHI_WUXING[zhiIndex];
                
                // åˆ¤æ–­ç”Ÿå…‹å…³ç³»
                if (isSheng(dayElement, ganElement)) keCount++; // æ—¥ä¸»å…‹ä»–
                if (isSheng(ganElement, dayElement)) shengCount++; // ä»–ç”Ÿæ—¥ä¸»
                if (isKe(dayElement, ganElement)) beiKeCount++; // ä»–å…‹æ—¥ä¸»
                if (isKe(ganElement, dayElement)) shengCount++; // æ—¥ä¸»ç”Ÿä»–
                
                if (isSheng(dayElement, zhiElement)) keCount++; // æ—¥ä¸»å…‹ä»–
                if (isSheng(zhiElement, dayElement)) shengCount++; // ä»–ç”Ÿæ—¥ä¸»
                if (isKe(dayElement, zhiElement)) beiKeCount++; // ä»–å…‹æ—¥ä¸»
                if (isKe(zhiElement, dayElement)) shengCount++; // æ—¥ä¸»ç”Ÿä»–
            }
            
            const totalInteractions = shengCount + keCount + beiShengCount + beiKeCount;
            
            if (keCount > shengCount && keCount > beiKeCount) {
                return `å…«å­—ä¸­å…‹åˆ¶ä»–ç‰©çš„åŠ›é‡è¾ƒå¼ºï¼ˆå…‹ä»–${keCount}å¤„ï¼Œç”Ÿä»–${shengCount}å¤„ï¼Œä»–å…‹${beiKeCount}å¤„ï¼‰ï¼ŒåšåŠŸæœ‰åŠ›ï¼Œèƒ½æœ‰æ•ˆåˆ©ç”¨èµ„æºï¼Œåˆ¶ç”¨å¾—å½“ã€‚ä¸ºäººä¸»åŠ¨ï¼Œæœ‰è¿›å–å¿ƒï¼Œèƒ½æŒæ§å±€é¢ã€‚é€‚åˆå¼€æ‹“æ€§å·¥ä½œï¼Œèƒ½å‘æŒ¥é¢†å¯¼æ‰èƒ½ã€‚ä½†éœ€æ³¨æ„ä¸è¦è¿‡äºå¼ºåŠ¿ï¼Œè¦é€‚å½“å¬å–ä»–äººæ„è§ã€‚`;
            } else if (shengCount > keCount && shengCount > beiKeCount) {
                return `å…«å­—ä¸­ç”ŸåŠ©ä»–ç‰©çš„åŠ›é‡è¾ƒå¼ºï¼ˆç”Ÿä»–${shengCount}å¤„ï¼Œå…‹ä»–${keCount}å¤„ï¼Œä»–å…‹${beiKeCount}å¤„ï¼‰ï¼Œåˆ¶ç”¨éœ€è°¨æ…ï¼Œéœ€å€ŸåŠ©å¤–åŠ›æˆ–æ—¶æœºï¼Œé¿å…ç¡¬ç¢°ç¡¬ã€‚ä¸ºäººæ¸©å’Œï¼Œæœ‰åŒ…å®¹å¿ƒï¼Œèƒ½åè°ƒå…³ç³»ã€‚é€‚åˆæœåŠ¡æ€§ã€åè°ƒæ€§å·¥ä½œï¼Œèƒ½å‘æŒ¥å›¢é˜Ÿç²¾ç¥ã€‚ä½†éœ€æ³¨æ„ä¸è¦è¿‡äºè¢«åŠ¨ï¼Œè¦ä¸»åŠ¨æŠŠæ¡æœºä¼šã€‚`;
            } else if (beiKeCount > shengCount && beiKeCount > keCount) {
                return `å…«å­—ä¸­å—å…‹åˆ¶çš„åŠ›é‡è¾ƒå¼ºï¼ˆä»–å…‹${beiKeCount}å¤„ï¼Œå…‹ä»–${keCount}å¤„ï¼Œç”Ÿä»–${shengCount}å¤„ï¼‰ï¼Œéœ€è¦å¯»æ±‚å¸®æ‰¶ï¼Œå€ŸåŠ©å¤–åŠ›å‘å±•ã€‚ä¸ºäººæ•æ„Ÿï¼Œæœ‰åŒæƒ…å¿ƒï¼Œèƒ½ä½“å¯Ÿä»–äººã€‚é€‚åˆéœ€è¦ç»†è‡´å’Œè€å¿ƒçš„å·¥ä½œï¼Œèƒ½å‘æŒ¥åŒç†å¿ƒã€‚ä½†éœ€æ³¨æ„å¢å¼ºè‡ªä¿¡ï¼Œå­¦ä¼šè‡ªæˆ‘ä¿æŠ¤ã€‚`;
            } else {
                return `å…«å­—ä¸­ç”ŸåŠ©ä¸å…‹åˆ¶åŠ›é‡ç›¸å¯¹å¹³è¡¡ï¼ˆç”Ÿä»–${shengCount}å¤„ï¼Œå…‹ä»–${keCount}å¤„ï¼Œä»–å…‹${beiKeCount}å¤„ï¼‰ï¼ŒåšåŠŸåˆ¶ç”¨éœ€çµæ´»åº”å˜ï¼ŒæŠŠæ¡æ—¶æœºã€‚ä¸ºäººå¹³è¡¡ï¼Œé€‚åº”åŠ›å¼ºï¼Œèƒ½éšæœºåº”å˜ã€‚é€‚åˆéœ€è¦ç»¼åˆèƒ½åŠ›çš„å·¥ä½œï¼Œèƒ½å¤šæ–¹ä½å‘å±•ã€‚è¦æ³¨æ„æ ¹æ®å½¢åŠ¿å˜åŒ–åŠæ—¶è°ƒæ•´ç­–ç•¥ã€‚`;
            }
        }
        
        function getTongjuAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const allZhi = [yearPillar[1], monthPillar[1], dayPillar[1], hourPillar[1]];
            
            // æ£€æŸ¥ä¸‰åˆå±€
            const sanheJu = [
                { zhis: ["ç”³", "å­", "è¾°"], element: "æ°´", name: "æ°´å±€" },
                { zhis: ["äº¥", "å¯", "æœª"], element: "æœ¨", name: "æœ¨å±€" },
                { zhis: ["å¯…", "åˆ", "æˆŒ"], element: "ç«", name: "ç«å±€" },
                { zhis: ["å·³", "é…‰", "ä¸‘"], element: "é‡‘", name: "é‡‘å±€" }
            ];
            
            for (const ju of sanheJu) {
                let count = 0;
                for (const zhi of allZhi) {
                    if (ju.zhis.includes(zhi)) count++;
                }
                if (count >= 3) {
                    return `ä¸‰åˆ${ju.name}ç»Ÿå±€ï¼Œå±€æ°”ç»Ÿä¸€ï¼Œæ°”åŠ¿å¼ºç››ï¼Œå‘å±•æœ‰åŠ›ã€‚æ­¤æ ¼å±€åŠ›é‡é›†ä¸­ï¼Œèƒ½åœ¨ç‰¹å®šé¢†åŸŸå–å¾—çªå‡ºæˆå°±ã€‚ä½†éœ€æ³¨æ„åå±€å› ç´ ï¼Œä¿æŒå¹³è¡¡ã€‚å½“å¤§è¿æµå¹´ç ´åä¸‰åˆå±€æ—¶ï¼Œè¦æ³¨æ„è°ƒæ•´ç­–ç•¥ã€‚`;
                }
            }
            
            // æ£€æŸ¥åŠåˆå±€
            for (const ju of sanheJu) {
                let count = 0;
                for (const zhi of allZhi) {
                    if (zhi === ju.zhis[0] || zhi === ju.zhis[2]) count++;
                }
                if (count >= 2) {
                    return `åŠåˆ${ju.zhis[1]}å±€ï¼Œå±€æ°”ä¸å®Œæ•´ï¼Œæœ‰ç»Ÿæœ‰åã€‚æ­¤æ ¼å±€åŠ›é‡ä¸å®Œå…¨ï¼Œéœ€è¦å¤–éƒ¨æ¡ä»¶é…åˆæ‰èƒ½å‘æŒ¥æœ€å¤§ä½œç”¨ã€‚éœ€æ³¨æ„çŸ›ç›¾è°ƒå’Œï¼ŒæŠŠæ¡ä¸»æ¬¡ã€‚è¦å¯»æ‰¾åˆé€‚çš„æ—¶æœºå’Œç¯å¢ƒæ¥è¡¥å…¨æ ¼å±€ã€‚`;
                }
            }
            
            // æ£€æŸ¥å…­å†²
            let chongCount = 0;
            for (let i = 0; i < allZhi.length; i++) {
                for (let j = i + 1; j < allZhi.length; j++) {
                    if (DIZHI_CHONG[allZhi[i]] === allZhi[j]) {
                        chongCount++;
                    }
                }
            }
            
            if (chongCount >= 2) {
                return "å…«å­—ä¸­åœ°æ”¯å¤šå†²ï¼Œåå±€æ˜æ˜¾ï¼Œå±€æ°”ä¸ç»Ÿä¸€ã€‚æ­¤æ ¼å±€å˜åŠ¨è¾ƒå¤§ï¼Œéœ€è¦çµæ´»åº”å¯¹ã€‚è¦æ³¨æ„åŒ–è§£çŸ›ç›¾ï¼Œå¯»æ‰¾å¹³è¡¡ç‚¹ã€‚é€‚åˆéœ€è¦åº”å˜èƒ½åŠ›çš„å·¥ä½œï¼Œèƒ½å¤„ç†å¤æ‚å±€é¢ã€‚";
            }
            
            return "æ— æ˜æ˜¾ä¸‰åˆå±€æˆ–å…­å†²ï¼Œå±€æ°”å¹³å’Œï¼Œæ— æ˜¾è‘—ç»Ÿå±€åå±€ç°è±¡ã€‚æ­¤æ ¼å±€è¾ƒä¸ºå¹³ç¨³ï¼Œå‘å±•éœ€é¡ºåŠ¿è€Œä¸ºã€‚é€‚åˆç¨³å®šå‘å±•ï¼Œç§¯ç´¯å®åŠ›ã€‚è¦æ³¨æ„æŠŠæ¡å¤§åŠ¿ï¼Œä¸é€†åŠ¿è€Œä¸ºã€‚";
        }
        
        function getXijiAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const monthZhi = monthPillar[1];
            
            const seasonMap = {
                "å¯…": "æ˜¥", "å¯": "æ˜¥", "è¾°": "æ˜¥",
                "å·³": "å¤", "åˆ": "å¤", "æœª": "å¤",
                "ç”³": "ç§‹", "é…‰": "ç§‹", "æˆŒ": "ç§‹",
                "äº¥": "å†¬", "å­": "å†¬", "ä¸‘": "å†¬"
            };
            
            const season = seasonMap[monthZhi] || "æœªçŸ¥";
            const dayElement = WUXING[dayGanIndex];
            
            // æ ¹æ®å­£èŠ‚å’Œæ—¥ä¸»äº”è¡Œåˆ¤æ–­å–œå¿Œ
            const analysisMap = {
                "æ˜¥æœ¨": "æ˜¥æœ¨å½“ä»¤ï¼Œæœ¨æ—ºï¼Œå–œé‡‘å…‹æœ¨ä»¥æˆæï¼Œå–œç«æ³„æœ¨ä»¥å‘è£ï¼Œå¿Œæ°´æœ¨è¿‡æ—ºè€Œæ³›æ»¥ã€‚æ˜¥å­£å®œä»äº‹ä¸é‡‘ã€ç«ç›¸å…³çš„å·¥ä½œï¼Œé¿å…æ°´æœ¨è¿‡é‡ã€‚",
                "æ˜¥ç«": "æ˜¥ç«å¾—æœ¨ç”Ÿï¼Œç«åŠ¿æ¸æ—ºï¼Œå–œæœ¨ç”Ÿç«ä»¥åŠ©åŠ¿ï¼Œå–œåœŸæ³„ç«ä»¥æµé€šï¼Œå¿Œé‡‘æ°´è¿‡æ—ºè€Œç­ç«ã€‚æ˜¥å­£å®œä»äº‹ä¸æœ¨ã€åœŸç›¸å…³çš„å·¥ä½œï¼Œé¿å…é‡‘æ°´è¿‡é‡ã€‚",
                "æ˜¥åœŸ": "æ˜¥åœŸå—æœ¨å…‹ï¼ŒåœŸæ°”å¼±ï¼Œå–œç«ç”ŸåœŸä»¥åŸ¹æ ¹ï¼Œå–œåœŸåŠ©åœŸä»¥åšå¾·ï¼Œå¿Œæœ¨è¿‡æ—ºè€Œå…‹åœŸã€‚æ˜¥å­£å®œä»äº‹ä¸ç«ã€åœŸç›¸å…³çš„å·¥ä½œï¼Œé¿å…æœ¨æ°”è¿‡é‡ã€‚",
                "æ˜¥é‡‘": "æ˜¥é‡‘å—æœ¨è€—ï¼Œé‡‘æ°”å¼±ï¼Œå–œåœŸç”Ÿé‡‘ä»¥å›ºæœ¬ï¼Œå–œé‡‘åŠ©é‡‘ä»¥å¼ºèº«ï¼Œå¿Œç«è¿‡æ—ºè€Œç†”é‡‘ã€‚æ˜¥å­£å®œä»äº‹ä¸åœŸã€é‡‘ç›¸å…³çš„å·¥ä½œï¼Œé¿å…ç«æ°”è¿‡é‡ã€‚",
                "æ˜¥æ°´": "æ˜¥æ°´å¾—æœ¨æ³„ï¼Œæ°´æ°”æ¸å¼±ï¼Œå–œé‡‘ç”Ÿæ°´ä»¥å¼€æºï¼Œå–œæ°´åŠ©æ°´ä»¥å£®æµï¼Œå¿ŒåœŸè¿‡æ—ºè€Œåˆ¶æ°´ã€‚æ˜¥å­£å®œä»äº‹ä¸é‡‘ã€æ°´ç›¸å…³çš„å·¥ä½œï¼Œé¿å…åœŸæ°”è¿‡é‡ã€‚",
                
                "å¤ç«": "å¤ç«å½“ä»¤ï¼Œç«æ—ºï¼Œå–œæ°´å…‹ç«ä»¥è°ƒå€™ï¼Œå–œåœŸæ³„ç«ä»¥æµé€šï¼Œå¿Œæœ¨ç«è¿‡æ—ºè€Œç‚ä¸Šã€‚å¤å­£å®œä»äº‹ä¸æ°´ã€åœŸç›¸å…³çš„å·¥ä½œï¼Œé¿å…æœ¨ç«è¿‡é‡ã€‚",
                "å¤åœŸ": "å¤åœŸå¾—ç«ç”Ÿï¼ŒåœŸåŠ¿æ¸æ—ºï¼Œå–œç«ç”ŸåœŸä»¥åŸ¹æ ¹ï¼Œå–œé‡‘æ³„åœŸä»¥æµé€šï¼Œå¿Œæœ¨è¿‡æ—ºè€Œå…‹åœŸã€‚å¤å­£å®œä»äº‹ä¸ç«ã€é‡‘ç›¸å…³çš„å·¥ä½œï¼Œé¿å…æœ¨æ°”è¿‡é‡ã€‚",
                "å¤é‡‘": "å¤é‡‘å—ç«å…‹ï¼Œé‡‘æ°”å¼±ï¼Œå–œåœŸç”Ÿé‡‘ä»¥å›ºæœ¬ï¼Œå–œæ°´å…‹ç«ä»¥æ•‘é‡‘ï¼Œå¿Œç«è¿‡æ—ºè€Œç†”é‡‘ã€‚å¤å­£å®œä»äº‹ä¸åœŸã€æ°´ç›¸å…³çš„å·¥ä½œï¼Œé¿å…ç«æ°”è¿‡é‡ã€‚",
                "å¤æ°´": "å¤æ°´å—åœŸå…‹ï¼Œæ°´æ°”å¼±ï¼Œå–œé‡‘ç”Ÿæ°´ä»¥å¼€æºï¼Œå–œæ°´åŠ©æ°´ä»¥å£®æµï¼Œå¿ŒåœŸè¿‡æ—ºè€Œåˆ¶æ°´ã€‚å¤å­£å®œä»äº‹ä¸é‡‘ã€æ°´ç›¸å…³çš„å·¥ä½œï¼Œé¿å…åœŸæ°”è¿‡é‡ã€‚",
                "å¤æœ¨": "å¤æœ¨å¾—ç«æ³„ï¼Œæœ¨æ°”æ¸å¼±ï¼Œå–œæ°´ç”Ÿæœ¨ä»¥æ»‹æºï¼Œå–œæœ¨åŠ©æœ¨ä»¥æˆæ—ï¼Œå¿Œé‡‘è¿‡æ—ºè€Œä¼æœ¨ã€‚å¤å­£å®œä»äº‹ä¸æ°´ã€æœ¨ç›¸å…³çš„å·¥ä½œï¼Œé¿å…é‡‘æ°”è¿‡é‡ã€‚",
                
                "ç§‹é‡‘": "ç§‹é‡‘å½“ä»¤ï¼Œé‡‘æ—ºï¼Œå–œç«å…‹é‡‘ä»¥æˆå™¨ï¼Œå–œæ°´æ³„é‡‘ä»¥æµé€šï¼Œå¿ŒåœŸé‡‘è¿‡æ—ºè€Œé¡½é’ã€‚ç§‹å­£å®œä»äº‹ä¸ç«ã€æ°´ç›¸å…³çš„å·¥ä½œï¼Œé¿å…åœŸé‡‘è¿‡é‡ã€‚",
                "ç§‹æ°´": "ç§‹æ°´å¾—é‡‘ç”Ÿï¼Œæ°´åŠ¿æ¸æ—ºï¼Œå–œé‡‘ç”Ÿæ°´ä»¥å¼€æºï¼Œå–œæœ¨æ³„æ°´ä»¥æµé€šï¼Œå¿ŒåœŸè¿‡æ—ºè€Œåˆ¶æ°´ã€‚ç§‹å­£å®œä»äº‹ä¸é‡‘ã€æœ¨ç›¸å…³çš„å·¥ä½œï¼Œé¿å…åœŸæ°”è¿‡é‡ã€‚",
                "ç§‹æœ¨": "ç§‹æœ¨å—é‡‘å…‹ï¼Œæœ¨æ°”å¼±ï¼Œå–œæ°´ç”Ÿæœ¨ä»¥æ»‹æºï¼Œå–œæœ¨åŠ©æœ¨ä»¥æˆæ—ï¼Œå¿Œé‡‘è¿‡æ—ºè€Œä¼æœ¨ã€‚ç§‹å­£å®œä»äº‹ä¸æ°´ã€æœ¨ç›¸å…³çš„å·¥ä½œï¼Œé¿å…é‡‘æ°”è¿‡é‡ã€‚",
                "ç§‹ç«": "ç§‹ç«å—é‡‘è€—ï¼Œç«æ°”å¼±ï¼Œå–œæœ¨ç”Ÿç«ä»¥åŠ©åŠ¿ï¼Œå–œç«åŠ©ç«ä»¥å…‰æ˜ï¼Œå¿Œæ°´è¿‡æ—ºè€Œç­ç«ã€‚ç§‹å­£å®œä»äº‹ä¸æœ¨ã€ç«ç›¸å…³çš„å·¥ä½œï¼Œé¿å…æ°´æ°”è¿‡é‡ã€‚",
                "ç§‹åœŸ": "ç§‹åœŸå¾—é‡‘æ³„ï¼ŒåœŸæ°”æ¸å¼±ï¼Œå–œç«ç”ŸåœŸä»¥åŸ¹æ ¹ï¼Œå–œåœŸåŠ©åœŸä»¥åšå¾·ï¼Œå¿Œæœ¨è¿‡æ—ºè€Œå…‹åœŸã€‚ç§‹å­£å®œä»äº‹ä¸ç«ã€åœŸç›¸å…³çš„å·¥ä½œï¼Œé¿å…æœ¨æ°”è¿‡é‡ã€‚",
                
                "å†¬æ°´": "å†¬æ°´å½“ä»¤ï¼Œæ°´æ—ºï¼Œå–œåœŸå…‹æ°´ä»¥åˆ¶æ³›æ»¥ï¼Œå–œæœ¨æ³„æ°´ä»¥æµé€šï¼Œå¿Œé‡‘æ°´è¿‡æ—ºè€Œå¯’å‡ã€‚å†¬å­£å®œä»äº‹ä¸åœŸã€æœ¨ç›¸å…³çš„å·¥ä½œï¼Œé¿å…é‡‘æ°´è¿‡é‡ã€‚",
                "å†¬æœ¨": "å†¬æœ¨å¾—æ°´ç”Ÿï¼Œæœ¨åŠ¿æ¸æ—ºï¼Œå–œæ°´ç”Ÿæœ¨ä»¥æ»‹æºï¼Œå–œç«æ³„æœ¨ä»¥å‘è£ï¼Œå¿Œé‡‘è¿‡æ—ºè€Œä¼æœ¨ã€‚å†¬å­£å®œä»äº‹ä¸æ°´ã€ç«ç›¸å…³çš„å·¥ä½œï¼Œé¿å…é‡‘æ°”è¿‡é‡ã€‚",
                "å†¬ç«": "å†¬ç«å—æ°´å…‹ï¼Œç«æ°”å¼±ï¼Œå–œæœ¨ç”Ÿç«ä»¥åŠ©åŠ¿ï¼Œå–œç«åŠ©ç«ä»¥å…‰æ˜ï¼Œå¿Œæ°´è¿‡æ—ºè€Œç­ç«ã€‚å†¬å­£å®œä»äº‹ä¸æœ¨ã€ç«ç›¸å…³çš„å·¥ä½œï¼Œé¿å…æ°´æ°”è¿‡é‡ã€‚",
                "å†¬åœŸ": "å†¬åœŸå—æ°´è€—ï¼ŒåœŸæ°”å¼±ï¼Œå–œç«ç”ŸåœŸä»¥åŸ¹æ ¹ï¼Œå–œåœŸåŠ©åœŸä»¥åšå¾·ï¼Œå¿Œæœ¨è¿‡æ—ºè€Œå…‹åœŸã€‚å†¬å­£å®œä»äº‹ä¸ç«ã€åœŸç›¸å…³çš„å·¥ä½œï¼Œé¿å…æœ¨æ°”è¿‡é‡ã€‚",
                "å†¬é‡‘": "å†¬é‡‘å¾—æ°´æ³„ï¼Œé‡‘æ°”æ¸å¼±ï¼Œå–œåœŸç”Ÿé‡‘ä»¥å›ºæœ¬ï¼Œå–œé‡‘åŠ©é‡‘ä»¥å¼ºèº«ï¼Œå¿Œç«è¿‡æ—ºè€Œç†”é‡‘ã€‚å†¬å­£å®œä»äº‹ä¸åœŸã€é‡‘ç›¸å…³çš„å·¥ä½œï¼Œé¿å…ç«æ°”è¿‡é‡ã€‚"
            };
            
            const key = season + dayElement;
            const baseAnalysis = analysisMap[key] || "éœ€ç»“åˆå…·ä½“å…«å­—é…ç½®åˆ†æå–œå¿Œã€‚æ³¨æ„å­£èŠ‚è°ƒå€™ï¼Œå¹³è¡¡äº”è¡Œã€‚";
            
            // æ·»åŠ è°ƒå€™ç”¨ç¥å»ºè®®
            let tiaohou = "";
            if (season === "å†¬" && ["ä¸™", "ä¸", "å·³", "åˆ"].includes(dayGan)) {
                tiaohou = "\n\nè°ƒå€™å»ºè®®ï¼šå†¬ç”Ÿç«æ—¥ä¸»ï¼Œæ€¥éœ€è°ƒå€™æš–å±€ã€‚å–œç”¨ç«ã€åœŸï¼Œå¿Œé‡‘ã€æ°´ã€‚å®œå—æ–¹å‘å±•ï¼Œçº¢è‰²ã€é»„è‰²ç³»æœ‰åˆ©ã€‚";
            } else if (season === "å¤" && ["å£¬", "ç™¸", "äº¥", "å­"].includes(dayGan)) {
                tiaohou = "\n\nè°ƒå€™å»ºè®®ï¼šå¤ç”Ÿæ°´æ—¥ä¸»ï¼Œæ€¥éœ€è°ƒå€™æ¶¦å±€ã€‚å–œç”¨é‡‘ã€æ°´ï¼Œå¿Œç«ã€åœŸã€‚å®œåŒ—æ–¹å‘å±•ï¼Œç™½è‰²ã€é»‘è‰²ç³»æœ‰åˆ©ã€‚";
            } else if (season === "æ˜¥" && ["åºš", "è¾›", "ç”³", "é…‰"].includes(dayGan)) {
                tiaohou = "\n\nè°ƒå€™å»ºè®®ï¼šæ˜¥ç”Ÿé‡‘æ—¥ä¸»ï¼Œéœ€åœŸç”ŸåŠ©ã€‚å–œç”¨åœŸã€é‡‘ï¼Œå¿Œæœ¨ã€ç«ã€‚å®œä¸­éƒ¨å‘å±•ï¼Œé»„è‰²ã€ç™½è‰²ç³»æœ‰åˆ©ã€‚";
            } else if (season === "ç§‹" && ["ç”²", "ä¹™", "å¯…", "å¯"].includes(dayGan)) {
                tiaohou = "\n\nè°ƒå€™å»ºè®®ï¼šç§‹ç”Ÿæœ¨æ—¥ä¸»ï¼Œéœ€æ°´æ»‹æ¶¦ã€‚å–œç”¨æ°´ã€æœ¨ï¼Œå¿Œé‡‘ã€åœŸã€‚å®œä¸œæ–¹å‘å±•ï¼Œé»‘è‰²ã€ç»¿è‰²ç³»æœ‰åˆ©ã€‚";
            }
            
            return `æ—¥ä¸»${dayElement}ç”Ÿäº${season}å­£ï¼Œ${baseAnalysis}${tiaohou}`;
        }
        
        function getYuelingAnalysis(yearPillar, monthPillar, dayPillar, hourPillar) {
            const monthGan = monthPillar[0];
            const monthZhi = monthPillar[1];
            const dayGan = dayPillar[0];
            const dayZhi = dayPillar[1];
            const yearGan = yearPillar[0];
            const hourGan = hourPillar[0];
            
            // å¤©å¹²æœˆä»¤æ–­è¯­
            const yuelingMap = {
                "ç”²å¯…": "ç”²æœ¨åå¯…ï¼Œå»ºç¦„æ ¼ã€‚ä¸ºäººæ­£ç›´ï¼Œæœ‰é¢†å¯¼æ‰èƒ½ï¼Œä½†éœ€æ³¨æ„å›ºæ‰§å·±è§ã€‚æœˆä»¤ä¸ºæ ¹ï¼Œäº‹ä¸šå‘å±•ç¨³å¥ã€‚",
                "ç”²å¯": "ç”²æœ¨åå¯ï¼Œç¾Šåˆƒæ ¼ã€‚ä¸ªæ€§åˆšå¼ºï¼Œè¡ŒåŠ¨åŠ›å¼ºï¼Œä½†éœ€æ³¨æ„æ§åˆ¶è„¾æ°”ã€‚æœˆä»¤ä¸ºåˆƒï¼Œç«äº‰æ„è¯†å¼ºã€‚",
                "ç”²è¾°": "ç”²æœ¨åè¾°ï¼Œè´¢åº“ä¹‹åœ°ã€‚æœ‰è´¢è¿ï¼Œèƒ½ç§¯ç´¯è´¢å¯Œï¼Œä½†éœ€æ³¨æ„æŠŠæ¡æœºä¼šã€‚æœˆä»¤ä¸ºè´¢ï¼Œé‡è§†ç‰©è´¨ã€‚",
                "ç”²å·³": "ç”²æœ¨åå·³ï¼Œé£Ÿç¥ç”Ÿè´¢ã€‚æ™ºæ…§ç”Ÿè´¢ï¼Œæœ‰åˆ›é€ åŠ›ï¼Œä½†éœ€æ³¨æ„å¥åº·ã€‚æœˆä»¤ä¸ºé£Ÿï¼Œå–„äºè¡¨è¾¾ã€‚",
                "ç”²åˆ": "ç”²æœ¨ååˆï¼Œä¼¤å®˜è§å®˜ã€‚æ‰åå‡ºä¼—ï¼Œä½†éœ€æ³¨æ„å£èˆŒæ˜¯éã€‚æœˆä»¤ä¸ºä¼¤ï¼Œæ€ç»´æ´»è·ƒã€‚",
                "ç”²æœª": "ç”²æœ¨åæœªï¼Œè´¢åº“ä¹‹åœ°ã€‚æœ‰è´¢è¿ï¼Œèƒ½å®ˆè´¢ï¼Œä½†éœ€æ³¨æ„åˆä½œã€‚æœˆä»¤ä¸ºè´¢ï¼ŒåŠ¡å®ç¨³é‡ã€‚",
                "ç”²ç”³": "ç”²æœ¨åç”³ï¼Œä¸ƒæ€æ”»èº«ã€‚å‹åŠ›å¤§ï¼Œèƒ½æˆå¤§äº‹ï¼Œä½†éœ€åšæŒã€‚æœˆä»¤ä¸ºæ€ï¼Œæœ‰é­„åŠ›ã€‚",
                "ç”²é…‰": "ç”²æœ¨åé…‰ï¼Œæ­£å®˜æ ¼ã€‚æœ‰å®˜è¿ï¼Œå—äººå°Šé‡ï¼Œä½†éœ€æ³¨æ„äººé™…å…³ç³»ã€‚æœˆä»¤ä¸ºå®˜ï¼Œé‡è§†è§„åˆ™ã€‚",
                "ç”²æˆŒ": "ç”²æœ¨åæˆŒï¼Œè´¢åº“ä¹‹åœ°ã€‚æœ‰è´¢è¿ï¼Œèƒ½ç†è´¢ï¼Œä½†éœ€æ³¨æ„å¥åº·ã€‚æœˆä»¤ä¸ºè´¢ï¼Œç²¾æ‰“ç»†ç®—ã€‚",
                "ç”²äº¥": "ç”²æœ¨åäº¥ï¼Œå°æ˜Ÿç”Ÿèº«ã€‚æœ‰è´µäººï¼Œå­¦ä¹ èƒ½åŠ›å¼ºï¼Œä½†éœ€æ³¨æ„æƒ…ç»ªã€‚æœˆä»¤ä¸ºå°ï¼Œé‡è§†å­¦ä¹ ã€‚",
                "ç”²å­": "ç”²æœ¨åå­ï¼Œå°æ˜Ÿç”Ÿèº«ã€‚æ™ºæ…§æ·±æ²‰ï¼Œæœ‰å†…æ¶µï¼Œä½†éœ€æ³¨æ„æƒ…ç»ªæ³¢åŠ¨ã€‚æœˆä»¤ä¸ºå°ï¼Œå–„äºæ€è€ƒã€‚",
                "ç”²ä¸‘": "ç”²æœ¨åä¸‘ï¼Œè´¢åº“ä¹‹åœ°ã€‚æœ‰è´¢è¿ï¼Œèƒ½ç§¯ç´¯ï¼Œä½†éœ€æ³¨æ„ç»†èŠ‚ã€‚æœˆä»¤ä¸ºè´¢ï¼Œè„šè¸å®åœ°ã€‚"
            };
            
            const key = dayGan + monthZhi;
            const baseAnalysis = yuelingMap[key] || `æ—¥ä¸»${dayGan}ç”Ÿäº${monthZhi}æœˆï¼Œ${getGeneralYueling(monthZhi, dayGan)}`;
            
            // æ·»åŠ æœˆä»¤ä¸å…¶ä»–å¹²æ”¯çš„å…³ç³»åˆ†æ
            let relations = "\n\næœˆä»¤ä¸å…¶ä»–å¹²æ”¯å…³ç³»ï¼š";
            
            // æœˆå¹²ä¸å¹´å¹²å…³ç³»
            if (monthGan === yearGan) {
                relations += "æœˆå¹²ä¸å¹´å¹²ç›¸åŒï¼Œå®¶æ—å½±å“è¾ƒå¤§ã€‚";
            } else if (isSheng(WUXING[TIANGAN.indexOf(monthGan)], WUXING[TIANGAN.indexOf(yearGan)])) {
                relations += "æœˆå¹²ç”Ÿå¹´å¹²ï¼Œèƒ½å¾—é•¿è¾ˆå¸®åŠ©ã€‚";
            } else if (isSheng(WUXING[TIANGAN.indexOf(yearGan)], WUXING[TIANGAN.indexOf(monthGan)])) {
                relations += "å¹´å¹²ç”Ÿæœˆå¹²ï¼Œå®¶åº­ç¯å¢ƒæœ‰åˆ©ã€‚";
            }
            
            // æœˆå¹²ä¸æ—¶å¹²å…³ç³»
            if (monthGan === hourGan) {
                relations += " æœˆå¹²ä¸æ—¶å¹²ç›¸åŒï¼Œå†…å¤–ä¸€è‡´ã€‚";
            } else if (isSheng(WUXING[TIANGAN.indexOf(monthGan)], WUXING[TIANGAN.indexOf(hourGan)])) {
                relations += " æœˆå¹²ç”Ÿæ—¶å¹²ï¼Œä¸­å¹´åå‘å±•é¡ºåˆ©ã€‚";
            } else if (isSheng(WUXING[TIANGAN.indexOf(hourGan)], WUXING[TIANGAN.indexOf(monthGan)])) {
                relations += " æ—¶å¹²ç”Ÿæœˆå¹²ï¼Œæ™šå¹´æœ‰ç¦ã€‚";
            }
            
            // æœˆæ”¯ä¸æ—¥æ”¯å…³ç³»
            if (monthZhi === dayZhi) {
                relations += " æœˆæ”¯ä¸æ—¥æ”¯ç›¸åŒï¼Œè‡ªæˆ‘æ„è¯†å¼ºã€‚";
            } else if (DIZHI_CHONG[monthZhi] === dayZhi) {
                relations += " æœˆæ”¯ä¸æ—¥æ”¯ç›¸å†²ï¼Œå†…å¿ƒçŸ›ç›¾ã€‚";
            }
            
            return baseAnalysis + relations;
        }
        
        function getGeneralYueling(monthZhi, dayGan) {
            const effects = {
                "å¯…": "æœ¨æ—ºä¹‹æœˆï¼Œç”Ÿæœºå‹ƒå‹ƒï¼Œåˆ©äºå¼€å§‹æ–°äº‹ç‰©ã€‚ä¸ºäººç§¯æï¼Œæœ‰å¼€æ‹“ç²¾ç¥ã€‚",
                "å¯": "æœ¨ç››ä¹‹æœˆï¼Œå‘å±•è¿…é€Ÿï¼Œåˆ©äºæ‰©å±•äº‹ä¸šã€‚ä¸ºäººçµæ´»ï¼Œé€‚åº”åŠ›å¼ºã€‚",
                "è¾°": "åœŸæ¹¿ä¹‹æœˆï¼Œè“„åŠ¿å¾…å‘ï¼Œåˆ©äºç§¯ç´¯èµ„æºã€‚ä¸ºäººç¨³é‡ï¼Œæœ‰è€å¿ƒã€‚",
                "å·³": "ç«åˆä¹‹æœˆï¼Œçƒ­æƒ…æ´‹æº¢ï¼Œåˆ©äºå±•ç°æ‰åã€‚ä¸ºäººèªæ˜ï¼Œæœ‰è¡¨ç°æ¬²ã€‚",
                "åˆ": "ç«æ—ºä¹‹æœˆï¼Œå…‰æ˜ç£Šè½ï¼Œåˆ©äºå†³ç­–åˆ¤æ–­ã€‚ä¸ºäººæ­£ç›´ï¼Œæœ‰åŸåˆ™ã€‚",
                "æœª": "åœŸç‡¥ä¹‹æœˆï¼Œç¨³é‡è¸å®ï¼Œåˆ©äºç¨³å›ºåŸºç¡€ã€‚ä¸ºäººåŠ¡å®ï¼Œèƒ½åšæŒã€‚",
                "ç”³": "é‡‘é”ä¹‹æœˆï¼Œæœæ–­å†³ç»ï¼Œåˆ©äºè§£å†³é—®é¢˜ã€‚ä¸ºäººæœæ–­ï¼Œæœ‰æ•ˆç‡ã€‚",
                "é…‰": "é‡‘çº¯ä¹‹æœˆï¼Œæ„å¿—åšå®šï¼Œåˆ©äºåšæŒç›®æ ‡ã€‚ä¸ºäººåšå®šï¼Œæœ‰æ¯…åŠ›ã€‚",
                "æˆŒ": "åœŸç‡¥ä¹‹æœˆï¼Œåšå¾·è½½ç‰©ï¼Œåˆ©äºæ‰¿æ‹…è´£ä»»ã€‚ä¸ºäººè´Ÿè´£ï¼Œæœ‰æ‹…å½“ã€‚",
                "äº¥": "æ°´æ—ºä¹‹æœˆï¼Œæ™ºæ…§æ·±æ²‰ï¼Œåˆ©äºæ€è€ƒè§„åˆ’ã€‚ä¸ºäººæ™ºæ…§ï¼Œæœ‰è¿œè§ã€‚",
                "å­": "æ°´ç››ä¹‹æœˆï¼Œå†·é™ç†æ™ºï¼Œåˆ©äºåˆ†æåˆ¤æ–­ã€‚ä¸ºäººå†·é™ï¼Œæœ‰é€»è¾‘ã€‚",
                "ä¸‘": "åœŸæ¹¿ä¹‹æœˆï¼Œæ²‰ç¨³å†…æ•›ï¼Œåˆ©äºç­‰å¾…æ—¶æœºã€‚ä¸ºäººæ²‰ç¨³ï¼Œæœ‰è€å¿ƒã€‚"
            };
            
            return effects[monthZhi] || "æœˆä»¤ä½œç”¨æ˜¾è‘—ï¼Œå¯¹å…«å­—æ ¼å±€æœ‰é‡è¦å½±å“ã€‚";
        }
        
        function getFutureYearAnalysis(yearGanzhi, yearPillar, monthPillar, dayPillar, hourPillar, futureYear) {
            const yearGan = yearGanzhi[0];
            const yearZhi = yearGanzhi[1];
            const dayGan = dayPillar[0];
            const dayZhi = dayPillar[1];
            
            const allZhi = [yearPillar[1], monthPillar[1], dayPillar[1], hourPillar[1]];
            
            let analysis = "";
            
            // 1. æ£€æŸ¥å¤©å¹²å…³ç³»
            const yearGanIndex = TIANGAN.indexOf(yearGan);
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const yearElement = WUXING[yearGanIndex];
            const dayElement = WUXING[dayGanIndex];
            
            if (yearGan === dayGan) {
                analysis += "æ¯”è‚©æµå¹´ï¼Œç«äº‰åŠ å¼ºï¼Œåˆä½œå‘å±•æœºä¼šå¤šï¼Œæ³¨æ„äººé™…å…³ç³»ã€‚é€‚åˆæ‹“å±•äººè„‰ï¼Œå¯»æ‰¾åˆä½œä¼™ä¼´ï¼Œä½†éœ€é˜²å°äººäº‰ç«ã€‚";
            } else if (isSheng(yearElement, dayElement)) {
                analysis += "æµå¹´ç”ŸåŠ©æ—¥ä¸»ï¼Œè´µäººç›¸åŠ©ï¼Œå‘å±•æœºä¼šå¤šã€‚å®¹æ˜“å¾—åˆ°ä»–äººå¸®åŠ©ï¼Œé€‚åˆä¸»åŠ¨å¯»æ±‚æœºä¼šï¼Œç§¯æè¿›å–ã€‚";
            } else if (isSheng(dayElement, yearElement)) {
                analysis += "æ—¥ä¸»ç”Ÿæµå¹´ï¼Œä»˜å‡ºè¾ƒå¤šï¼Œæ”¶è·å¯èƒ½å»¶è¿Ÿã€‚éœ€è¦å¤šä»˜å‡ºåŠªåŠ›ï¼Œä¸ºä»–äººæœåŠ¡ï¼Œç§¯ç´¯å–„ç¼˜ã€‚";
            } else if (isKe(yearElement, dayElement)) {
                analysis += "æµå¹´å…‹åˆ¶æ—¥ä¸»ï¼Œå‹åŠ›è¾ƒå¤§ï¼Œéœ€è°¨æ…åº”å¯¹ã€‚å¯èƒ½ä¼šé‡åˆ°æŒ‘æˆ˜å’Œå‹åŠ›ï¼Œéœ€è¦ç¨³å¥è¡Œäº‹ï¼Œé¿å…å†’é™©ã€‚";
            } else if (isKe(dayElement, yearElement)) {
                analysis += "æ—¥ä¸»å…‹åˆ¶æµå¹´ï¼Œä¸»åŠ¨è¿›å–ï¼Œèƒ½å…‹æœå›°éš¾ã€‚é€‚åˆä¸»åŠ¨å‡ºå‡»ï¼Œè§£å†³é—®é¢˜ï¼Œå±•ç°èƒ½åŠ›ã€‚";
            }
            
            // 2. æ£€æŸ¥åœ°æ”¯å…³ç³»
            // ç›¸å†²
            let hasChong = false;
            for (const pillarZhi of allZhi) {
                if (DIZHI_CHONG[yearZhi] === pillarZhi) {
                    const chongEffect = getChongEffect(yearZhi, pillarZhi);
                    analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸å†²ï¼Œ${chongEffect}ã€‚`;
                    hasChong = true;
                    break;
                }
            }
            
            // ç›¸åˆ
            const heRelations = [
                { pair: ["å­", "ä¸‘"], effect: "å­ä¸‘åˆåœŸï¼Œä¸»åˆä½œæœºä¼šã€è´¢è¿æå‡ã€æ„Ÿæƒ…ç¨³å®šï¼Œé€‚åˆç­¾çº¦åˆä½œã€æŠ•èµ„ç†è´¢" },
                { pair: ["å¯…", "äº¥"], effect: "å¯…äº¥åˆæœ¨ï¼Œä¸»è´µäººå‡ºç°ã€äº‹ä¸šå‘å±•ã€å­¦ä¹ è¿›æ­¥ï¼Œé€‚åˆæ‹œå¸ˆå­¦è‰ºã€èŒåœºæ™‹å‡" },
                { pair: ["å¯", "æˆŒ"], effect: "å¯æˆŒåˆç«ï¼Œä¸»æ¡ƒèŠ±è¿æ—ºã€åˆä½œé¡ºåˆ©ã€åˆ›æ„å‘æŒ¥ï¼Œé€‚åˆæ‹çˆ±ç»“å©šã€åˆ›æ„å·¥ä½œ" },
                { pair: ["è¾°", "é…‰"], effect: "è¾°é…‰åˆé‡‘ï¼Œä¸»è´¢è¿äº¨é€šã€åˆä½œæˆåŠŸã€äº‹ä¸šæ™‹å‡ï¼Œé€‚åˆæŠ•èµ„åˆ›ä¸šã€èŒä½æ™‹å‡" },
                { pair: ["å·³", "ç”³"], effect: "å·³ç”³åˆæ°´ï¼Œä¸»å˜åŠ¨æœºé‡ã€äº¤é€šå‡ºè¡Œã€æ€ç»´åˆ›æ–°ï¼Œé€‚åˆæ¬è¿æ—…è¡Œã€å­¦ä¹ æ–°çŸ¥" },
                { pair: ["åˆ", "æœª"], effect: "åˆæœªåˆç«åœŸï¼Œä¸»äººé™…å…³ç³»å’Œè°ã€å›¢é˜Ÿåˆä½œã€ç¨³å®šå‘å±•ï¼Œé€‚åˆå›¢é˜Ÿå»ºè®¾ã€ç¨³å®šç»è¥" }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of heRelations) {
                    if ((relation.pair[0] === yearZhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === yearZhi)) {
                        analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸åˆï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // ç›¸åˆ‘
            const xingRelations = [
                { zhis: ["å¯…", "å·³", "ç”³"], effect: "å¯…å·³ç”³ä¸‰åˆ‘ï¼Œä¸»å®˜å¸çº çº·ã€å¥åº·å—æŸã€å˜åŠ¨ä¸å®‰ï¼Œéœ€ç‰¹åˆ«æ³¨æ„æ³•å¾‹æ–‡ä¹¦å’Œå‡ºè¡Œå®‰å…¨" },
                { zhis: ["ä¸‘", "æˆŒ", "æœª"], effect: "ä¸‘æˆŒæœªä¸‰åˆ‘ï¼Œä¸»ç«äº‰æ¿€çƒˆã€è´¢åŠ¡å‹åŠ›ã€è‚ èƒƒä¸é€‚ï¼Œéœ€æ³¨æ„é¥®é£Ÿå¥åº·å’Œè´¢åŠ¡ç®¡ç†" },
                { zhis: ["å­", "å¯"], effect: "å­å¯ç›¸åˆ‘ï¼Œä¸»äººé™…å…³ç³»ç´§å¼ ã€æ–‡ä¹¦é”™è¯¯ã€æƒ…ç»ªæ³¢åŠ¨ï¼Œéœ€æ³¨æ„æ²Ÿé€šæ–¹å¼å’ŒåˆåŒç»†èŠ‚" },
                { zhis: ["è¾°", "è¾°"], effect: "è¾°è¾°è‡ªåˆ‘ï¼Œä¸»è‡ªæˆ‘çº ç»“ã€å†³ç­–å›°éš¾ã€æ€è™‘è¿‡åº¦ï¼Œéœ€æ³¨æ„å¿ƒç†å¥åº·å’Œå†³ç­–æ•ˆç‡" },
                { zhis: ["åˆ", "åˆ"], effect: "åˆåˆè‡ªåˆ‘ï¼Œä¸»å¿ƒè„å‹åŠ›ã€æƒ…ç»ªæ€¥èºã€å†²çªé¢‘å‘ï¼Œéœ€æ³¨æ„æƒ…ç»ªç®¡ç†å’Œå¿ƒè¡€ç®¡å¥åº·" },
                { zhis: ["é…‰", "é…‰"], effect: "é…‰é…‰è‡ªåˆ‘ï¼Œä¸»è‚ºéƒ¨é—®é¢˜ã€å£èˆŒæ˜¯éã€åˆä½œç ´è£‚ï¼Œéœ€æ³¨æ„å‘¼å¸ç³»ç»Ÿå’Œäººé™…å…³ç³»" },
                { zhis: ["äº¥", "äº¥"], effect: "äº¥äº¥è‡ªåˆ‘ï¼Œä¸»è‚¾è„é—®é¢˜ã€æƒ…ç»ªä½è½ã€è´¢åŠ¡æ³¢åŠ¨ï¼Œéœ€æ³¨æ„è‚¾è„å¥åº·å’Œè´¢åŠ¡è§„åˆ’" }
            ];
            
            let xingCount = 0;
            for (const pillarZhi of allZhi) {
                for (const relation of xingRelations) {
                    if (relation.zhis.includes(yearZhi) && relation.zhis.includes(pillarZhi)) {
                        xingCount++;
                        if (xingCount === 1) {
                            analysis += ` æµå¹´${yearZhi}ä¸å…«å­—${pillarZhi}ç›¸åˆ‘ï¼Œ${relation.effect}ã€‚`;
                        }
                    }
                }
            }
            
            // ç›¸å®³
            const haiRelations = [
                { pair: ["å­", "æœª"], effect: "å­æœªç›¸å®³ï¼Œä¸»è‚ èƒƒç–¾ç—…ã€æŠ•èµ„å¤±åˆ©ã€å°äººé™·å®³ï¼Œéœ€ç‰¹åˆ«æ³¨æ„é¥®é£Ÿå«ç”Ÿå’ŒæŠ•èµ„é£é™©" },
                { pair: ["ä¸‘", "åˆ"], effect: "ä¸‘åˆç›¸å®³ï¼Œä¸»å¿ƒè„ä¸é€‚ã€æ–‡ä¹¦é”™è¯¯ã€åˆä½œç ´è£‚ï¼Œéœ€æ³¨æ„å¿ƒè¡€ç®¡å¥åº·å’ŒåˆåŒå®¡æŸ¥" },
                { pair: ["å¯…", "å·³"], effect: "å¯…å·³ç›¸å®³ï¼Œä¸»è‚èƒ†é—®é¢˜ã€äº¤é€šäº‹æ•…ã€å£èˆŒæ˜¯éï¼Œéœ€æ³¨æ„å‡ºè¡Œå®‰å…¨å’Œæƒ…ç»ªç®¡ç†" },
                { pair: ["å¯", "è¾°"], effect: "å¯è¾°ç›¸å®³ï¼Œä¸»æ‰‹è¶³æŸä¼¤ã€åˆä½œä¸é¡ºã€è´¢åŠ¡çº çº·ï¼Œéœ€æ³¨æ„èº«ä½“å®‰å…¨å’Œåˆä½œä¼™ä¼´é€‰æ‹©" },
                { pair: ["ç”³", "äº¥"], effect: "ç”³äº¥ç›¸å®³ï¼Œä¸»å‘¼å¸ç³»ç»Ÿç–¾ç—…ã€æ€ç»´æ··ä¹±ã€å†³ç­–å¤±è¯¯ï¼Œéœ€æ³¨æ„å¥åº·ç®¡ç†å’Œå†³ç­–è¿‡ç¨‹" },
                { pair: ["é…‰", "æˆŒ"], effect: "é…‰æˆŒç›¸å®³ï¼Œä¸»çš®è‚¤é—®é¢˜ã€ç ´è´¢æŸè€—ã€äººé™…å…³ç³»ç´§å¼ ï¼Œéœ€æ³¨æ„çš®è‚¤æŠ¤ç†å’Œäººé™…å…³ç³»å¤„ç†" }
            ];
            
            for (const pillarZhi of allZhi) {
                for (const relation of haiRelations) {
                    if ((relation.pair[0] === yearZhi && relation.pair[1] === pillarZhi) ||
                        (relation.pair[0] === pillarZhi && relation.pair[1] === yearZhi)) {
                        analysis += ` æµå¹´${yearZhi}ä¸${pillarZhi}ç›¸å®³ï¼Œ${relation.effect}ã€‚`;
                        break;
                    }
                }
            }
            
            // 3. æ ¹æ®å…·ä½“å¹´ä»½ç»™å‡ºè¯¦ç»†åˆ†æå’Œå»ºè®®
            const yearDetailedMap = {
                2024: "ç”²è¾°å¹´ï¼Œæœ¨åœŸç›¸å…‹ï¼Œå˜åŠ¨ä¹‹å¹´ï¼Œæ³¨æ„è°ƒæ•´ï¼ŒæŠŠæ¡æ–°æœºé‡ã€‚åˆ©äºå­¦ä¹ æ–°æŠ€èƒ½ï¼Œè½¬æ¢å·¥ä½œç¯å¢ƒã€‚æ³¨æ„è„¾èƒƒå¥åº·ï¼Œé¿å…å‹åŠ›è¿‡å¤§ã€‚å»ºè®®ï¼šç¨³ä¸­æ±‚å˜ï¼Œå­¦ä¹ æå‡ã€‚",
                2025: "ä¹™å·³å¹´ï¼Œæœ¨ç«ç›¸ç”Ÿï¼Œå‘å±•ä¹‹å¹´ï¼Œåˆ©äºäº‹ä¸šæ‰©å±•ã€‚é€‚åˆå±•ç°æ‰åï¼Œè·å¾—è®¤å¯ã€‚æ³¨æ„å¿ƒè„å¥åº·ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚å»ºè®®ï¼šç§¯æè¿›å–ï¼Œå±•ç°è‡ªæˆ‘ã€‚",
                2026: "ä¸™åˆå¹´ï¼Œç«æ—ºä¹‹å¹´ï¼Œçƒ­æƒ…ç§¯æï¼Œä½†éœ€æ³¨æ„æ§åˆ¶æƒ…ç»ªã€‚åˆ©äºåˆ›é€ æ€§å·¥ä½œï¼Œå‘æŒ¥åˆ›æ„ã€‚æ³¨æ„å¿ƒè¡€ç®¡å¥åº·ï¼Œé¿å…å†²çªã€‚å»ºè®®ï¼šå‘æŒ¥åˆ›æ„ï¼Œæ§åˆ¶æƒ…ç»ªã€‚",
                2027: "ä¸æœªå¹´ï¼Œç«åœŸç›¸ç”Ÿï¼Œç¨³å›ºå‘å±•ï¼Œç§¯ç´¯æˆæœã€‚é€‚åˆç¨³æ‰ç¨³æ‰“ï¼Œå·©å›ºåŸºç¡€ã€‚æ³¨æ„è„¾èƒƒåŠŸèƒ½ï¼Œé¿å…é¥®é£Ÿä¸è§„å¾‹ã€‚å»ºè®®ï¼šå·©å›ºåŸºç¡€ï¼Œç¨³æ­¥å‰è¿›ã€‚",
                2028: "æˆŠç”³å¹´ï¼ŒåœŸé‡‘ç›¸ç”Ÿï¼ŒåŠ¡å®è¿›å–ï¼Œè´¢è¿è¾ƒå¥½ã€‚é€‚åˆæŠ•èµ„ç†è´¢ï¼Œç§¯ç´¯è´¢å¯Œã€‚æ³¨æ„å‘¼å¸ç³»ç»Ÿï¼Œé¿å…ç¯å¢ƒæ±¡æŸ“ã€‚å»ºè®®ï¼šç†æ€§æŠ•èµ„ï¼Œç§¯ç´¯è´¢å¯Œã€‚",
                2029: "å·±é…‰å¹´ï¼ŒåœŸé‡‘ç›¸ç”Ÿï¼Œç¨³ä¸­æœ‰è¿›ï¼Œæ³¨æ„å¥åº·ã€‚é€‚åˆå­¦ä¹ è¿›ä¿®ï¼Œæå‡è‡ªæˆ‘ã€‚æ³¨æ„è‚ºéƒ¨å¥åº·ï¼Œé¿å…çƒŸå°˜ç¯å¢ƒã€‚å»ºè®®ï¼šå­¦ä¹ æå‡ï¼Œå…³æ³¨å¥åº·ã€‚",
                2030: "åºšæˆŒå¹´ï¼Œé‡‘åœŸç›¸ç”Ÿï¼ŒåšæŒåŠªåŠ›ï¼Œå¯è·æˆæœã€‚é€‚åˆåšæŒç›®æ ‡ï¼Œå…‹æœå›°éš¾ã€‚æ³¨æ„å…³èŠ‚å¥åº·ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚å»ºè®®ï¼šåšæŒç›®æ ‡ï¼Œå…‹æœå›°éš¾ã€‚"
            };
            
            if (yearDetailedMap[futureYear]) {
                analysis += ` ${yearDetailedMap[futureYear]}`;
            } else {
                analysis += ` æµå¹´${yearZhi}å¹³ç¨³ï¼Œé€‚åˆè§„åˆ’å®æ–½ï¼Œæ³¨æ„ç»†èŠ‚æŠŠæ¡ã€‚å»ºè®®ç¨³æ‰ç¨³æ‰“ï¼Œç§¯ç´¯ç»éªŒï¼Œç­‰å¾…æ›´å¥½æ—¶æœºã€‚æ³¨æ„æ ¹æ®è‡ªèº«æƒ…å†µè°ƒæ•´ç­–ç•¥ï¼Œä¿æŒçµæ´»æ€§ã€‚`;
            }
            
            // 4. æ·»åŠ å…·ä½“å»ºè®®
            analysis += "\n\nå…·ä½“å»ºè®®ï¼š";
            
            if (hasChong) {
                analysis += " æ­¤å¹´å˜åŠ¨è¾ƒå¤§ï¼Œå»ºè®®æå‰åšå¥½è§„åˆ’ï¼Œä¿æŒçµæ´»æ€§ã€‚é‡åˆ°å˜åŠ¨æ—¶ä¸è¦æ…Œå¼ ï¼Œå†·é™åº”å¯¹ã€‚";
            }
            
            if (xingCount > 0) {
                analysis += " æ³¨æ„æ³•å¾‹æ–‡ä¹¦å’Œå¥åº·é—®é¢˜ï¼Œæå‰åšå¥½é¢„é˜²ã€‚é‡åˆ°çº çº·æ—¶å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚";
            }
            
            // æ ¹æ®äº”è¡Œç»™å‡ºå»ºè®®
            if (yearElement === "é‡‘") {
                analysis += " é‡‘å¹´åˆ©äºé‡‘èã€æ³•å¾‹ã€æŠ€æœ¯ç±»å·¥ä½œã€‚é€‚åˆå­¦ä¹ æ–°æŠ€èƒ½ï¼Œæå‡ä¸“ä¸šèƒ½åŠ›ã€‚";
            } else if (yearElement === "æœ¨") {
                analysis += " æœ¨å¹´åˆ©äºæ•™è‚²ã€æ–‡åŒ–ã€åˆ›æ„ç±»å·¥ä½œã€‚é€‚åˆæ‹“å±•äººè„‰ï¼Œå‘å±•åˆä½œå…³ç³»ã€‚";
            } else if (yearElement === "æ°´") {
                analysis += " æ°´å¹´åˆ©äºè´¸æ˜“ã€äº¤é€šã€å’¨è¯¢ç±»å·¥ä½œã€‚é€‚åˆå˜åŠ¨å‘å±•ï¼Œå¼€æ‹“æ–°é¢†åŸŸã€‚";
            } else if (yearElement === "ç«") {
                analysis += " ç«å¹´åˆ©äºè‰ºæœ¯ã€å¨±ä¹ã€è¥é”€ç±»å·¥ä½œã€‚é€‚åˆå±•ç°æ‰åï¼Œè·å¾—å…³æ³¨ã€‚";
            } else if (yearElement === "åœŸ") {
                analysis += " åœŸå¹´åˆ©äºæˆ¿åœ°äº§ã€å»ºç­‘ã€èµ„æºç±»å·¥ä½œã€‚é€‚åˆç¨³å®šå‘å±•ï¼Œç§¯ç´¯èµ„æºã€‚";
            }
            
            return analysis;
        }
        
        // ==================== 9. æŠ¥å‘Šç”ŸæˆåŠŸèƒ½ ====================
        
        // ç‰ˆæœ¬åç§°æ˜ å°„
        const levelNames = {
            'free': 'å…è´¹ç‰ˆ',
            'level1': 'åˆ†äº«è§£é”ç‰ˆ',
            'basic': 'åŸºç¡€ç‰ˆ',
            'level2': 'è¿›é˜¶ç‰ˆ',
            'pro': 'ä¸“ä¸šç‰ˆ',
            'vip': 'å°Šäº«ç‰ˆ'
        };
        
        // ä»˜è´¹ç”¨æˆ·éªŒè¯ç³»ç»Ÿ
        const paidUsers = {
            // è¿™é‡Œåº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼Œä¸ºäº†æ¼”ç¤ºä½¿ç”¨æœ¬åœ°å­˜å‚¨
        };
        
        // åŠ è½½å·²æ”¯ä»˜çš„ç”¨æˆ·æ•°æ®
        function loadPaidUsers() {
            const saved = localStorage.getItem('bazi_paid_users');
            if (saved) {
                try {
                    Object.assign(paidUsers, JSON.parse(saved));
                } catch (e) {
                    console.error('åŠ è½½ä»˜è´¹ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
                }
            }
        }
        
        // ä¿å­˜ä»˜è´¹ç”¨æˆ·æ•°æ®
        function savePaidUsers() {
            localStorage.setItem('bazi_paid_users', JSON.stringify(paidUsers));
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æ”¯ä»˜
        function checkUserPaid(userId, level) {
            if (!userId) return false;
            return paidUsers[userId] && paidUsers[userId].level === level && paidUsers[userId].expires > Date.now();
        }
        
        // éªŒè¯ç”¨æˆ·èº«ä»½
        function verifyUserBeforeDownload(level, format) {
            const userId = localStorage.getItem('bazi_user_id');
            
            if (userId && checkUserPaid(userId, level)) {
                // ç”¨æˆ·å·²æ”¯ä»˜ï¼Œç›´æ¥ä¸‹è½½
                downloadPaidReport(level, format);
            } else {
                // éœ€è¦éªŒè¯ç”¨æˆ·
                showUserVerification(level, format);
            }
        }
        
        // æ˜¾ç¤ºç”¨æˆ·éªŒè¯æ¨¡æ€æ¡†
        function showUserVerification(level, format) {
            const planNames = {
                'basic': 'åŸºç¡€ç‰ˆ',
                'level2': 'è¿›é˜¶ç‰ˆ', 
                'pro': 'ä¸“ä¸šç‰ˆ',
                'vip': 'å°Šäº«ç‰ˆ'
            };
            
            const planName = planNames[level] || level;
            
            const verificationHTML = `
                <div style="text-align: center;">
                    <div style="color: var(--golden-yellow); font-size: 1.5rem; margin-bottom: 20px;">
                        <i class="fas fa-lock"></i> ${planName}æŠ¥å‘Šä¸‹è½½éªŒè¯
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.6); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                        <p style="color: var(--pearl-white); margin-bottom: 15px;">
                            æ­¤æŠ¥å‘Šä¸º${planName}ä¸“å±ï¼Œä»·å€¼Â¥${getPriceByType(level)}ï¼Œéœ€è¦éªŒè¯æ‚¨çš„è´­ä¹°ä¿¡æ¯ã€‚
                        </p>
                        
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin: 20px 0;">
                            <div style="color: var(--quantum-blue); font-size: 2.5rem; font-weight: bold;">
                                Â¥${getPriceByType(level)}
                            </div>
                            <div style="color: var(--pearl-white);">
                                <div>${planName}æŠ¥å‘Š</div>
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">ä¸€æ¬¡æ€§ä»˜æ¬¾ï¼Œæ°¸ä¹…ä½¿ç”¨</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="verificationStep1">
                        <h4 style="color: var(--quantum-blue); margin-bottom: 15px;">ç¬¬ä¸€æ­¥ï¼šè¾“å…¥éªŒè¯ä¿¡æ¯</h4>
                        <input type="text" id="userWechatId" class="verification-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å¾®ä¿¡IDï¼ˆå¦‚ï¼šwxid_xxxï¼‰">
                        <input type="text" id="paymentOrderId" class="verification-input" placeholder="è¯·è¾“å…¥æ”¯ä»˜è®¢å•å·ï¼ˆå¦‚ï¼šBZ20240101001ï¼‰">
                        
                        <div style="color: var(--pearl-white); font-size: 0.9rem; margin: 15px 0;">
                            <p><i class="fas fa-info-circle"></i> éªŒè¯ä¿¡æ¯è¯´æ˜ï¼š</p>
                            <ul style="text-align: left; margin-left: 20px;">
                                <li>å¾®ä¿¡IDï¼šæ‚¨æ·»åŠ å®¢æœå¾®ä¿¡æ—¶çš„ID</li>
                                <li>è®¢å•å·ï¼šæ”¯ä»˜å®Œæˆåå®¢æœæä¾›çš„è®¢å•å·</li>
                                <li>å¦‚å¿˜è®°ä¿¡æ¯ï¼Œè¯·è”ç³»å®¢æœå¾®ä¿¡ï¼šm9311813</li>
                            </ul>
                        </div>
                        
                        <button onclick="verifyPayment('${level}', '${format}')" class="verification-btn">
                            <i class="fas fa-check"></i> æäº¤éªŒè¯
                        </button>
                        
                        <div style="margin-top: 20px;">
                            <button onclick="openPayment('${level}')" style="
                                padding: 10px 20px;
                                background: var(--quantum-blue);
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 1rem;
                            ">
                                <i class="fas fa-shopping-cart"></i> é‡æ–°è´­ä¹°
                            </button>
                        </div>
                    </div>
                    
                    <div id="verificationStep2" style="display: none;">
                        <h4 style="color: var(--quantum-blue); margin-bottom: 15px;">ç¬¬äºŒæ­¥ï¼šè”ç³»å®¢æœäººå·¥éªŒè¯</h4>
                        <div style="background: rgba(0,0,0,0.6); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                            <p style="color: var(--pearl-white); margin-bottom: 15px;">
                                ç³»ç»ŸéªŒè¯éœ€è¦äººå·¥å®¡æ ¸ï¼Œè¯·æ·»åŠ å®¢æœå¾®ä¿¡å®ŒæˆéªŒè¯ï¼š
                            </p>
                            <div style="color: var(--golden-yellow); font-size: 1.2rem; margin: 15px 0;">
                                <i class="fab fa-weixin"></i> å®¢æœå¾®ä¿¡ï¼šm9311813
                            </div>
                            <div style="color: var(--pearl-white); font-size: 0.9rem;">
                                æ·»åŠ æ—¶è¯·å¤‡æ³¨ï¼šå…«å­—æ’ç›˜éªŒè¯ - è®¢å•å·
                            </div>
                        </div>
                        
                        <button onclick="completeVerification('${level}', '${format}')" class="verification-btn" style="background: linear-gradient(145deg, #07c160, #06ad56);">
                            <i class="fas fa-check-circle"></i> æˆ‘å·²è”ç³»å®¢æœå®ŒæˆéªŒè¯
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('verificationContent').innerHTML = verificationHTML;
            document.getElementById('userVerificationModal').style.display = 'flex';
        }
        
        // éªŒè¯æ”¯ä»˜ä¿¡æ¯
        function verifyPayment(level, format) {
            const wechatId = document.getElementById('userWechatId').value.trim();
            const orderId = document.getElementById('paymentOrderId').value.trim();
            
            if (!wechatId || !orderId) {
                showVerificationMessage('è¯·å¡«å†™å®Œæ•´çš„éªŒè¯ä¿¡æ¯', 'error');
                return;
            }
            
            showVerificationMessage('æ­£åœ¨éªŒè¯æ‚¨çš„æ”¯ä»˜ä¿¡æ¯...', 'info');
            
            // æ¨¡æ‹ŸéªŒè¯è¿‡ç¨‹
            setTimeout(() => {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨æœåŠ¡å™¨APIéªŒè¯
                // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡è®¾éªŒè¯æˆåŠŸ
                const isVerified = simulateServerVerification(wechatId, orderId, level);
                
                if (isVerified) {
                    // éªŒè¯æˆåŠŸï¼Œæ³¨å†Œç”¨æˆ·
                    const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    localStorage.setItem('bazi_user_id', userId);
                    
                    paidUsers[userId] = {
                        wechatId: wechatId,
                        orderId: orderId,
                        level: level,
                        verifiedAt: Date.now(),
                        expires: Date.now() + (10 * 365 * 24 * 60 * 60 * 1000) // 10å¹´æœ‰æ•ˆæœŸ
                    };
                    
                    savePaidUsers();
                    
                    // éšè—ç¬¬ä¸€æ­¥ï¼Œæ˜¾ç¤ºç¬¬äºŒæ­¥
                    document.getElementById('verificationStep1').style.display = 'none';
                    document.getElementById('verificationStep2').style.display = 'block';
                    
                    showVerificationMessage('åŸºæœ¬ä¿¡æ¯éªŒè¯é€šè¿‡ï¼è¯·ç»§ç»­è”ç³»å®¢æœå®Œæˆæœ€ç»ˆéªŒè¯ã€‚', 'success');
                } else {
                    showVerificationMessage('éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¿¡æ¯æ˜¯å¦æ­£ç¡®æˆ–è”ç³»å®¢æœå¾®ä¿¡ï¼šm9311813', 'error');
                }
            }, 1500);
        }
        
        // æ¨¡æ‹ŸæœåŠ¡å™¨éªŒè¯
        function simulateServerVerification(wechatId, orderId, level) {
            // å®é™…åº”ç”¨ä¸­åº”è¯¥è°ƒç”¨æœåŠ¡å™¨API
            // è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæ¨¡æ‹ŸéªŒè¯é€»è¾‘
            return wechatId.length > 3 && orderId.startsWith('BZ');
        }
        
        // å®ŒæˆéªŒè¯
        function completeVerification(level, format) {
            const userId = localStorage.getItem('bazi_user_id');
            
            if (userId && checkUserPaid(userId, level)) {
                showVerificationMessage('éªŒè¯æˆåŠŸï¼æ­£åœ¨ä¸ºæ‚¨ä¸‹è½½æŠ¥å‘Š...', 'success');
                
                setTimeout(() => {
                    closeModal('userVerificationModal');
                    downloadPaidReport(level, format);
                }, 1000);
            } else {
                showVerificationMessage('éªŒè¯å°šæœªå®Œæˆï¼Œè¯·ç¡®ä¿å·²è”ç³»å®¢æœå®Œæˆäººå·¥éªŒè¯ã€‚', 'error');
            }
        }
        
        // æ˜¾ç¤ºéªŒè¯æ¶ˆæ¯
        function showVerificationMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `verification-message verification-${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            const existingMsg = document.querySelector('.verification-message');
            if (existingMsg) {
                existingMsg.remove();
            }
            
            document.getElementById('verificationContent').appendChild(messageDiv);
        }
        
        // å…è´¹æŠ¥å‘Šä¸‹è½½
        function downloadFreeReport(type) {
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                const content = generateFreeReportContent();
                
                if (type === 'txt') {
                    downloadTXTReport(content, 'å…è´¹ç‰ˆ');
                } else if (type === 'image') {
                    downloadImageReport(content, 'å…è´¹ç‰ˆ');
                }
                
                hideLoading();
                alert('å…è´¹æŠ¥å‘Šå·²ç”Ÿæˆï¼');
            }, 500);
        }
        
        // åˆ†äº«è§£é”ç‰ˆæŠ¥å‘Šä¸‹è½½
        function downloadLevel1Report(type) {
            if (!isUnlockedLevel1) {
                alert("è¯·å…ˆåˆ†äº«ç»™10ä½å¥½å‹è§£é”æ­¤åŠŸèƒ½");
                return;
            }
            
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                const content = generateLevel1ReportContent();
                
                if (type === 'word') {
                    downloadWordReport(content, 'åˆ†äº«è§£é”ç‰ˆ');
                } else if (type === 'txt') {
                    downloadTXTReport(content, 'åˆ†äº«è§£é”ç‰ˆ');
                } else if (type === 'image') {
                    downloadImageReport(content, 'åˆ†äº«è§£é”ç‰ˆ');
                }
                
                hideLoading();
                alert('åˆ†äº«è§£é”ç‰ˆæŠ¥å‘Šå·²ç”Ÿæˆï¼');
            }, 500);
        }
        
        // ç”Ÿæˆå…è´¹æŠ¥å‘Šå†…å®¹
        function generateFreeReportContent() {
            const pillars = [currentBaziData.yearPillar, currentBaziData.monthPillar, 
                           currentBaziData.dayPillar, currentBaziData.hourPillar];
            
            const dayGan = currentBaziData.dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayElement = WUXING[dayGanIndex];
            const dayYinyang = YINYANG[dayGanIndex];
            
            const daYunInfo = getDaYun(
                currentBaziData.year,
                currentBaziData.month,
                currentBaziData.day,
                currentBaziData.gender
            );
            
            const predictions = getPast10YearsAnalysis(
                currentBaziData.yearPillar,
                currentBaziData.monthPillar,
                currentBaziData.dayPillar,
                currentBaziData.hourPillar,
                currentBaziData.gender
            );
            
            let content = `å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ - å…è´¹æŠ¥å‘Š\n`;
            content += `========================================\n\n`;
            
            content += `ä¸€ã€åŸºæœ¬ä¿¡æ¯\n`;
            content += `----------------------------------------\n`;
            content += `å‡ºç”Ÿæ—¶é—´ï¼š${currentBaziData.year}å¹´${currentBaziData.month}æœˆ${currentBaziData.day}æ—¥ ${currentBaziData.hour}\n`;
            content += `æ€§åˆ«ï¼š${currentBaziData.gender === 'male' ? 'ç”·' : 'å¥³'}\n`;
            content += `å‡ºç”Ÿåœ°ï¼š${currentBaziData.location}\n`;
            content += `å…«å­—ï¼š${pillars.join(' ')}\n`;
            content += `æ—¥ä¸»ï¼š${dayGan}ï¼ˆ${dayElement}${dayYinyang}ï¼‰\n\n`;
            
            content += `äºŒã€å…«å­—å››æŸ±\n`;
            content += `----------------------------------------\n`;
            ['å¹´æŸ±', 'æœˆæŸ±', 'æ—¥æŸ±', 'æ—¶æŸ±'].forEach((name, index) => {
                const pillar = pillars[index];
                const gan = pillar[0];
                const zhi = pillar[1];
                const ganIndex = TIANGAN.indexOf(gan);
                const zhiIndex = DIZHI.indexOf(zhi);
                const wuxingGan = WUXING[ganIndex];
                const wuxingZhi = DIZHI_WUXING[zhiIndex];
                const yinyang = YINYANG[ganIndex];
                
                content += `${name}ï¼š${pillar}ï¼ˆ${wuxingGan}${yinyang} + ${wuxingZhi}ï¼‰\n`;
            });
            content += `\n`;
            
            content += `ä¸‰ã€äº”è¡Œåˆ†æ\n`;
            content += `----------------------------------------\n`;
            content += `${getWuxingAnalysis(
                currentBaziData.yearPillar,
                currentBaziData.monthPillar,
                currentBaziData.dayPillar,
                currentBaziData.hourPillar
            )}\n\n`;
            
            content += `å››ã€æœ€è¿‘å¤§è¿åˆ†æ\n`;
            content += `----------------------------------------\n`;
            content += `å½“å‰å¤§è¿ï¼š${daYunInfo.currentDaYun.ganzhi}ï¼ˆ${daYunInfo.direction}ï¼‰\n`;
            content += `å¹´é¾„ï¼š${daYunInfo.currentDaYun.startAge}-${daYunInfo.currentDaYun.endAge}å²\n`;
            
            const daYunAnalysis = getDetailedDaYunAnalysis(
                daYunInfo.currentDaYun.ganzhi,
                currentBaziData.yearPillar,
                currentBaziData.monthPillar,
                currentBaziData.dayPillar,
                currentBaziData.hourPillar
            );
            content += `åˆ†æï¼š${daYunAnalysis}\n\n`;
            
            content += `äº”ã€è¿‡å»10å¹´äº‹æƒ…åˆ¤æ–­ï¼ˆåŸºäºç©¿åˆ‘ç»ç ´ï¼‰\n`;
            content += `----------------------------------------\n`;
            
            // åªæ˜¾ç¤ºæœ€è¿‘3å¹´çš„è¯¦ç»†åˆ†æ
            const recentYears = predictions.slice(-3);
            recentYears.forEach(pred => {
                content += `${pred.type}\n`;
                content += `${pred.effect}\n\n`;
            });
            
            content += `\n`;
            content += `========================================\n`;
            content += `æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}\n`;
            content += `å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ Â© 2024\n`;
            content += `å®¢æœå¾®ä¿¡ï¼šm9311813\n`;
            
            return content;
        }
        
        // ç”Ÿæˆåˆ†äº«è§£é”ç‰ˆæŠ¥å‘Šå†…å®¹
        function generateLevel1ReportContent() {
            const freeContent = generateFreeReportContent();
            
            const advancedAnalysis = getAdvancedAnalysis(
                currentBaziData.yearPillar,
                currentBaziData.monthPillar,
                currentBaziData.dayPillar,
                currentBaziData.hourPillar,
                currentBaziData.gender,
                currentBaziData.year,
                'level1'
            );
            
            let content = freeContent.replace('å…è´¹æŠ¥å‘Š', 'åˆ†äº«è§£é”ç‰ˆæŠ¥å‘Š');
            
            content += `\n\nå…­ã€é«˜çº§åˆ†æï¼ˆåˆ†äº«è§£é”ç‰ˆä¸“å±ï¼‰\n`;
            content += `========================================\n\n`;
            
            advancedAnalysis.forEach(item => {
                content += `${item.title}\n`;
                content += `----------------------------------------\n`;
                content += `${item.content}\n\n`;
            });
            
            content += `ä¸ƒã€æœªæ¥3å¹´æµå¹´è¿åŠ¿åˆ†æ\n`;
            content += `========================================\n\n`;
            
            const currentYear = new Date().getFullYear();
            for (let i = 1; i <= 3; i++) {
                const futureYear = currentYear + i;
                const yearOffset = (futureYear - 1984) % 60;
                const yearGanIndex = yearOffset % 10;
                const yearZhiIndex = yearOffset % 12;
                const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                
                content += `${futureYear}å¹´ï¼ˆ${yearGanzhi}ï¼‰è¯¦ç»†åˆ†æ\n`;
                content += `----------------------------------------\n`;
                content += `${getFutureYearAnalysis(
                    yearGanzhi,
                    currentBaziData.yearPillar,
                    currentBaziData.monthPillar,
                    currentBaziData.dayPillar,
                    currentBaziData.hourPillar,
                    futureYear
                )}\n\n`;
            }
            
            content += `\n========================================\n`;
            content += `å¤‡æ³¨ï¼šæ­¤æŠ¥å‘Šä¸ºåˆ†äº«è§£é”ç‰ˆï¼Œä»·å€¼2000å…ƒ\n`;
            content += `æ„Ÿè°¢æ‚¨åˆ†äº«ç»™10ä½å¥½å‹ï¼Œæ”¯æŒå¤©æœºé˜å‘å±•ï¼\n`;
            
            return content;
        }
        
        // ç”Ÿæˆä»˜è´¹æŠ¥å‘Šå†…å®¹
        function generatePaidReportContent(level) {
            let baseContent = '';
            
            if (level === 'basic') {
                baseContent = generateFreeReportContent().replace('å…è´¹æŠ¥å‘Š', 'åŸºç¡€ç‰ˆæŠ¥å‘Š');
                
                const advancedAnalysis = getAdvancedAnalysis(
                    currentBaziData.yearPillar,
                    currentBaziData.monthPillar,
                    currentBaziData.dayPillar,
                    currentBaziData.hourPillar,
                    currentBaziData.gender,
                    currentBaziData.year,
                    'basic'
                );
                
                baseContent += `\n\nå…­ã€é«˜çº§åˆ†æï¼ˆåŸºç¡€ç‰ˆä¸“å±ï¼‰\n`;
                baseContent += `========================================\n\n`;
                
                advancedAnalysis.forEach(item => {
                    baseContent += `${item.title}\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${item.content}\n\n`;
                });
                
                baseContent += `\n========================================\n`;
                baseContent += `å¤‡æ³¨ï¼šæ­¤æŠ¥å‘Šä¸ºåŸºç¡€ç‰ˆï¼Œä»·å€¼268å…ƒ\n`;
                baseContent += `æ„Ÿè°¢æ‚¨æ”¯æŒå¤©æœºé˜ï¼\n`;
                
            } else if (level === 'level2') {
                baseContent = generateFreeReportContent().replace('å…è´¹æŠ¥å‘Š', 'è¿›é˜¶ç‰ˆæŠ¥å‘Š');
                
                const advancedAnalysis = getAdvancedAnalysis(
                    currentBaziData.yearPillar,
                    currentBaziData.monthPillar,
                    currentBaziData.dayPillar,
                    currentBaziData.hourPillar,
                    currentBaziData.gender,
                    currentBaziData.year,
                    'level2'
                );
                
                baseContent += `\n\nå…­ã€é«˜çº§åˆ†æï¼ˆè¿›é˜¶ç‰ˆä¸“å±ï¼‰\n`;
                baseContent += `========================================\n\n`;
                
                advancedAnalysis.forEach(item => {
                    baseContent += `${item.title}\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${item.content}\n\n`;
                });
                
                baseContent += `ä¸ƒã€æœªæ¥5å¹´æµå¹´è¿åŠ¿åˆ†æ\n`;
                baseContent += `========================================\n\n`;
                
                const currentYear = new Date().getFullYear();
                for (let i = 1; i <= 5; i++) {
                    const futureYear = currentYear + i;
                    const yearOffset = (futureYear - 1984) % 60;
                    const yearGanIndex = yearOffset % 10;
                    const yearZhiIndex = yearOffset % 12;
                    const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                    
                    baseContent += `${futureYear}å¹´ï¼ˆ${yearGanzhi}ï¼‰è¯¦ç»†åˆ†æ\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${getFutureYearAnalysis(
                        yearGanzhi,
                        currentBaziData.yearPillar,
                        currentBaziData.monthPillar,
                        currentBaziData.dayPillar,
                        currentBaziData.hourPillar,
                        futureYear
                    )}\n\n`;
                }
                
                baseContent += `\n========================================\n`;
                baseContent += `å¤‡æ³¨ï¼šæ­¤æŠ¥å‘Šä¸ºè¿›é˜¶ç‰ˆï¼Œä»·å€¼368å…ƒ\n`;
                baseContent += `æ„Ÿè°¢æ‚¨æ”¯æŒå¤©æœºé˜ï¼\n`;
                
            } else if (level === 'pro') {
                baseContent = generateFreeReportContent().replace('å…è´¹æŠ¥å‘Š', 'ä¸“ä¸šç‰ˆæŠ¥å‘Š');
                
                const advancedAnalysis = getAdvancedAnalysis(
                    currentBaziData.yearPillar,
                    currentBaziData.monthPillar,
                    currentBaziData.dayPillar,
                    currentBaziData.hourPillar,
                    currentBaziData.gender,
                    currentBaziData.year,
                    'pro'
                );
                
                baseContent += `\n\nå…­ã€é«˜çº§åˆ†æï¼ˆä¸“ä¸šç‰ˆä¸“å±ï¼‰\n`;
                baseContent += `========================================\n\n`;
                
                advancedAnalysis.forEach(item => {
                    baseContent += `${item.title}\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${item.content}\n\n`;
                });
                
                baseContent += `ä¸ƒã€æœªæ¥10å¹´æµå¹´è¿åŠ¿åˆ†æ\n`;
                baseContent += `========================================\n\n`;
                
                const currentYear = new Date().getFullYear();
                for (let i = 1; i <= 10; i++) {
                    const futureYear = currentYear + i;
                    const yearOffset = (futureYear - 1984) % 60;
                    const yearGanIndex = yearOffset % 10;
                    const yearZhiIndex = yearOffset % 12;
                    const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                    
                    baseContent += `${futureYear}å¹´ï¼ˆ${yearGanzhi}ï¼‰è¯¦ç»†åˆ†æ\n`;
                    baseContent += `----------------------------------------\n`;
                    content += `${getFutureYearAnalysis(
                        yearGanzhi,
                        currentBaziData.yearPillar,
                        currentBaziData.monthPillar,
                        currentBaziData.dayPillar,
                        currentBaziData.hourPillar,
                        futureYear
                    )}\n\n`;
                }
                
                baseContent += `\n========================================\n`;
                baseContent += `å¤‡æ³¨ï¼šæ­¤æŠ¥å‘Šä¸ºä¸“ä¸šç‰ˆï¼Œä»·å€¼568å…ƒ\n`;
                baseContent += `åŒ…å«ä¸“å®¶ç­”ç–‘3æ¬¡ï¼Œå®¢æœå¾®ä¿¡ï¼šm9311813\n`;
                
            } else if (level === 'vip') {
                baseContent = generateFreeReportContent().replace('å…è´¹æŠ¥å‘Š', 'å°Šäº«ç‰ˆæŠ¥å‘Š');
                
                const advancedAnalysis = getAdvancedAnalysis(
                    currentBaziData.yearPillar,
                    currentBaziData.monthPillar,
                    currentBaziData.dayPillar,
                    currentBaziData.hourPillar,
                    currentBaziData.gender,
                    currentBaziData.year,
                    'vip'
                );
                
                baseContent += `\n\nå…­ã€é‡å­ç®—æ³•æ·±åº¦è§£æï¼ˆå°Šäº«ç‰ˆä¸“å±ï¼‰\n`;
                baseContent += `========================================\n\n`;
                
                advancedAnalysis.forEach(item => {
                    baseContent += `${item.title}\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${item.content}\n\n`;
                });
                
                baseContent += `ä¸ƒã€æœªæ¥20å¹´æµå¹´è¿åŠ¿åˆ†æ\n`;
                baseContent += `========================================\n\n`;
                
                const currentYear = new Date().getFullYear();
                for (let i = 1; i <= 20; i++) {
                    const futureYear = currentYear + i;
                    const yearOffset = (futureYear - 1984) % 60;
                    const yearGanIndex = yearOffset % 10;
                    const yearZhiIndex = yearOffset % 12;
                    const yearGanzhi = TIANGAN[yearGanIndex] + DIZHI[yearZhiIndex];
                    
                    baseContent += `${futureYear}å¹´ï¼ˆ${yearGanzhi}ï¼‰è¯¦ç»†åˆ†æ\n`;
                    baseContent += `----------------------------------------\n`;
                    baseContent += `${getFutureYearAnalysis(
                        yearGanzhi,
                        currentBaziData.yearPillar,
                        currentBaziData.monthPillar,
                        currentBaziData.dayPillar,
                        currentBaziData.hourPillar,
                        futureYear
                    )}\n\n`;
                }
                
                baseContent += `\n========================================\n`;
                baseContent += `å¤‡æ³¨ï¼šæ­¤æŠ¥å‘Šä¸ºå°Šäº«ç‰ˆï¼Œä»·å€¼888å…ƒ\n`;
                baseContent += `åŒ…å«ç»ˆèº«å…è´¹å‡çº§ï¼Œä¸“å®¶ç­”ç–‘10æ¬¡\n`;
                baseContent += `VIPå®¢æœä¸“å±é€šé“ï¼Œå®¢æœå¾®ä¿¡ï¼šm9311813\n`;
            }
            
            return baseContent;
        }
        
        // ä¸‹è½½TXTæŠ¥å‘Š
        function downloadTXTReport(content, version) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `å…«å­—æ’ç›˜æŠ¥å‘Š_${currentBaziData.year}å¹´${currentBaziData.month}æœˆ${currentBaziData.day}æ—¥_${version}.txt`;
            link.click();
        }
        
        // ä¸‹è½½WordæŠ¥å‘Š
        function downloadWordReport(content, version) {
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>å…«å­—æ’ç›˜æŠ¥å‘Š - ${version}</title>
                    <style>
                        body { font-family: 'Microsoft YaHei', sans-serif; margin: 40px; line-height: 1.6; }
                        h1 { color: #8b0000; text-align: center; }
                        h2 { color: #8b0000; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
                        h3 { color: #007bff; }
                        .section { margin-bottom: 30px; }
                        .pillar-box { border: 2px solid #8b0000; padding: 15px; margin: 10px; text-align: center; display: inline-block; width: 180px; }
                        .footer { text-align: center; color: #666; margin-top: 40px; font-size: 12px; }
                    </style>
                </head>
                <body>
                    ${content.split('\n').map(line => {
                        if (line.includes('========================================')) {
                            return '<hr>';
                        } else if (line.includes('---')) {
                            return '<hr style="border-top: 1px solid #ddd; margin: 20px 0;">';
                        } else if (line.match(/^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]ã€/)) {
                            return `<h2>${line}</h2>`;
                        } else if (line.match(/^[0-9]{4}å¹´/)) {
                            return `<h3>${line}</h3>`;
                        } else if (line.trim() === '') {
                            return '<p>&nbsp;</p>';
                        } else {
                            return `<p>${line}</p>`;
                        }
                    }).join('')}
                    <div class="footer">
                        <p>å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ Â© 2024</p>
                        <p>ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}</p>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `å…«å­—æ’ç›˜æŠ¥å‘Š_${currentBaziData.year}å¹´${currentBaziData.month}æœˆ${currentBaziData.day}æ—¥_${version}.doc`;
            link.click();
        }
        
        // ä¸‹è½½å›¾ç‰‡æŠ¥å‘Š
        function downloadImageReport(content, version) {
            showLoading();
            
            const htmlContent = `
                <div id="reportImage" style="
                    width: 800px;
                    padding: 40px;
                    background: white;
                    color: #333;
                    font-family: 'Microsoft YaHei', sans-serif;
                    line-height: 1.6;
                ">
                    <h1 style="color: #8b0000; text-align: center; margin-bottom: 20px;">å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ</h1>
                    <h2 style="color: #8b0000; text-align: center; margin-bottom: 40px;">${version}æŠ¥å‘Š</h2>
                    
                    ${content.split('\n').map(line => {
                        if (line.includes('========================================')) {
                            return '<hr style="border-top: 2px solid #8b0000; margin: 30px 0;">';
                        } else if (line.includes('---')) {
                            return '<hr style="border-top: 1px solid #ddd; margin: 20px 0;">';
                        } else if (line.match(/^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]ã€/)) {
                            return `<h3 style="color: #8b0000; font-size: 18px; margin: 25px 0 15px 0;">${line}</h3>`;
                        } else if (line.match(/^[0-9]{4}å¹´/)) {
                            return `<h4 style="color: #007bff; font-size: 16px; margin: 20px 0 10px 0;">${line}</h4>`;
                        } else if (line.trim() === '') {
                            return '<div style="height: 10px;"></div>';
                        } else {
                            return `<p style="margin: 5px 0;">${line}</p>`;
                        }
                    }).join('')}
                    
                    <div style="text-align: center; margin-top: 40px; color: #666; font-size: 12px;">
                        <p>ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}</p>
                        <p>å¤©æœºé˜å…«å­—é‡å­åˆ†æç³»ç»Ÿ Â© 2024</p>
                    </div>
                </div>
            `;
            
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'fixed';
            tempDiv.style.left = '-9999px';
            tempDiv.style.top = '0';
            tempDiv.innerHTML = htmlContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv.querySelector('#reportImage'), {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `å…«å­—æ’ç›˜æŠ¥å‘Š_${currentBaziData.year}å¹´${currentBaziData.month}æœˆ${currentBaziData.day}æ—¥_${version}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                document.body.removeChild(tempDiv);
                hideLoading();
                alert('å›¾ç‰‡æŠ¥å‘Šå·²ç”Ÿæˆï¼');
            }).catch(error => {
                console.error("å›¾ç‰‡ç”Ÿæˆå¤±è´¥:", error);
                document.body.removeChild(tempDiv);
                hideLoading();
                alert('å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ã€‚');
            });
        }
        
        // ==================== 10. æ”¯ä»˜åŠŸèƒ½ ====================
        
        let currentLevel = 'free';
        let shareCount = parseInt(localStorage.getItem('bazi_share_count')) || 0;
        let isUnlockedLevel1 = localStorage.getItem('bazi_unlocked_level1') === 'true';
        
        function updateShareButton() {
            const shareBtn = document.getElementById('shareUnlockBtn');
            const shareTier = document.getElementById('shareUnlockTier');
            
            if (isUnlockedLevel1) {
                shareBtn.textContent = 'å·²è§£é”';
                shareBtn.style.background = '#28a745';
                shareBtn.disabled = true;
                shareTier.style.display = 'block';
            } else {
                shareBtn.textContent = `åˆ†äº«è§£é” (${shareCount}/10)`;
                shareBtn.style.background = '#07c160';
                shareBtn.disabled = false;
                shareTier.style.display = 'none';
            }
            
            // æ›´æ–°åˆ†äº«è®¡æ•°æ˜¾ç¤º
            document.getElementById('shareCounter').textContent = shareCount;
        }
        
        function openPayment(type) {
            currentLevel = type;
            const plans = {
                basic: {
                    name: "åŸºç¡€ç‰ˆ",
                    price: "268",
                    features: [
                        "å®Œæ•´å…«å­—åˆ†æ",
                        "è¿‡å»10å¹´äº‹æƒ…åˆ¤æ–­",
                        "æœ€è¿‘å¤§è¿è¯¦ç»†åˆ†æ",
                        "äº”è¡Œè¯¦ç»†åˆ†æ",
                        "åŸå±€æ ¼å±€å±‚æ¬¡åˆ†æ",
                        "åšåŠŸåˆ¶ç”¨åˆ†æ",
                        "WORD/TXT/å›¾ç‰‡ä¸‰æ ¼å¼æŠ¥å‘Š"
                    ]
                },
                level1: {
                    name: "åˆ†äº«è§£é”ç‰ˆ",
                    price: "268",
                    features: [
                        "åŸºç¡€ç‰ˆæ‰€æœ‰åŠŸèƒ½",
                        "æœªæ¥3å¹´æµå¹´è¯¦ç»†åˆ†æ",
                        "åŸå±€æ ¼å±€å±‚æ¬¡æ·±åº¦åˆ†æ",
                        "ä¸“ä¸šWORD/TXT/å›¾ç‰‡æŠ¥å‘Š",
                        "ä»·å€¼2000å…ƒï¼Œåˆ†äº«å…è´¹"
                    ]
                },
                level2: {
                    name: "è¿›é˜¶ç‰ˆ",
                    price: "368",
                    features: [
                        "åŸºç¡€ç‰ˆæ‰€æœ‰åŠŸèƒ½",
                        "æœªæ¥5å¹´æµå¹´è¯¦ç»†åˆ†æ",
                        "åŸå±€æ ¼å±€å±‚æ¬¡æ·±åº¦åˆ†æ",
                        "åšåŠŸåˆ¶ç”¨æ·±åº¦åˆ†æ",
                        "ä¸“ä¸šWORD/TXT/å›¾ç‰‡æŠ¥å‘Š"
                    ]
                },
                pro: {
                    name: "ä¸“ä¸šç‰ˆ",
                    price: "568",
                    features: [
                        "è¿›é˜¶ç‰ˆæ‰€æœ‰åŠŸèƒ½",
                        "æœªæ¥10å¹´æµå¹´è¯¦ç»†åˆ†æ",
                        "ç»Ÿå±€åå±€æ·±åº¦åˆ†æ",
                        "å–œå¿Œå­£èŠ‚è°ƒå€™åˆ†æ",
                        "å¤©å¹²æœˆä»¤æ–­è¯­åˆ†æ",
                        "ä¸“å®¶ç­”ç–‘3æ¬¡",
                        "VIPå®¢æœæ”¯æŒ"
                    ]
                },
                vip: {
                    name: "å°Šäº«ç‰ˆ",
                    price: "888",
                    features: [
                        "ä¸“ä¸šç‰ˆæ‰€æœ‰åŠŸèƒ½",
                        "æœªæ¥20å¹´æµå¹´è¯¦ç»†åˆ†æ",
                        "é‡å­ç®—æ³•æ·±åº¦è§£æ",
                        "ç»ˆèº«å…è´¹å‡çº§",
                        "ä¸“å®¶ç­”ç–‘10æ¬¡",
                        "VIPå®¢æœä¸“å±é€šé“",
                        "ä¸ªæ€§åŒ–å‘½ç†æŒ‡å¯¼"
                    ]
                }
            };
            
            const plan = plans[type];
            
            const paymentHTML = `
                <h2 style="color: var(--golden-yellow); text-align: center; margin-bottom: 30px;">
                    <i class="fas fa-crown"></i> å‡çº§${plan.name}
                </h2>
                
                <div style="background: rgba(0,0,0,0.7); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2.5rem; color: var(--golden-yellow); font-weight: bold;">Â¥${plan.price}</div>
                        <div style="color: var(--pearl-white); margin-top: 10px;">ä¸€æ¬¡æ€§ä»˜æ¬¾ï¼Œæ°¸ä¹…ä½¿ç”¨</div>
                    </div>
                    
                    <ul style="color: var(--pearl-white); list-style: none; padding: 0;">
                        ${plan.features.map(feature => `
                            <li style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <i class="fas fa-check-circle" style="color: var(--success-green); margin-right: 10px;"></i>
                                ${feature}
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                <div style="text-align: center;">
                    ${type === 'level1' && !isUnlockedLevel1 ? `
                        <div style="color: var(--golden-yellow); margin-bottom: 20px; padding: 15px; background: rgba(7, 193, 96, 0.2); border-radius: 10px;">
                            <i class="fas fa-gift"></i> æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åˆ†äº«ç»™10ä½å¥½å‹å…è´¹è§£é”æ­¤ç‰ˆæœ¬ï¼
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 30px;">
                        <button onclick="selectPaymentMethod('${type}')" style="
                            padding: 15px 30px;
                            background: #07c160;
                            color: white;
                            border: none;
                            border-radius: 10px;
                            cursor: pointer;
                            font-size: 1.1rem;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        ">
                            <i class="fab fa-weixin"></i> å¾®ä¿¡æ”¯ä»˜
                        </button>
                    </div>
                    
                    <div id="paymentQRCode" style="display: none; margin: 20px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="color: var(--pearl-white); font-size: 1.1rem; margin-bottom: 10px;">è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç ä»˜æ¬¾</div>
                            <div style="color: var(--golden-yellow); font-size: 1.2rem; margin-bottom: 20px;">å®¢æœå¾®ä¿¡ï¼šm9311813</div>
                            <div style="color: var(--pearl-white); font-size: 1rem; margin-bottom: 20px;">ä»˜æ¬¾é‡‘é¢ï¼šÂ¥${plan.price}</div>
                            <div style="color: var(--pearl-white); font-size: 0.9rem; margin-bottom: 20px;">è¯·åœ¨ä»˜æ¬¾å¤‡æ³¨ä¸­æ³¨æ˜ï¼šå…«å­—æ’ç›˜${plan.name}</div>
                        </div>
                        <div id="qrcodeContainer" style="display: flex; justify-content: center; margin: 20px 0;"></div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="completePayment('${type}')" style="
                                padding: 15px 30px;
                                background: linear-gradient(145deg, var(--success-green), #2E7D32);
                                color: white;
                                border: none;
                                border-radius: 10px;
                                font-size: 1.1rem;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                margin: 0 auto;
                            ">
                                <i class="fas fa-check"></i> æˆ‘å·²æ”¯ä»˜å®Œæˆ
                            </button>
                            <button onclick="showPaymentHelp()" style="
                                padding: 10px 20px;
                                background: transparent;
                                color: var(--quantum-blue);
                                border: 1px solid var(--quantum-blue);
                                border-radius: 5px;
                                cursor: pointer;
                                margin-top: 15px;
                                font-size: 0.9rem;
                            ">
                                <i class="fas fa-question-circle"></i> æ”¯ä»˜é‡åˆ°é—®é¢˜ï¼Ÿ
                            </button>
                        </div>
                    </div>
                    
                    <div id="paymentComplete" style="display: none; margin: 20px 0;">
                        <div style="color: var(--success-green); font-size: 1.5rem; margin-bottom: 20px;">
                            <i class="fas fa-check-circle"></i> æ”¯ä»˜æˆåŠŸï¼
                        </div>
                        <p style="color: var(--pearl-white);">æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„å‘½ç†æŠ¥å‘Š...</p>
                        <div id="reportDownloadLinks" style="margin-top: 20px;"></div>
                    </div>
                    
                    <div id="paymentHelp" style="display: none; margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 10px;">
                        <h4 style="color: var(--golden-yellow); margin-bottom: 15px;">æ”¯ä»˜å¸®åŠ©</h4>
                        <p style="color: var(--pearl-white); margin-bottom: 10px;">1. æ‰«æäºŒç»´ç åï¼Œè¯·åœ¨å¾®ä¿¡ä¸­å®Œæˆæ”¯ä»˜</p>
                        <p style="color: var(--pearl-white); margin-bottom: 10px;">2. æ”¯ä»˜å®Œæˆåï¼Œè¯·ç‚¹å‡»"æˆ‘å·²æ”¯ä»˜å®Œæˆ"æŒ‰é’®</p>
                        <p style="color: var(--pearl-white); margin-bottom: 10px;">3. ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ‚¨ç”ŸæˆæŠ¥å‘Šå¹¶æä¾›ä¸‹è½½é“¾æ¥</p>
                        <p style="color: var(--pearl-white); margin-bottom: 10px;">4. å¦‚é‡ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»å®¢æœå¾®ä¿¡ï¼šm9311813</p>
                        <button onclick="hidePaymentHelp()" style="
                            padding: 10px 20px;
                            background: var(--quantum-blue);
                            color: white;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            margin-top: 10px;
                        ">
                            å…³é—­å¸®åŠ©
                        </button>
                    </div>
                    
                    <div style="color: var(--pearl-white); margin-top: 20px; font-size: 0.9rem;">
                        <p>æ”¯ä»˜æˆåŠŸåï¼Œé«˜çº§åŠŸèƒ½å°†ç«‹å³è§£é”ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š</p>
                        <p>å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœå¾®ä¿¡ï¼šm9311813</p>
                    </div>
                </div>
            `;
            
            document.getElementById('paymentContent').innerHTML = paymentHTML;
            document.getElementById('paymentModal').style.display = 'flex';
        }
        
        function selectPaymentMethod(type) {
            currentLevel = type;
            
            document.getElementById('qrcodeContainer').innerHTML = '';
            
            // ç”Ÿæˆä»˜æ¬¾äºŒç»´ç 
            const paymentInfo = {
                type: type,
                name: levelNames[type],
                price: getPriceByType(type),
                time: Date.now(),
                orderId: 'BZ' + Date.now() + Math.floor(Math.random() * 1000)
            };
            
            // ä½¿ç”¨é™æ€äºŒç»´ç æˆ–æ”¯ä»˜é“¾æ¥
            const qrText = `https://wx.qq.com/cgi-bin/mmwebwx-bin/webwxsendmsg?pass_ticket=xxx&lang=zh_CN`;
            
            new QRCode(document.getElementById('qrcodeContainer'), {
                text: qrText,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            document.getElementById('paymentQRCode').style.display = 'block';
        }
        
        function getPriceByType(type) {
            switch(type) {
                case 'basic': return 268;
                case 'level1': return 268;
                case 'level2': return 368;
                case 'pro': return 568;
                case 'vip': return 888;
                default: return 268;
            }
        }
        
        function showPaymentHelp() {
            document.getElementById('paymentHelp').style.display = 'block';
        }
        
        function hidePaymentHelp() {
            document.getElementById('paymentHelp').style.display = 'none';
        }
        
        function completePayment(type) {
            currentLevel = type;
            
            document.getElementById('paymentQRCode').style.display = 'none';
            document.getElementById('paymentComplete').style.display = 'block';
            
            // ç”ŸæˆæŠ¥å‘Šä¸‹è½½é“¾æ¥
            const reportLinks = document.getElementById('reportDownloadLinks');
            reportLinks.innerHTML = `
                <div style="color: var(--pearl-white); margin-bottom: 15px;">è¯·é€‰æ‹©æŠ¥å‘Šæ ¼å¼ä¸‹è½½ï¼š</div>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="downloadPaidReport('${type}', 'word')" style="
                        padding: 12px 20px;
                        background: #2196F3;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    ">
                        <i class="fas fa-file-word"></i> WORDæŠ¥å‘Š
                    </button>
                    <button onclick="downloadPaidReport('${type}', 'txt')" style="
                        padding: 12px 20px;
                        background: #4CAF50;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    ">
                        <i class="fas fa-file-alt"></i> TXTæŠ¥å‘Š
                    </button>
                    <button onclick="downloadPaidReport('${type}', 'image')" style="
                        padding: 12px 20px;
                        background: #FF9800;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    ">
                        <i class="fas fa-file-image"></i> å›¾ç‰‡æŠ¥å‘Š
                    </button>
                </div>
                <div style="color: var(--pearl-white); margin-top: 20px; font-size: 0.9rem;">
                    æ‰€æœ‰æ ¼å¼æŠ¥å‘Šå†…å®¹ç›¸åŒï¼Œè¯·æ ¹æ®éœ€è¦é€‰æ‹©ä¸‹è½½
                </div>
            `;
            
            // è®°å½•æ”¯ä»˜ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰
            const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            localStorage.setItem('bazi_user_id', userId);
            
            paidUsers[userId] = {
                wechatId: 'å·²æ”¯ä»˜ç”¨æˆ·',
                orderId: 'BZ' + Date.now(),
                level: type,
                verifiedAt: Date.now(),
                expires: Date.now() + (10 * 365 * 24 * 60 * 60 * 1000) // 10å¹´æœ‰æ•ˆæœŸ
            };
            
            savePaidUsers();
            
            // è§£é”é«˜çº§åŠŸèƒ½
            unlockPremiumFeatures(type);
            
            // 3ç§’åè‡ªåŠ¨å…³é—­æ¨¡æ€æ¡†
            setTimeout(() => {
                closeModal('paymentModal');
            }, 3000);
        }
        
        function downloadPaidReport(level, format) {
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                const content = generatePaidReportContent(level);
                
                if (format === 'word') {
                    downloadWordReport(content, levelNames[level]);
                } else if (format === 'txt') {
                    downloadTXTReport(content, levelNames[level]);
                } else if (format === 'image') {
                    downloadImageReport(content, levelNames[level]);
                }
                
                hideLoading();
                alert(`${levelNames[level]}æŠ¥å‘Šå·²ç”Ÿæˆï¼`);
            }, 500);
        }
        
        function unlockPremiumFeatures(level) {
            currentLevel = level;
            
            // æ˜¾ç¤ºé«˜çº§åˆ†æåŒºåŸŸ
            document.getElementById('advancedFeatures').style.display = 'block';
            
            if (currentBaziData) {
                const advancedAnalysis = getAdvancedAnalysis(
                    currentBaziData.yearPillar, 
                    currentBaziData.monthPillar, 
                    currentBaziData.dayPillar, 
                    currentBaziData.hourPillar,
                    currentBaziData.gender,
                    currentBaziData.year,
                    level
                );
                
                let analysisHTML = '<div class="advanced-analysis-grid">';
                advancedAnalysis.forEach(item => {
                    analysisHTML += `
                        <div class="advanced-analysis-card">
                            <div class="advanced-title">${item.title}</div>
                            <div class="advanced-content">${item.content}</div>
                        </div>
                    `;
                });
                analysisHTML += '</div>';
                
                document.getElementById('advancedAnalysis').innerHTML = analysisHTML;
                
                // æ›´æ–°åˆ†äº«è¿›åº¦æ˜¾ç¤º
                if (isUnlockedLevel1) {
                    document.getElementById('shareProgress').style.display = 'none';
                }
            }
        }
        
        // ==================== 11. åˆ†äº«åŠŸèƒ½ä¼˜åŒ– ====================
        function generateShareLink() {
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            // ç”Ÿæˆå”¯ä¸€çš„åˆ†äº«ID
            const shareId = Date.now().toString(36) + Math.random().toString(36).substr(2);
            const baziData = {
                year: currentBaziData.year,
                month: currentBaziData.month,
                day: currentBaziData.day,
                hour: currentBaziData.hourValue,
                gender: currentBaziData.gender,
                location: currentBaziData.location,
                timestamp: Date.now()
            };
            
            // å­˜å‚¨åˆ†äº«æ•°æ®
            localStorage.setItem(`bazi_share_${shareId}`, JSON.stringify(baziData));
            
            // ç”Ÿæˆåˆ†äº«é“¾æ¥
            const currentUrl = window.location.href.split('?')[0];
            const shareLink = `${currentUrl}?share=${shareId}`;
            
            document.getElementById('shareLinkInput').value = shareLink;
            
            // ç”ŸæˆäºŒç»´ç 
            document.getElementById('qrcodeShare').innerHTML = '';
            new QRCode(document.getElementById('qrcodeShare'), {
                text: shareLink,
                width: 150,
                height: 150,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            document.getElementById('shareModal').style.display = 'flex';
        }
        
        function copyShareLink() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            document.execCommand('copy');
            alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            
            // å¢åŠ åˆ†äº«è®¡æ•°
            increaseShareCount();
        }
        
        function shareToWeChat() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            document.execCommand('copy');
            alert('é“¾æ¥å·²å¤åˆ¶ï¼è¯·æ‰“å¼€å¾®ä¿¡ç²˜è´´åˆ†äº«ç»™å¥½å‹ã€‚');
            
            // å¢åŠ åˆ†äº«è®¡æ•°
            increaseShareCount();
        }
        
        function increaseShareCount() {
            shareCount++;
            localStorage.setItem('bazi_share_count', shareCount);
            
            document.getElementById('shareCounter').textContent = shareCount;
            
            // æ›´æ–°åˆ†äº«è¿›åº¦
            const progress = Math.min((shareCount / 10) * 100, 100);
            document.getElementById('shareCount').textContent = shareCount;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // æ˜¾ç¤ºåˆ†äº«è¿›åº¦
            document.getElementById('shareProgress').style.display = 'block';
            
            // æ£€æŸ¥æ˜¯å¦è§£é”
            if (shareCount >= 10 && !isUnlockedLevel1) {
                isUnlockedLevel1 = true;
                localStorage.setItem('bazi_unlocked_level1', 'true');
                unlockLevel1Premium();
                alert('æ­å–œï¼å·²æˆåŠŸåˆ†äº«ç»™10ä½å¥½å‹ï¼Œæœªæ¥3å¹´æµå¹´è¿åŠ¿åˆ†æå·²å…è´¹è§£é”ï¼');
            }
            
            // æ›´æ–°åˆ†äº«æŒ‰é’®
            updateShareButton();
        }
        
        function unlockLevel1Premium() {
            currentLevel = 'level1';
            unlockPremiumFeatures('level1');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateShareButton();
            
            // æ˜¾ç¤ºåˆ†äº«è§£é”ç‰ˆä¸‹è½½åŒºåŸŸ
            document.getElementById('shareUnlockTier').style.display = 'block';
        }
        
        // ==================== 12. ä¸»è®¡ç®—å‡½æ•° ====================
        let currentBaziData = null;
        
        function calculateBazi() {
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value);
            const location = document.getElementById('location').value;
            const gender = document.querySelector('.gender-option.active').dataset.gender;
            
            if (!year || !month || !day) {
                alert("è¯·è¾“å…¥å®Œæ•´çš„å‡ºç”Ÿæ—¥æœŸ");
                return;
            }
            
            if (day < 1 || day > 31) {
                alert("æ—¥æœŸå¿…é¡»åœ¨1-31ä¹‹é—´");
                return;
            }
            
            if (month < 1 || month > 12) {
                alert("æœˆä»½å¿…é¡»åœ¨1-12ä¹‹é—´");
                return;
            }
            
            if (year < 1940 || year > 2030) {
                alert("å¹´ä»½å¿…é¡»åœ¨1940-2030ä¹‹é—´");
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                try {
                    const yearPillar = getYearPillar(year, month, day);
                    const monthPillar = getMonthPillar(year, month, day);
                    const dayPillar = getDayPillar(year, month, day);
                    const hourPillar = getHourPillar(year, month, day, hour);
                    
                    currentBaziData = {
                        year, month, day, hour: `${hour}æ—¶`, 
                        hourValue: hour,
                        location, gender,
                        yearPillar, monthPillar, dayPillar, hourPillar
                    };
                    
                    document.getElementById('resultDisplay').style.display = 'block';
                    document.getElementById('reportDownloads').style.display = 'block';
                    displayExactCalculation(year, month, day, hour, yearPillar, monthPillar, dayPillar, hourPillar);
                    displayBaziGrid(yearPillar, monthPillar, dayPillar, hourPillar);
                    displayBaziSummary(yearPillar, monthPillar, dayPillar, hourPillar);
                    displayPredictions(yearPillar, monthPillar, dayPillar, hourPillar, gender);
                    
                    // æ£€æŸ¥åˆ†äº«è®¡æ•°å’Œå·²è§£é”çŠ¶æ€
                    if (shareCount > 0) {
                        const progress = Math.min((shareCount / 10) * 100, 100);
                        document.getElementById('shareCount').textContent = shareCount;
                        document.getElementById('progressFill').style.width = `${progress}%`;
                        document.getElementById('shareProgress').style.display = 'block';
                    }
                    
                    if (isUnlockedLevel1) {
                        document.getElementById('advancedFeatures').style.display = 'block';
                        document.getElementById('shareUnlockTier').style.display = 'block';
                        unlockPremiumFeatures('level1');
                    }
                    
                    // æ›´æ–°åˆ†äº«æŒ‰é’®
                    updateShareButton();
                    
                    hideLoading();
                    
                } catch (error) {
                    console.error("è®¡ç®—é”™è¯¯:", error);
                    hideLoading();
                    alert("è®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚");
                }
            }, 1000);
        }
        
        function displayExactCalculation(year, month, day, hour, yearPillar, monthPillar, dayPillar, hourPillar) {
            const lichunDate = getSolarTermDate(year, "ç«‹æ˜¥");
            
            let details = `
                <div style="margin-bottom: 15px;">
                    <strong>è¾“å…¥ä¿¡æ¯ï¼š</strong><br>
                    å…¬å†ï¼š${year}å¹´${month}æœˆ${day}æ—¥ ${hour}æ—¶<br>
                    æ€§åˆ«ï¼š${document.querySelector('.gender-option.active').dataset.gender === 'male' ? 'ç”·' : 'å¥³'}<br>
                    åœ°ç‚¹ï¼š${document.getElementById('location').value}
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>å¹´æŸ±è®¡ç®—ï¼ˆç«‹æ˜¥åˆ†ç•Œï¼‰ï¼š</strong><br>
                    ${year}å¹´ç«‹æ˜¥åœ¨${lichunDate || '02-04'}<br>
                    åˆ¤æ–­ï¼š${month}æœˆ${day}æ—¥ ${month === 2 && day < 4 ? 'åœ¨ç«‹æ˜¥å‰' : 'åœ¨ç«‹æ˜¥å'}<br>
                    å®é™…å¹´æŸ±ï¼š${yearPillar}
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>æœˆæŸ±è®¡ç®—ï¼ˆäº”è™éï¼‰ï¼š</strong><br>
                    å¹´å¹²${yearPillar[0]} â†’ ${getWuhuDunKoujue(yearPillar[0])}<br>
                    æœˆæ”¯ä¸º${monthPillar[1]}æœˆ<br>
                    æœˆæŸ±ï¼š${monthPillar}
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>æ—¥æŸ±è®¡ç®—ï¼ˆé‡å­ç®—æ³•ä¿®æ­£ï¼‰ï¼š</strong><br>
                    ä¸‡å¹´å†æŸ¥è¡¨ç»“åˆé‡å­ç®—æ³•ä¼˜åŒ–<br>
                    ä¿®æ­£åæ—¥æŸ±ï¼š${dayPillar}
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>æ—¶æŸ±è®¡ç®—ï¼ˆäº”é¼ éï¼‰ï¼š</strong><br>
                    æ—¥å¹²${dayPillar[0]} â†’ ${getWushuDunKoujue(dayPillar[0])}<br>
                    ${hour}æ—¶å¯¹åº”${hourPillar[1]}æ—¶<br>
                    æ—¶æŸ±ï¼š${hourPillar}
                </div>
            `;
            
            document.getElementById('exactDetails').innerHTML = details;
        }
        
        function getWuhuDunKoujue(yearGan) {
            const index = TIANGAN.indexOf(yearGan);
            switch(index) {
                case 0: case 5: return "ç”²å·±ä¹‹å¹´ä¸™ä½œé¦–";
                case 1: case 6: return "ä¹™åºšä¹‹å¹´æˆŠä¸ºå¤´";
                case 2: case 7: return "ä¸™è¾›ä¹‹å¹´å¯»åºšèµ·";
                case 3: case 8: return "ä¸å£¬å£¬ä½é¡ºè¡Œæµ";
                case 4: case 9: return "è‹¥é—®æˆŠç™¸ä½•å¤„å‘ï¼Œç”²å¯…ä¹‹ä¸Šå¥½è¿½æ±‚";
                default: return "æœªçŸ¥";
            }
        }
        
        function getWushuDunKoujue(dayGan) {
            const index = TIANGAN.indexOf(dayGan);
            switch(index) {
                case 0: case 5: return "ç”²å·±è¿˜åŠ ç”²";
                case 1: case 6: return "ä¹™åºšä¸™ä½œåˆ";
                case 2: case 7: return "ä¸™è¾›ä»æˆŠèµ·";
                case 3: case 8: return "ä¸å£¬åºšå­å±…";
                case 4: case 9: return "æˆŠç™¸ä½•æ–¹å‘ï¼Œå£¬å­æ˜¯çœŸé€”";
                default: return "æœªçŸ¥";
            }
        }
        
        function displayBaziGrid(yearPillar, monthPillar, dayPillar, hourPillar) {
            const pillars = [yearPillar, monthPillar, dayPillar, hourPillar];
            const pillarNames = ["å¹´æŸ±", "æœˆæŸ±", "æ—¥æŸ±", "æ—¶æŸ±"];
            
            let gridHTML = '<div class="bazi-grid-inner">';
            
            pillars.forEach((pillar, index) => {
                const gan = pillar[0];
                const zhi = pillar[1];
                const ganIndex = TIANGAN.indexOf(gan);
                const zhiIndex = DIZHI.indexOf(zhi);
                const wuxingGan = WUXING[ganIndex];
                const wuxingZhi = DIZHI_WUXING[zhiIndex];
                const yinyang = YINYANG[ganIndex];
                
                gridHTML += `
                    <div class="bazi-pillar">
                        <div class="pillar-name">${pillarNames[index]}</div>
                        <div class="pillar-ganzhi">${pillar}</div>
                        <div class="pillar-detail">
                            <div>å¤©å¹²ï¼š${gan} (${wuxingGan}${yinyang})</div>
                            <div>åœ°æ”¯ï¼š${zhi} (${wuxingZhi})</div>
                        </div>
                    </div>
                `;
            });
            
            gridHTML += '</div>';
            document.getElementById('baziGrid').innerHTML = gridHTML;
        }
        
        function displayBaziSummary(yearPillar, monthPillar, dayPillar, hourPillar) {
            const dayGan = dayPillar[0];
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayElement = WUXING[dayGanIndex];
            const dayYinyang = YINYANG[dayGanIndex];
            
            const wuxingAnalysis = getWuxingAnalysis(yearPillar, monthPillar, dayPillar, hourPillar);
            
            let summaryHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--golden-yellow); margin-bottom: 10px;">å…«å­—å…¨è²Œï¼ˆé‡å­ç®—æ³•ä¿®æ­£ç‰ˆï¼‰</h3>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--quantum-blue); text-align: center; margin: 20px 0;">
                        ${yearPillar} ${monthPillar} ${dayPillar} ${hourPillar}
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--golden-yellow); margin-bottom: 10px;">æ—¥ä¸»åˆ†æ</h3>
                    <div style="display: flex; align-items: center; justify-content: space-around; flex-wrap: wrap;">
                        <div style="text-align: center; margin: 10px;">
                            <div style="font-size: 1.2rem; color: var(--pearl-white);">æ—¥ä¸»</div>
                            <div style="font-size: 3rem; font-weight: bold; color: var(--golden-yellow);">${dayGan}</div>
                        </div>
                        <div style="text-align: center; margin: 10px;">
                            <div style="font-size: 1.2rem; color: var(--pearl-white);">äº”è¡Œ</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success-green);">${dayElement}</div>
                        </div>
                        <div style="text-align: center; margin: 10px;">
                            <div style="font-size: 1.2rem; color: var(--pearl-white);">é˜´é˜³</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--info-blue);">${dayYinyang}</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--golden-yellow); margin-bottom: 10px;">äº”è¡Œåˆ†æ</h3>
                    <div style="color: var(--pearl-white);">${wuxingAnalysis}</div>
                </div>
            `;
            
            document.getElementById('baziSummary').innerHTML = summaryHTML;
        }
        
        function displayPredictions(yearPillar, monthPillar, dayPillar, hourPillar, gender) {
            const predictions = getPast10YearsAnalysis(yearPillar, monthPillar, dayPillar, hourPillar, gender);
            
            let predictionsHTML = '<div class="prediction-grid-inner">';
            
            predictions.forEach((pred, index) => {
                predictionsHTML += `
                    <div class="prediction-card">
                        <div class="prediction-year">${pred.type}</div>
                        <div class="prediction-effect">${pred.effect}</div>
                        <div class="prediction-method">åŸºäºç©¿åˆ‘ç»ç ´å’Œåœ°æ”¯å¯¹å†²åˆ†æ</div>
                    </div>
                `;
            });
            
            predictionsHTML += '</div>';
            document.getElementById('predictionGrid').innerHTML = predictionsHTML;
        }
        
        // ==================== 13. å…¶ä»–åŠŸèƒ½ ====================
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function resetForm() {
            document.getElementById('year').value = '1990';
            document.getElementById('month').value = '5';
            document.getElementById('day').value = '15';
            document.getElementById('hour').value = '12';
            document.getElementById('location').value = 'åŒ—äº¬';
            
            const genderOptions = document.querySelectorAll('.gender-option');
            genderOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.gender === 'male') {
                    option.classList.add('active');
                }
            });
            
            document.getElementById('resultDisplay').style.display = 'none';
            document.getElementById('reportDownloads').style.display = 'none';
            document.getElementById('advancedFeatures').style.display = 'none';
        }
        
        // ==================== 14. åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeDayPillarDatabase();
            loadPaidUsers();
            
            document.getElementById('calculateBtn').addEventListener('click', calculateBazi);
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            document.getElementById('premiumBtn').addEventListener('click', () => openPayment('pro'));
            
            document.querySelectorAll('.gender-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.gender-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            document.querySelectorAll('.date-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const dateType = this.dataset.date;
                    
                    switch(dateType) {
                        case 'today':
                            const today = new Date();
                            document.getElementById('year').value = today.getFullYear();
                            document.getElementById('month').value = today.getMonth() + 1;
                            document.getElementById('day').value = today.getDate();
                            break;
                        case 'yesterday':
                            const yesterday = new Date();
                            yesterday.setDate(yesterday.getDate() - 1);
                            document.getElementById('year').value = yesterday.getFullYear();
                            document.getElementById('month').value = yesterday.getMonth() + 1;
                            document.getElementById('day').value = yesterday.getDate();
                            break;
                        case 'example1':
                            document.getElementById('year').value = '1990';
                            document.getElementById('month').value = '5';
                            document.getElementById('day').value = '15';
                            document.getElementById('hour').value = '12';
                            break;
                        case 'example2':
                            document.getElementById('year').value = '1985';
                            document.getElementById('month').value = '8';
                            document.getElementById('day').value = '20';
                            document.getElementById('hour').value = '13';
                            break;
                        case 'example3':
                            document.getElementById('year').value = '1978';
                            document.getElementById('month').value = '11';
                            document.getElementById('day').value = '8';
                            document.getElementById('hour').value = '7';
                            break;
                    }
                    
                    calculateBazi();
                });
            });
            
            // åˆå§‹åŒ–åˆ†äº«çŠ¶æ€
            updateShareButton();
            
            // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰åˆ†äº«å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const shareId = urlParams.get('share');
            if (shareId) {
                const sharedData = localStorage.getItem(`bazi_share_${shareId}`);
                if (sharedData) {
                    try {
                        const data = JSON.parse(sharedData);
                        document.getElementById('year').value = data.year;
                        document.getElementById('month').value = data.month;
                        document.getElementById('day').value = data.day;
                        document.getElementById('hour').value = data.hour;
                        document.getElementById('location').value = data.location;
                        
                        const genderOptions = document.querySelectorAll('.gender-option');
                        genderOptions.forEach(option => {
                            option.classList.remove('active');
                            if (option.dataset.gender === data.gender) {
                                option.classList.add('active');
                            }
                        });
                        
                        // å¢åŠ åˆ†äº«è®¡æ•°
                        increaseShareCount();
                        
                        setTimeout(calculateBazi, 500);
                    } catch (error) {
                        console.error("åŠ è½½åˆ†äº«æ•°æ®å¤±è´¥:", error);
                        setTimeout(calculateBazi, 500);
                    }
                } else {
                    setTimeout(calculateBazi, 500);
                }
            } else {
                setTimeout(calculateBazi, 500);
            }
        });
        
        // è¾…åŠ©å‡½æ•°
        function saveData() {
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            const dataStr = JSON.stringify(currentBaziData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `å…«å­—æ•°æ®_${currentBaziData.year}å¹´${currentBaziData.month}æœˆ${currentBaziData.day}æ—¥.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('æ•°æ®å·²ä¿å­˜ï¼');
        }
        
        function backupData() {
            const allData = {
                baziData: currentBaziData,
                shareCount: shareCount,
                isUnlockedLevel1: isUnlockedLevel1,
                timestamp: new Date().toISOString(),
                version: "2.0"
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `å…«å­—å¤‡ä»½_${new Date().toLocaleDateString()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('æ•°æ®å·²å¤‡ä»½ï¼');
        }
        
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.baziData) {
                        currentBaziData = data.baziData;
                        shareCount = data.shareCount || 0;
                        isUnlockedLevel1 = data.isUnlockedLevel1 || false;
                        
                        localStorage.setItem('bazi_share_count', shareCount);
                        localStorage.setItem('bazi_unlocked_level1', isUnlockedLevel1);
                        
                        document.getElementById('year').value = currentBaziData.year;
                        document.getElementById('month').value = currentBaziData.month;
                        document.getElementById('day').value = currentBaziData.day;
                        document.getElementById('hour').value = currentBaziData.hourValue;
                        document.getElementById('location').value = currentBaziData.location;
                        
                        const genderOptions = document.querySelectorAll('.gender-option');
                        genderOptions.forEach(option => {
                            option.classList.remove('active');
                            if (option.dataset.gender === currentBaziData.gender) {
                                option.classList.add('active');
                            }
                        });
                        
                        calculateBazi();
                        updateShareButton();
                        alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
                    }
                } catch (error) {
                    alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œæ¢å¤å¤±è´¥ï¼');
                }
            };
            reader.readAsText(file);
        }
        
        // æ‰“å°åŠŸèƒ½
        document.getElementById('printBtn').addEventListener('click', function() {
            if (!currentBaziData) {
                alert("è¯·å…ˆè®¡ç®—å…«å­—");
                return;
            }
            
            const printContent = document.getElementById('resultDisplay').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div style="font-family: 'Microsoft YaHei', sans-serif; padding: 20px; background: white; color: black;">
                    <h1 style="text-align: center; color: #8b0000; margin-bottom: 30px;">å…«å­—æ’ç›˜æŠ¥å‘Š</h1>
                    ${printContent}
                    <div style="text-align: center; margin-top: 40px; color: #666; font-size: 14px;">
                        æ‰“å°æ—¶é—´ï¼š${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        });
    </script>
</body>
</html>